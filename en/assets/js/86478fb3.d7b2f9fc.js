"use strict";(self.webpackChunkbookshell=self.webpackChunkbookshell||[]).push([[6649],{46:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>o,contentTitle:()=>d,default:()=>h,frontMatter:()=>i,metadata:()=>t,toc:()=>c});var l=r(4848),s=r(8453);const i={},d=void 0,t={id:"k8s/\u66f4\u65b0\u5185\u6838",title:"\u66f4\u65b0\u5185\u6838",description:"\u7f16\u8bd1\u5b89\u88c5\u65b9\u5f0f",source:"@site/docs/k8s/5.\u66f4\u65b0\u5185\u6838.md",sourceDirName:"k8s",slug:"/k8s/\u66f4\u65b0\u5185\u6838",permalink:"/en/docs/k8s/\u66f4\u65b0\u5185\u6838",draft:!1,unlisted:!1,editUrl:"https://github.com/shouji1128955/bookshell/edit/main/docs/k8s/5.\u66f4\u65b0\u5185\u6838.md",tags:[],version:"current",lastUpdatedBy:"zhanglaiqiang",lastUpdatedAt:1728577316e3,sidebarPosition:5,frontMatter:{},sidebar:"k8s",previous:{title:"kubernetes_cka",permalink:"/en/docs/k8s/kubernetes_cka"},next:{title:"ansible\u5b89\u88c5k8s-1.24.12",permalink:"/en/docs/k8s/ansible\u5b89\u88c5k8s-1.24.12"}},o={},c=[{value:"\u7f16\u8bd1\u5b89\u88c5\u65b9\u5f0f",id:"\u7f16\u8bd1\u5b89\u88c5\u65b9\u5f0f",level:2},{value:"1.\u4e0b\u8f7d\u5185\u6838\u8f6f\u4ef6\u5305",id:"1\u4e0b\u8f7d\u5185\u6838\u8f6f\u4ef6\u5305",level:5},{value:"2.\u89e3\u5305",id:"2\u89e3\u5305",level:5},{value:"3.\u5b89\u88c5\u4f9d\u8d56",id:"3\u5b89\u88c5\u4f9d\u8d56",level:5},{value:"4.\u914d\u7f6e",id:"4\u914d\u7f6e",level:5},{value:"5.\u7f16\u8bd1",id:"5\u7f16\u8bd1",level:5},{value:"6.\u5b89\u88c5\u6a21\u5757",id:"6\u5b89\u88c5\u6a21\u5757",level:5},{value:"7.\u66f4\u6539\u9ed8\u8ba4\u542f\u52a8\u6838\u5fc3",id:"7\u66f4\u6539\u9ed8\u8ba4\u542f\u52a8\u6838\u5fc3",level:5},{value:"8.\u4f7f\u914d\u7f6e\u6587\u4ef6\u751f\u6548",id:"8\u4f7f\u914d\u7f6e\u6587\u4ef6\u751f\u6548",level:5},{value:"9.\u4fee\u6539\u9ed8\u8ba4\u542f\u52a8\u7684\u5185\u6838",id:"9\u4fee\u6539\u9ed8\u8ba4\u542f\u52a8\u7684\u5185\u6838",level:5},{value:"yum\u5b89\u88c5\u65b9\u5f0f",id:"yum\u5b89\u88c5\u65b9\u5f0f",level:2},{value:"\u5bfc\u5165ELRepo\u4ed3\u5e93\u7684\u516c\u5171\u5bc6\u94a5",id:"\u5bfc\u5165elrepo\u4ed3\u5e93\u7684\u516c\u5171\u5bc6\u94a5",level:4},{value:"\u67e5\u8be2\u53ef\u7528\u5185\u6838\u7248\u672c",id:"\u67e5\u8be2\u53ef\u7528\u5185\u6838\u7248\u672c",level:4},{value:"\u5b89\u88c5\u6700\u65b0\u7684\u7a33\u5b9a\u7248\u672c\u5185\u6838",id:"\u5b89\u88c5\u6700\u65b0\u7684\u7a33\u5b9a\u7248\u672c\u5185\u6838",level:4},{value:"\u8bbe\u7f6e grub2",id:"\u8bbe\u7f6e-grub2",level:4},{value:"\u751f\u6210 grub \u914d\u7f6e\u6587\u4ef6\u5e76\u91cd\u542f",id:"\u751f\u6210-grub-\u914d\u7f6e\u6587\u4ef6\u5e76\u91cd\u542f",level:4},{value:"\u5220\u9664\u65e7\u5185\u6838\uff08<strong>\u53ef\u9009</strong>\uff09",id:"\u5220\u9664\u65e7\u5185\u6838\u53ef\u9009",level:4}];function a(e){const n={code:"code",h2:"h2",h4:"h4",h5:"h5",img:"img",p:"p",pre:"pre",strong:"strong",...(0,s.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.h2,{id:"\u7f16\u8bd1\u5b89\u88c5\u65b9\u5f0f",children:"\u7f16\u8bd1\u5b89\u88c5\u65b9\u5f0f"}),"\n",(0,l.jsx)(n.h5,{id:"1\u4e0b\u8f7d\u5185\u6838\u8f6f\u4ef6\u5305",children:"1.\u4e0b\u8f7d\u5185\u6838\u8f6f\u4ef6\u5305"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"https://mirrors.tuna.tsinghua.edu.cn/kernel/v4.x/\n"})}),"\n",(0,l.jsx)(n.h5,{id:"2\u89e3\u5305",children:"2.\u89e3\u5305"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"[root@k8s-master1 software]# tar xf linux-4.19.100.tar.xz\n"})}),"\n",(0,l.jsx)(n.h5,{id:"3\u5b89\u88c5\u4f9d\u8d56",children:"3.\u5b89\u88c5\u4f9d\u8d56"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:'[root@k8s-master1 ~]# yum install ncurses-devel bison flex elfutils-libelf-devel groupinstall "Development Tools" -y\n'})}),"\n",(0,l.jsx)(n.h5,{id:"4\u914d\u7f6e",children:"4.\u914d\u7f6e"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"[root@k8s-master1 ~]# cd linux-4.19.100\r\n[root@k8s-master1 linux-4.19.100]# make menuconfig\n"})}),"\n",(0,l.jsx)(n.h5,{id:"5\u7f16\u8bd1",children:"5.\u7f16\u8bd1"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"[root@k8s-master1 linux-linux-4.19.100]# make -j 4\n"})}),"\n",(0,l.jsx)(n.h5,{id:"6\u5b89\u88c5\u6a21\u5757",children:"6.\u5b89\u88c5\u6a21\u5757"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"[root@k8s-master1 linux-4.19.100]# make modules_install\r\n[root@k8s-master1 linux-4.19.100]# make install\n"})}),"\n",(0,l.jsx)(n.h5,{id:"7\u66f4\u6539\u9ed8\u8ba4\u542f\u52a8\u6838\u5fc3",children:"7.\u66f4\u6539\u9ed8\u8ba4\u542f\u52a8\u6838\u5fc3"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:'\u5c06GRUB_DEFAULT=saved \u6539\u6210 GRUB_DEFAULT=0\r\n[root@k8s-master1 ~]# vim /etc/default/grub \r\nGRUB_TIMEOUT=5\r\nGRUB_DISTRIBUTOR="$(sed \'s, release .*$,,g\' /etc/system-release)"\r\nGRUB_DEFAULT=0\r\nGRUB_DISABLE_SUBMENU=true\r\nGRUB_TERMINAL_OUTPUT="console"\r\nGRUB_CMDLINE_LINUX="rd.lvm.lv=rhel/root rd.lvm.lv=rhel/swap rhgb quiet"\r\nGRUB_DISABLE_RECOVERY="true"\n'})}),"\n",(0,l.jsx)(n.h5,{id:"8\u4f7f\u914d\u7f6e\u6587\u4ef6\u751f\u6548",children:"8.\u4f7f\u914d\u7f6e\u6587\u4ef6\u751f\u6548"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"[root@k8s-master1 ~]# grub2-mkconfig -o /boot/grub2/grub.cfg \n"})}),"\n",(0,l.jsx)(n.h5,{id:"9\u4fee\u6539\u9ed8\u8ba4\u542f\u52a8\u7684\u5185\u6838",children:"9.\u4fee\u6539\u9ed8\u8ba4\u542f\u52a8\u7684\u5185\u6838"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"[root@k8s-master1 ~]# grub2-editenv list  //\u67e5\u770b\u9ed8\u8ba4\u542f\u52a8\u5185\u6838\r\n\r\nsaved_entry=CentOS Linux (3.10.0-1160.45.1.el7.x86_64) 7 (Core)\r\n\r\n[root@k8s-master1 ~]# cat /boot/grub2/grub.cfg | grep menuentry \u67e5\u770b\u6240\u6709\u5185\u6838\r\n\r\n'CentOS Linux (4.19.100) 7 (Core)'\r\n\r\n'CentOS Linux (3.10.0-1160.59.1.el7.x86_64) 7 (Core)'\r\n\r\n[root@k8s-master1 ~]# grub2-set-default 'CentOS Linux (4.19.100) 7 (Core)' //\u8bbe\u7f6e\u9ed8\u8ba4\u542f\u52a8\u5185\u6838\n"})}),"\n",(0,l.jsx)(n.h2,{id:"yum\u5b89\u88c5\u65b9\u5f0f",children:"yum\u5b89\u88c5\u65b9\u5f0f"}),"\n",(0,l.jsx)(n.h4,{id:"\u5bfc\u5165elrepo\u4ed3\u5e93\u7684\u516c\u5171\u5bc6\u94a5",children:"\u5bfc\u5165ELRepo\u4ed3\u5e93\u7684\u516c\u5171\u5bc6\u94a5"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-cobol",children:"rpm --import https://www.elrepo.org/RPM-GPG-KEY-elrepo.org\n"})}),"\n",(0,l.jsx)(n.p,{children:"\u5b89\u88c5ELRepo\u4ed3\u5e93\u7684yum\u6e90"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-cobol",children:"rpm -Uvh http://www.elrepo.org/elrepo-release-7.0-3.el7.elrepo.noarch.rpm\n"})}),"\n",(0,l.jsx)(n.h4,{id:"\u67e5\u8be2\u53ef\u7528\u5185\u6838\u7248\u672c",children:"\u67e5\u8be2\u53ef\u7528\u5185\u6838\u7248\u672c"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-cobol",children:'yum --disablerepo="*" --enablerepo="elrepo-kernel" list available\n'})}),"\n",(0,l.jsx)(n.h4,{id:"\u5b89\u88c5\u6700\u65b0\u7684\u7a33\u5b9a\u7248\u672c\u5185\u6838",children:"\u5b89\u88c5\u6700\u65b0\u7684\u7a33\u5b9a\u7248\u672c\u5185\u6838"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-perl",children:"yum -y --enablerepo=elrepo-kernel install kernel-lt\n"})}),"\n",(0,l.jsx)(n.h4,{id:"\u8bbe\u7f6e-grub2",children:"\u8bbe\u7f6e grub2"}),"\n",(0,l.jsx)(n.p,{children:"\u5185\u6838\u5b89\u88c5\u597d\u540e\uff0c\u9700\u8981\u8bbe\u7f6e\u4e3a\u9ed8\u8ba4\u542f\u52a8\u9009\u9879\u5e76\u91cd\u542f\u540e\u624d\u4f1a\u751f\u6548"}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"\u67e5\u770b\u7cfb\u7edf\u4e0a\u7684\u6240\u6709\u53ef\u7528\u5185\u6838\uff1a"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:'awk -F\\\' \'$1=="menuentry " {print i++ " : " $2}\' /etc/grub2.cfg\n'})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"\u65b9\u6cd51\uff1a\u901a\u8fc7 grub2-set-default 0 \u547d\u4ee4\u8bbe\u7f6e"})}),"\n",(0,l.jsx)(n.p,{children:"grub2-set-default 0"}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsxs)(n.strong,{children:["\u65b9\u6cd52\uff1a\u7f16\u8f91 ",(0,l.jsx)(n.code,{children:"/etc/default/grub"})," \u6587\u4ef6"]})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"vim /etc/default/grub\n"})}),"\n",(0,l.jsx)(n.p,{children:"\u7f16\u8f91\uff08e\uff09\u5c06GRUB_DEFAULT\u8bbe\u7f6e\u4e3a0\uff0c\u5982\u4e0b"}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.img,{alt:"image-20231210233335554",src:r(7524).A+"",width:"756",height:"173"})}),"\n",(0,l.jsx)(n.p,{children:"\u4fee\u6539\u5b8c\u6210\u540e\u4fdd\u5b58\u9000\u51fa\uff08\uff1awq\uff09"}),"\n",(0,l.jsx)(n.h4,{id:"\u751f\u6210-grub-\u914d\u7f6e\u6587\u4ef6\u5e76\u91cd\u542f",children:"\u751f\u6210 grub \u914d\u7f6e\u6587\u4ef6\u5e76\u91cd\u542f"}),"\n",(0,l.jsx)(n.p,{children:"grub2-mkconfig -o /boot/grub2/grub.cfg"}),"\n",(0,l.jsx)(n.p,{children:"\u91cd\u542f\u865a\u62df\u673a\u6216\u7269\u7406\u673a"}),"\n",(0,l.jsxs)(n.h4,{id:"\u5220\u9664\u65e7\u5185\u6838\u53ef\u9009",children:["\u5220\u9664\u65e7\u5185\u6838\uff08",(0,l.jsx)(n.strong,{children:"\u53ef\u9009"}),"\uff09"]}),"\n",(0,l.jsx)(n.p,{children:"\u67e5\u770b\u7cfb\u7edf\u4e2d\u7684\u5168\u90e8\u5185\u6838"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-perl",children:"rpm -qa | grep kernel\n"})}),"\n",(0,l.jsx)(n.p,{children:"\u53ef\u9009\u62e9\u5220\u96643.10\u7248\u672c\u7684\u5185\u6838"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-csharp",children:"yum remove kernel-*\n"})})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(a,{...e})}):a(e)}},7524:(e,n,r)=>{r.d(n,{A:()=>l});const l=r.p+"assets/images/image-20231210233335554-19af1dd6d018ff325fd2c1f923897bdf.png"},8453:(e,n,r)=>{r.d(n,{R:()=>d,x:()=>t});var l=r(6540);const s={},i=l.createContext(s);function d(e){const n=l.useContext(i);return l.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function t(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:d(e.components),l.createElement(i.Provider,{value:n},e.children)}}}]);