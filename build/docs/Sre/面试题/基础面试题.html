<!doctype html>
<html lang="zh-CN" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-Sre/面试题/基础面试题" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.5.2">
<title data-rh="true">基础面试题 | LiteShell</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://docusaurus.io/zh-CN/img/undraw_typewriter.svg"><meta data-rh="true" name="twitter:image" content="https://docusaurus.io/zh-CN/img/undraw_typewriter.svg"><meta data-rh="true" property="og:url" content="https://shouji1128955.github.io/bookshell/docs/Sre/面试题/基础面试题"><meta data-rh="true" property="og:locale" content="zh_CN"><meta data-rh="true" property="og:locale:alternate" content="en"><meta data-rh="true" name="docusaurus_locale" content="zh-CN"><meta data-rh="true" name="docsearch:language" content="zh-CN"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="基础面试题 | LiteShell"><meta data-rh="true" name="description" content="Linux系统"><meta data-rh="true" property="og:description" content="Linux系统"><link data-rh="true" rel="icon" href="/bookshell/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://shouji1128955.github.io/bookshell/docs/Sre/面试题/基础面试题"><link data-rh="true" rel="alternate" href="https://shouji1128955.github.io/bookshell/docs/Sre/面试题/基础面试题" hreflang="zh-CN"><link data-rh="true" rel="alternate" href="https://shouji1128955.github.io/bookshell/en/docs/Sre/面试题/基础面试题" hreflang="en"><link data-rh="true" rel="alternate" href="https://shouji1128955.github.io/bookshell/docs/Sre/面试题/基础面试题" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/bookshell/blog/rss.xml" title="LiteShell RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/bookshell/blog/atom.xml" title="LiteShell Atom Feed"><link rel="stylesheet" href="/bookshell/assets/css/styles.fb7577d1.css">
<script src="/bookshell/assets/js/runtime~main.c0446ed9.js" defer="defer"></script>
<script src="/bookshell/assets/js/main.d13dfaa7.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="跳到主要内容"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">跳到主要内容</a></div><nav aria-label="主导航" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/bookshell/"><div class="navbar__logo"><img src="/bookshell/img/logo.svg" alt="LiteShell" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/bookshell/img/logo.svg" alt="LiteShell" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">LiteShell</b></a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Sre</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/bookshell/docs/Sre/日常运维/operator">日常运维</a></li><li><a class="dropdown__link" href="/bookshell/docs/Sre/中间件/Harbor">中间件</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/bookshell/docs/Sre/面试题/基础面试题">面试题</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Kubernetes</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/bookshell/docs/k8s/operator">Kubernetes</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Prometheus</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/bookshell/docs/Prometheus/grafana">grafana</a></li><li><a class="dropdown__link" href="/bookshell/docs/Prometheus/prometheus/告警指标汇总">Prometheus</a></li><li><a class="dropdown__link" href="/bookshell/docs/Prometheus/alertManager/alertmanager告警配置">AlertManager</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">DevOps</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/bookshell/docs/DevOps/jenkins/jenkins安装配置/jenkins安装配置">jenkins</a></li><li><a class="dropdown__link" href="/bookshell/docs/DevOps/gitOps/tekton安装">gitOps</a></li><li><a class="dropdown__link" href="/bookshell/docs/DevOps/ELK/ELK测试部署">ELK</a></li><li><a class="dropdown__link" href="/bookshell/docs/DevOps/skywalking/zookeeper安装">skywalking</a></li><li><a class="dropdown__link" href="/bookshell/docs/DevOps/observability/OpenTelemetry">observability</a></li><li><a class="dropdown__link" href="/bookshell/docs/DevOps/terraform/terraform">terraform</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Golang</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/bookshell/docs/Golang/golang基础/Go核心编程2023/golang">golang基础</a></li><li><a class="dropdown__link" href="/bookshell/docs/Golang/golang进阶/gin框架2023/Gin框架">golang进阶</a></li><li><a class="dropdown__link" href="/bookshell/docs/Golang/golang运维/项目1-Bingo/Bingo">golang运维</a></li><li><a class="dropdown__link" href="/bookshell/docs/Golang/VUE/vue入门教程/html基础">Vue</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">JAVA</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/bookshell/docs/Java/JAVA/admin组件">Java</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Treasure</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/bookshell/docs/Treasure/Wisdom/国学经典">Plan and strategize</a></li><li><a class="dropdown__link" href="/bookshell/docs/Treasure/Studytour/莱卡">read book</a></li></ul></div><a class="navbar__item navbar__link" href="/bookshell/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="切换浅色/暗黑模式（当前为浅色模式）" aria-label="切换浅色/暗黑模式（当前为浅色模式）" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><div class="navbar__search searchBarContainer_NW3z" dir="ltr"><input placeholder="搜索" aria-label="Search" class="navbar__search-input"><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="文档侧边栏" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/bookshell/docs/Sre/面试题/基础面试题">基础面试题</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/bookshell/docs/Sre/面试题/kubernetes面试题">kubernetes面试题</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/bookshell/docs/Sre/面试题/监控">监控</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/bookshell/docs/Sre/面试题/prometheus部署文档输出">prometheus部署文档输出</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/bookshell/docs/Sre/面试题/缓存服务">缓存服务</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/bookshell/docs/Sre/面试题/python">python</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/bookshell/docs/Sre/面试题/容器技术">容器技术</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/bookshell/docs/Sre/面试题/golang面试题">golang面试题</a></li></ul></nav><button type="button" title="收起侧边栏" aria-label="收起侧边栏" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="页面路径"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="主页面" class="breadcrumbs__link" href="/bookshell/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">基础面试题</span><meta itemprop="position" content="1"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">本页总览</button></div><div class="theme-doc-markdown markdown"><header><h1>基础面试题</h1></header><h2 class="anchor anchorWithStickyNavbar_LWe7" id="linux系统">Linux系统<a href="#linux系统" class="hash-link" aria-label="Linux系统的直接链接" title="Linux系统的直接链接">​</a></h2>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="路由交换">路由交换<a href="#路由交换" class="hash-link" aria-label="路由交换的直接链接" title="路由交换的直接链接">​</a></h4>
<p>交换机： 涉及vlan，stp协议</p>
<p>路由器： static router,
动态路由BGP,RIP，OSPF</p>
<p>介绍vxlan， vlan的区别，物理网络 underlay,  overlay叠加网络</p>
<p><a href="https://segmentfault.com/a/1190000022365692" target="_blank" rel="noopener noreferrer">https://segmentfault.com/a/1190000022365692</a></p>
<p><img decoding="async" loading="lazy" src="https://iteshell.oss-cn-beijing.aliyuncs.com/bookshell/operator/image-20231104000823756.png" alt="image-20231104000823756" class="img_ev3q"></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="raidlvm服务器">Raid,LVM服务器<a href="#raidlvm服务器" class="hash-link" aria-label="Raid,LVM服务器的直接链接" title="Raid,LVM服务器的直接链接">​</a></h4>
<p>Raid相关概念：</p>
<p>Raid0: 没有冗余，性能最好，冗余最差，2块起  磁盘使用率100%</p>
<p>Raid1: 冗余最好， 但是性能最差 ，2块起，最多允许坏  磁盘使用率50%</p>
<p>Raid5: 不管多少数据盘，最多只能坏一块盘。磁盘使用率(N-1)/N</p>
<p>Raid10：</p>
<ol>
<li>
<p>RAID 0+1是存储性能和数据安全兼顾的方案。它在提供与RAID 1一样的数据安全保障的同时，也提供了与RAID 0近似的存储性能。</p>
</li>
<li>
<p>由于RAID 0+1也通过数据的100%备份提供数据安全保障，因此RAID 0+1的磁盘空间利用率与RAID 1相同，存储成本高。</p>
</li>
<li>
<p>RAID 0+1的特点使其特别适用于既有大量数据需要存取，同时又对数据安全性要求严格的领域，如银行、金融、商业超市、仓储库房、各种档案管理等。</p>
</li>
</ol>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="kvm">KVM<a href="#kvm" class="hash-link" aria-label="KVM的直接链接" title="KVM的直接链接">​</a></h4>
<p>基本理论</p>
<p>什么是虚拟化？就是将一台物理机虚拟成多台虚拟机，虚拟机之前互不干扰。</p>
<p>为什么要用虚拟化？充分利用物理资源，提供冗余性、向云计算演进的必要基础。</p>
<p>常见的虚拟化软件？vmware、kvm</p>
<p>查看当前系统是使用哪家的虚拟化？lscpu</p>
<p>kvm的三个组件及作用：libvirt（用来管理虚拟机）、virt（安装和克隆虚拟机）、qemu（管理虚拟机磁盘的）</p>
<p>磁盘的类型（raw/qcow2），raw不支持快照但性能好，常用的是qcom2支持快照，性能相比差一点。</p>
<p>第一个虚拟要默认是侦听在5900这个端口。</p>
<p>桥接的工作原理</p>
<p>注意:</p>
<p>参考容器章节-比对kvm跟容器的区别</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="iptables">iptables<a href="#iptables" class="hash-link" aria-label="iptables的直接  链接" title="iptables的直接链接">​</a></h4>
<p>表和链（四表五链）
1.filter （过滤） 进行包过滤处理的一张表
2.nat （映射） 对数据地址信息进行转换/数据包端口信息进行转换
实现内网用户访问外网
实现外网用户访问内网
3.mangle （不常用）
对数据包信息进行标记
4.raw（不常用</p>
<p><img decoding="async" loading="lazy" src="https://iteshell.oss-cn-beijing.aliyuncs.com/bookshell/operator/image-20231102191014927.png" alt="image-20231102191014927" class="img_ev3q"></p>
<p>只允许远程主机访问本机的80端口</p>
<p>ptables  -P INPUT DROP</p>
<p>iptables -A INPUT --dport 80 -j ACCEPT</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="硬链接和软链接的区别">硬链接和软链接的区别<a href="#硬链接和软链接的区别" class="hash-link" aria-label="硬链接和软链接的区别的直接链接" title="硬链接和软链接的区别的直接链接">​</a></h4>
<p>1）硬链接</p>
<p>由于 Linux 下的文件是通过索引节点(inode)来识别文件，硬链接可以认为是一个指针，指向文件索引节点的指针，系统并不为它重新分配 inode 。每添加一个一个硬链接，文件的链接数就加 1 。</p>
<ul>
<li>不足：1）不可以在不同文件系统的文件间建立链接；2）只有超级用户才可以为目录创建硬链接。</li>
</ul>
<p>2）软链接</p>
<p>软链接克服了硬链接的不足，没有任何文件系统的限制，任何用户可以创建指向目录的符号链接。因而现在更为广泛使用，它具有更大的灵活性，甚至可以跨越不同机器、不同网络对文件进行链接。</p>
<ul>
<li>不足：因为链接文件包含有原文件的路径信息，所以当原文件从一个目录下移到其他目录中，再访问链接文件，系统就找不到了，而硬链接就没有这个缺陷，你想怎么移就怎么移；还有它要系统分配额外的空间用于建立新的索引节点和保存原文件的路径。</li>
</ul>
<p><strong>实际场景下，基本是使用软链接</strong>。总结区别如下：</p>
<ul>
<li>硬链接不可以跨分区，软件链可以跨分区。</li>
<li>硬链接指向一个 inode 节点，而软链接则是创建一个新的 inode 节点。</li>
<li>删除硬链接文件，不会删除原文件，删除软链接文件，会把原文件删除。</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="linux中的软限制和硬限制的区别是">Linux中的软限制和硬限制的区别是<a href="#linux中的软限制和硬限制的区别是" class="hash-link" aria-label="Linux中的软限制和硬限制的区别是的直接链接" title="Linux中的软限制和硬限制的区别是的直接链接">​</a></h4>
<p>在Linux中，软限制是系统为了保护文件系统而设置的一个限制，当达到软限制时，系统会发出警告，但仍然允许操作。而硬限制则是系统为了保护文件系统而设置的一个绝对限制，当达到硬限制时，系统将禁止操作</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="linux-开机启动过程">Linux 开机启动过程<a href="#linux-开机启动过程" class="hash-link" aria-label="Linux 开机启动过程的直接链接" title="Linux 开机启动过程的直接链接">​</a></h4>
<ul>
<li>1、主机加电自检，加载 BIOS 硬件信息</li>
<li>2、读取 MBR 的引导文件(GRUB、LILO)</li>
<li>3、引导 Linux 内核</li>
<li>4、运行第一个进程 init (进程号永远为 1 )</li>
<li>5、进入相应的运行级别</li>
<li>6、运行终端，输入用户名和密码</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="linux-使用的进程间通信方式">Linux 使用的进程间通信方式<a href="#linux-使用的进程间通信方式" class="hash-link" aria-label="Linux 使用的进程间通信方式的直接链接" title="Linux 使用的进程间通信方式的直接链接">​</a></h4>
<ul>
<li>1、管道(pipe)、流管道(s_pipe)、有名管道(FIFO)</li>
<li>2、信号(signal)</li>
<li>3、消息队列</li>
<li>4、共享内存</li>
<li>5、信号量</li>
<li>6、套接字(socket)</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="less命令">less命令<a href="#less命令" class="hash-link" aria-label="less命令的直接链接" title="less命令的直接链接">​</a></h4>
<p>（1）ps 查看进程信息并通过 less 分页显示</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ps -aux | less -N</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>（2）查看多个文件</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">less 1.log 2.log</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>可以使用 n 查看下一个，使用 p 查看前一个。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="ln-命令">ln 命令<a href="#ln-命令" class="hash-link" aria-label="ln 命令的直接链接" title="ln 命令的直接链接">​</a></h4>
<p>功能是为文件在另外一个位置建立一个同步的链接，当在不同目录需要该问题时，就不需要为每一个目录创建同样的文件，通过 ln 创建的链接（link）减少磁盘占用量。</p>
<p>链接分类：软件链接及硬链接</p>
<p>软链接：</p>
<ul>
<li>1.软链接，以路径的形式存在。类似于Windows操作系统中的快捷方式</li>
<li>2.软链接可以 跨文件系统 ，硬链接不可以</li>
<li>3.软链接可以对一个不存在的文件名进行链接</li>
<li>4.软链接可以对目录进行链接</li>
</ul>
<p>硬链接:</p>
<ul>
<li>1.硬链接，以文件副本的形式存在。但不占用实际空间。</li>
<li>2.不允许给目录创建硬链接</li>
<li>3.硬链接只有在同一个文件系统中才能创建</li>
</ul>
<p><strong>需要注意</strong>：</p>
<ul>
<li>第一：ln命令会保持每一处链接文件的同步性，也就是说，不论你改动了哪一处，其它的文件都会发生相同的变化；</li>
<li>第二：ln的链接又分软链接和硬链接两种，软链接就是ln –s 源文件 目标文件，它只会在你选定的位置上生成一个文件的镜像，不会占用磁盘空间，硬链接 ln 源文件 目标文件，没有参数-s， 它会在你选定的位置上生成一个和源文件大小相同的文件，无论是软 链接还是硬链接，文件都保持同步变化。</li>
<li>第三：ln指令用在链接文件或目录，如同时指定两个以上的文件或目录，且最后的目的地是一个已经存在的目录，则会把前面指定的所有文件或目录复制到该目录中。若同时指定多个文件或目录，且最后的目的地并非是一个已存在的目录，则会出现错误信息。</li>
</ul>
<p><strong>常用参数</strong>：</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">-b 删除，覆盖以前建立的链接</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-s 软链接（符号链接）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-v 显示详细处理过程</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>实例</strong>：</p>
<p>（1）给文件创建软链接，并显示操作信息</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ln -sv source.log link.log</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>（2）给文件创建硬链接，并显示操作信息</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ln -v source.log link1.log</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>（3）给目录创建软链接</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ln -sv /opt/soft/test/test3 /opt/soft/test/test5</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="locate-命令">locate 命令<a href="#locate-命令" class="hash-link" aria-label="locate 命令的直接链接" title="locate 命令的直接链接">​</a></h4>
<p>locate 通过搜寻系统内建文档数据库达到快速找到档案，数据库由 updatedb 程序来更新，updatedb 是由 cron daemon 周期性调用的。默认情况下 locate 命令在搜寻数据库时比由整个由硬盘资料来搜寻资料来得快，但较差劲的是 locate 所找到的档案若是最近才建立或 刚更名的，可能会找不到，在内定值中，updatedb 每天会跑一次，可以由修改 crontab 来更新设定值 (etc/crontab)。</p>
<p>locate 与 find 命令相似，可以使用如 *、? 等进行正则匹配查找</p>
<p><strong>常用参数</strong>：</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">-l num（要显示的行数）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-f   将特定的档案系统排除在外，如将proc排除在外</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-r   使用正则运算式做为寻找条件</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>实例</strong>：</p>
<p>（1）查找和 pwd 相关的所有文件(文件名中包含 pwd）</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">locate pwd</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>（2）搜索 etc 目录下所有以 sh 开头的文件</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">locate /etc/sh</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>（3）查找 /var 目录下，以 reason 结尾的文件</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">locate -r &#x27;^/var.*reason$&#x27;（其中.表示一个字符，*表示任务多个；.*表示任意多个字符）</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>其他参考</p>
<p><strong><a href="https://github.com/ThinkingHan/Java-review-gudie/blob/master/%E9%9D%A2%E8%AF%95%E9%A2%98%E9%9B%86/Linux%E9%9D%A2%E8%AF%95%E9%A2%98.md" target="_blank" rel="noopener noreferrer">Java-review-gudie/面试题集/Linux面试题.md at master · ThinkingHan/Java-review-gudie · GitHub</a></strong></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="shell脚本">shell脚本<a href="#shell脚本" class="hash-link" aria-label="shell脚本的直接链接" title="shell脚本的直接链接">​</a></h2>
<p>变量引用</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$name 或者 ${name}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>命令引用:</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Name=`command` 或者 name =$(command)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">查看变量 set </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">删除变量: unset name </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>环境变量:</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Export name=value 或者  declare -x name=value</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">查看环境变量; env ,printenv ,export,declare -x</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>只读变量: 只能申明定义，后续不能修改</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Readonly name , declare -r name</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>参数</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">1、$#：表示执行脚本传入参数的个数</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2、$*：表示执行脚本传入参数的列表（不包括$0）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">3、$$：表示进程的id；Shell本身的PID（ProcessID，即脚本运行的当前 进程ID号）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">4、$!：Shell最后运行的后台Process的PID(后台运行的最后一个进程的 进程ID号)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">5、$@：表示执行脚本传入参数的所有个数（不包括$0）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">6、$0：表示执行的脚本名称</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">7、$1：表示第一个参数</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">8、$2：表示第二个参数</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">9、$?：表示脚本执行的状态，0表示正常，其他表示错误</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>​      Set - - 清空所有的位置变量</p>
<p>退出状态码变量：</p>
<p>​      $? 值为0 成功，  $? 1-255代表失败</p>
<p>​      #生成 0 - 49 之间随机数 echo $[$RANDOM%50]</p>
<p>#随机字体颜色 [root@centos8 ~]#echo -e &quot;\033[1;$[RANDOM%7+31]mmagedu\033[0m&quot;</p>
<div class="language-txt codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-txt codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">-gt 是否大于</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-ge 是否大于等于</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-eq 是否等于</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-ne 是否不等于</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-lt 是否小于</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-le 是否小于等于</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-z &quot;STRING&quot; 字符串是否为空，空为真，不空为假 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-n &quot;STRING&quot; 字符串是否不空，不空为真，空为假</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">\&gt; ascii码是否大于ascii码</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">=~ 左侧字符串是否能够被右侧的PATTERN所匹配 注意: 此表达式用于[[ ]]中；扩展的正则表达式</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>文件测试</strong></p>
<div class="language-txt codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-txt codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">-a FILE：同 -e </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-e FILE: 文件存在性测试，存在为真，否则为假 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-b FILE：是否存在且为块设备文件 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-c FILE：是否存在且为字符设备文件 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-d FILE：是否存在且为目录文件 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-f FILE：是否存在且为普通文件 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-h FILE 或 -L FILE：存在且为符号链接文件 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-p FILE：是否存在且为命名管道文件 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-S FILE：是否存在且为套接字文件</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>配置文件执行顺序：</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/etc/profile --&gt; /etc/profile.d/*.sh --&gt; ~/.bash_profile --&gt; ~/.bashrc --&gt; /etc/bashrc</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>profile类和bashrc类</p>
<p>profile类为交互式登录的shell提供配置</p>
<p>全局：/etc/profile, /etc/profile.d/*.sh</p>
<p>个人：~/.bash_profile</p>
<p>功用：</p>
<p>(1) 用于定义环境变量</p>
<p>(2) 运行命令或脚本</p>
<p>Bashrc类</p>
<p>bashrc类：为非交互式和交互式登录的shell提供配置</p>
<p>(1) 全局：/etc/bashrc</p>
<p>(2) 个人：~/.bashrc</p>
<p>功用： (1) 定义命令别名和函数 (2) 定义本地变量</p>
<p>条件判断case语句</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">case 变量引用 in</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">PAT1)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 分支1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> ;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">PAT2)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 分支2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> ;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">*)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 默认分支</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> ;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">esac</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="https://iteshell.oss-cn-beijing.aliyuncs.com/bookshell/operator/image-20231102185004617.png" alt="image-20231102185004617" class="img_ev3q"></p>
<p>#返回字符串变量var的长度 ${#var}</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="linux-namespace">linux namespace<a href="#linux-namespace" class="hash-link" aria-label="linux namespace的直接链接" title="linux namespace的直接链接">​</a></h2>
<p>对于容器技术而言，它实现资源层面上的限制和隔离，依赖于 Linux 内核所提供的 cgroup 和 namespace 技术。</p>
<p>我们先对这两项技术的作用做个概括：</p>
<ul>
<li>cgroup 的主要作用：管理资源的分配、限制；</li>
<li>namespace 的主要作用：封装抽象，限制，隔离，使命名空间内的进程看起来拥有他们自己的全局资源；</li>
</ul>
<p>本篇，我们重点来聊 namespace 。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="最早期---plan-9">最早期 - Plan 9<a href="#最早期---plan-9" class="hash-link" aria-label="最早期 - Plan 9的直接链接" title="最早期 - Plan 9的直接链接">​</a></h4>
<p>我们引用 <a href="https://en.wikipedia.org/wiki/Linux_namespaces" target="_blank" rel="noopener noreferrer">wiki</a> 上对 namespace 的定义：</p>
<blockquote>
<p>Namespaces are a feature of the Linux kernel that partitions kernel resources such that one set of processes sees one set of resources while another set of processes sees a different set of resources. The feature works by having the same namespace for a set of resources and processes, but those namespaces refer to distinct resources.</p>
</blockquote>
<p>namespace 是 Linux 内核的一项特性，它可以对内核资源进行分区，使得一组进程可以看到一组资源；而另一组进程可以看到另一组不同的资源。该功能的原理是为一组资源和进程使用相同的 namespace，但是这些 namespace 实际上引用的是不同的资源。</p>
<p>这样的说法未免太绕了些，简单来说 namespace 是由 Linux 内核提供的，用于进 程间资源隔离的一种技术。将全局的系统资源包装在一个抽象里，让进程（看起来）拥有独立的全局资源实例。同时 Linux 也默认提供了多种 namespace，用于对多种不同资源进行隔离。</p>
<p>在之前，我们单独使用 namespace 的场景比较有限，但 namespace 却是容器化技术的基石。</p>
<p>我们先来看看它的发展历程。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="最早期---plan-9-1">最早期 - Plan 9<a href="#最早期---plan-9-1" class="hash-link" aria-label="最早期 - Plan 9的直接链接" title="最早期 - Plan 9的直接链接">​</a></h4>
<p><img decoding="async" loading="lazy" src="https://iteshell.oss-cn-beijing.aliyuncs.com/bookshell/operator/rRA1dQx69butYTZ.jpg" alt="img" class="img_ev3q"></p>
<p><strong>图 1 ，namespace 的历史过程</strong></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="最早期---plan-9-2">最早期 - Plan 9<a href="#最早期---plan-9-2" class="hash-link" aria-label="最早期 - Plan 9的直接链接" title="最早期 - Plan 9的直接链接">​</a></h4>
<p>namespace 的早期提出及使用要追溯到 Plan 9 from Bell Labs ，贝尔实验室的 Plan 9。这是一个分布式操作系统，由贝尔实验室的计算科学研究中心在八几年至02年开发的（02年发布了稳定的第四版，距离92年发布的第一个公开版本已10年打磨），现在仍然被操作系统的研究者和爱好者开发使用。在 Plan 9 的设计与实现中，我们着重提以下3点内容：</p>
<ul>
<li>文件系统：所有系统资源都列在文件系统中，以 Node 标识。所有的接口也作为文件系统的一部分呈现。</li>
<li>Namespace：能更好的应用及展示文件系统的层次结构，它实现了所谓的 “分离”和“独立”。</li>
<li>标准通信协议：9P协议（Styx/9P2000）。</li>
</ul>
<p><img decoding="async" loading="lazy" src="https://iteshell.oss-cn-beijing.aliyuncs.com/bookshell/operator/ye5wSuNMnJoc6TU.jpg" alt="img" class="img_ev3q"></p>
<p><strong>图 2 ，Plan 9 from Bell Labs 图标</strong></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="开始加入-linux-kernel">开始加入 Linux Kernel<a href="#开始加入-linux-kernel" class="hash-link" aria-label="开始加入 Linux Kernel的直接链接" title="开始加入 Linux Kernel的直接链接">​</a></h4>
<p>Namespace 开始进入 Linux Kernel 的版本是在 2.4.X，最初始于 2.4.19 版本。但是，自 2.4.2 版本才开始实现每个进程的 namespace。</p>
<p><img decoding="async" loading="lazy" src="https://iteshell.oss-cn-beijing.aliyuncs.com/bookshell/operator/KeakXfEFsMjoLPz.jpg" alt="img" class="img_ev3q"></p>
<p><strong>图 3 ，Linux Kernel Note</strong></p>
<p><img decoding="async" loading="lazy" src="https://iteshell.oss-cn-beijing.aliyuncs.com/bookshell/operator/YlNU6uBeWdEJhgG.png" alt="img" class="img_ev3q"></p>
<p><strong>图 4 ，Linux Kernel 对应的各操作系统版本</strong></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="linux-38-基本实现">Linux 3.8 基本实现<a href="#linux-38-基本实现" class="hash-link" aria-label="Linux 3.8 基本实现的直接链接" title="Linux 3.8 基本实现的直接链接">​</a></h4>
<p>Linux 3.8 中终于完全实现了 <code>User</code> Namespace 的相关功能集成到内核。这样 Docker 及其他容器技术所用到的 namespace 相关的能力就基本都实现了。</p>
<p><img decoding="async" loading="lazy" src="https://iteshell.oss-cn-beijing.aliyuncs.com/bookshell/operator/5HBV3ylXepPijvD.png" alt="img" class="img_ev3q"></p>
<p><strong>图 5 ，Linux Kernel 从 2001 到2013 逐步演变，完成了 namespace 的实现</strong></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="namespace-类型">Namespace 类型<a href="#namespace-类型" class="hash-link" aria-label="Namespace 类型的直接链接" title="Namespace 类型的直接链接">​</a></h4>
<table><thead><tr><th>namespace名称</th><th>使用的标识 - Flag</th><th>控制内容</th></tr></thead><tbody><tr><td>Cgroup</td><td>CLONE_NEWCGROUP</td><td>Cgroup root directory cgroup 根目录</td></tr><tr><td>IPC</td><td>CLONE_NEWIPC</td><td>System V IPC, POSIX message queues信号量，消息队列</td></tr><tr><td>Network</td><td>CLONE_NEWNET</td><td>Network devices, stacks, ports, etc.网络设备，协议栈，端口等等</td></tr><tr><td>Mount</td><td>CLONE_NEWNS</td><td>Mount points挂载点</td></tr><tr><td>PID</td><td>CLONE_NEWPID</td><td>Process IDs进程号</td></tr><tr><td>Time</td><td>CLONE_NEWTIME</td><td>时钟</td></tr><tr><td>User</td><td>CLONE_NEWUSER</td><td>用户和组 ID</td></tr><tr><td>UTS</td><td>CLONE_NEWUTS</td><td>系统主机名和 NIS(Network Information Service) 主机名（有时称为域名）</td></tr></tbody></table>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="cgroup-namespaces">Cgroup namespaces<a href="#cgroup-namespaces" class="hash-link" aria-label="Cgroup namespaces的直接链接" title="Cgroup namespaces的直接链接">​</a></h4>
<p>Cgroup namespace 是进程的 cgroups 的虚拟化视图，通过 <code>/proc/[pid]/cgroup</code> 和 <code>/proc/[pid]/mountinfo</code> 展示。</p>
<p>使用 cgroup namespace 需要内核开启 <code>CONFIG_CGROUPS</code> 选项。可通过以下方式验证：</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">MoeLove</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> ➜ grep CONFIG_CGROUPS </span><span class="token operator" style="color:#393A34">/</span><span class="token plain">boot</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">config</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">$</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">uname </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">r</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CONFIG_CGROUPS</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">y</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>cgroup namespace 提供的了一系列的隔离支持：</p>
<ul>
<li>防止信息泄漏（容器不应该看到容器外的任何信息）。</li>
<li>简化了容器迁移。</li>
<li>限制容器进程资源，因为它会把 cgroup 文件系统进行挂载，使得容器进程无法获取上层的访问权限。</li>
</ul>
<p>每个 cgroup namespace 都有自己的一组 cgroup 根目录。这些 cgroup 的根目录是在 <code>/proc/[pid]/cgroup</code> 文件中对应记录的相对位置的基点。当一个进程用 <code>CLONE_NEWCGROUP</code>（clone(2) 或者 unshare(2)） 创建一个新的 cgroup namespace时，它当前的 cgroups 的目录就变成了新 namespace 的 cgroup 根目录。</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">(MoeLove) ➜ cat /proc/self/cgroup </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0::/user.slice/user-1000.slice/session-2.scope</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>当一个目标进程从 <code>/proc/[pid]/cgroup</code> 中读取 cgroup 关系时，每个记录的路径名会在第三字段中展示，会关联到正在读取的进程的相关 cgroup 分层结构的根目录。如果目标进程的 cgroup 目录位于正在读取的进程的 cgroup namespace 根目录之外时，那么，路径名称将会对每个 cgroup 层次中的上层节点显示 <code>../</code> 。</p>
<p>我们来看看下面的示例（这里以 cgroup v1 为例，如果你想看 v2 版本的示例，请在留言中告诉我）：</p>
<ol>
<li>在初始的 cgroup namespace 中，我们使用 root （或者有 root 权限的用户），在 freezer 层下创建一个子 cgroup 名为 <code>moelove-sub</code>，同时，将进程放入该 cgroup 进行限制。</li>
</ol>
<div class="language-plain codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-plain codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">(MoeLove) ➜ mkdir -p /sys/fs/cgroup/freezer/moelove-sub</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(MoeLove) ➜ sleep 6666666 &amp; </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[1] 1489125                  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(MoeLove) ➜ echo 1489125 &gt; /sys/fs/cgroup/freezer/moelove-sub/cgroup.procs</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ol>
<li>我们在 freezer 层下创建另外一个子 cgroup，名为 <code>moelove-sub2</code>， 并且再放入执行进程号。可以看到当前的进程已经纳入到 <code>moelove-sub2</code>的 cgroup 下管理了。</li>
</ol>
<div class="language-plain codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-plain codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">(MoeLove) ➜ mkdir -p /sys/fs/cgroup/freezer/moelove-sub2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(MoeLove) ➜ echo $$</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1488899</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(MoeLove) ➜ echo 1488899 &gt; /sys/fs/cgroup/freezer/moelove-sub2/cgroup.procs </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(MoeLove) ➜ cat /proc/self/cgroup |grep freezer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">7:freezer:/moelove-sub2</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ol>
<li>我们使用 <code>unshare(1)</code> 创建一个进程，这里使用了 <code>-C</code>参数表示是新的 cgroup namespace， 使用了 <code>-m</code>参数表示是新的 mount namespace。</li>
</ol>
<div class="language-plain codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-plain codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">(MoeLove) ➜ unshare -Cm bash</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root@moelove:~#</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ol>
<li>从用 unshare(1) 启动的新 shell 中，我们可以在 <code>/proc/[pid]/cgroup</code> 文件中看到，新 shell 和以上示例中的进程：</li>
</ol>
<div class="language-plain codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-plain codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">root@moelove:~# cat /proc/self/cgroup | grep freezer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">7:freezer:/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root@moelove:~# cat /proc/1/cgroup | grep freezer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">7:freezer:/..</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 第一个示例进程</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root@moelove:~# cat /proc/1489125/cgroup | grep freezer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">7:freezer:/../moelove-sub</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ol>
<li>从上面的示例中，我们可以看到新 shell 的 freezer cgroup 关系中，当新的 cgroup namespace 创建时，freezer cgroup 的根目录与它的关系也就建立了。</li>
</ol>
<div class="language-plain codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-plain codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">root@moelove:~# cat /proc/self/mountinfo | grep freezer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1238 1230 0:37 /.. /sys/fs/cgroup/freezer rw,nosuid,nodev,noexec,relatime - cgroup cgroup rw,freezer</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ol>
<li>第四个字段 ( <code>/..</code>) 显示了在 cgroup 文件系统中的挂载目录。从 cgroup namespaces 的定义中，我们可以知道，进程当前的 freezer cgroup 目录变成了它的根目录，所以这个字段显示 <code>/..</code> 。我们可以重新挂载来处理它。</li>
</ol>
<div class="language-plain codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-plain codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">root@moelove:~# mount --make-rslave /</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root@moelove:~# umount /sys/fs/cgroup/freezer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root@moelove:~# mount -t cgroup -o freezer freezer /sys/fs/cgroup/freezer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root@moelove:~# cat /proc/self/mountinfo | grep freezer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1238 1230 0:37 / /sys/fs/cgroup/freezer rw,relatime - cgroup freezer rw,freezer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root@moelove:~# mount |grep freezer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">freezer on /sys/fs/cgroup/freezer type cgroup (rw,relatime,freezer)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="ipc-namespaces">IPC namespaces<a href="#ipc-namespaces" class="hash-link" aria-label="IPC namespaces的直接链接" title="IPC namespaces的直接链接">​</a></h4>
<p>IPC namespaces 隔离了 IPC 资源，如 System V IPC objects、 POSIX message queues。每个 IPC namespace 都有着自己的一组 System V IPC 标识符，以及 POSIX 消息队列系统。在一个 IPC namespace 中创建的对象，对所有该 namespace 下的成员均可见（对其他 namespace 下的成员均不可见）。</p>
<p>使用 IPC namespace 需要内核支持 CONFIG_IPC_NS 选项。如下：</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">MoeLove</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> ➜ grep CONFIG_IPC_NS </span><span class="token operator" style="color:#393A34">/</span><span class="token plain">boot</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">config</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">$</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">uname </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">r</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CONFIG_IPC_NS</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">y</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>可以在 IPC namespace 中设置以下 <code>/proc</code> 接口：</p>
<ul>
<li><code>/proc/sys/fs/mqueue</code> - POSIX 消息队列接口</li>
<li><code>/proc/sys/kernel</code> - System V IPC 接口 （msgmax, msgmnb, msgmni, sem, shmall, shmmax, shmmni, shm_rmid_forced）</li>
<li><code>/proc/sysvipc</code> - System V IPC 接口</li>
</ul>
<p>当 IPC namespace 被销毁时（空间里的最后一个进程都被停止删除时），在 IPC namespace 中创建的 object 也会被销毁。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="network-namespaces">Network namespaces<a href="#network-namespaces" class="hash-link" aria-label="Network namespaces的直接链接" title="Network namespaces的直接链接">​</a></h4>
<p>Network namespaces 隔离了与网络相关的系统资源（这里罗列一些）：</p>
<ul>
<li>network devices - 网络设备</li>
<li>IPv4 and IPv6 protocol stacks - IPv4、IPv6 的协议栈</li>
<li>IP routing tables - IP 路由表</li>
<li>firewall rules - 防火墙规则</li>
<li>/proc/net （即 /proc/PID/net）</li>
<li>/sys/class/net</li>
<li>/proc/sys/net 目录下的文件</li>
<li>端口、socket</li>
<li>UNIX domain abstract socket namespace</li>
</ul>
<p>使用 Network namespaces 需要内核支持 CONFIG_NET_NS 选项。如下：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">(MoeLove) ➜ grep CONFIG_NET_NS /boot/config-$(uname -r)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CONFIG_NET_NS=y</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>一个物理网络设备只能存在于一个 Network namespace 中。当一个 Network namespace 被释放时（空间里的最后一个进程都被停止删除时），物理网络设备将被移动到初始的 Network namespace 而不是上层的 Network namespace。</p>
<p>一个虚拟的网络设备(veth(4)) ，在 Network namespace 间通过一个类似管道的方式进行连接。这使得它能存在于多个 Network namespace，但是，当 Network namespace 被摧毁时，该空间下包含的 veth(4) 设备可能被破坏。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="mount-namespaces">Mount namespaces<a href="#mount-namespaces" class="hash-link" aria-label="Mount namespaces的直接链接" title="Mount namespaces的直接链接">​</a></h4>
<p>Mount namespaces 最早出现在 Linux 2.4.19 版本。Mount namespaces 隔离了各空间中挂载的进程实例。每个 mount namespace 的实例下的进程会看到不同的目录层次结构。</p>
<p>每个进程在 mount namespace 中的描述可以在下面的文件视图中看到：</p>
<ul>
<li><code>/proc/[pid]/mounts</code></li>
<li><code>/proc/[pid]/mountinfo</code></li>
<li><code>/proc/[pid]/mountstats</code></li>
</ul>
<p>一个新的 Mount namespace 的创建标识是 CLONE_NEWNS ，使用了 clone(2) 或者 unshare(2) 。</p>
<ul>
<li>如果 Mount namespace 用 clone(2) 创建，子 namespace 的挂载列表是从父进程的 mount namespace 拷贝的。</li>
<li>如果 Mount namespace 用 unshare(2) 创建，新 namespace 的挂载列表是从调用者之前的 moun namespace 拷贝的。</li>
</ul>
<p>如果 mount namespace 发生了修改，会引起什么样的连锁反应？下面，我们就在 <strong>共享子树</strong>中谈谈。</p>
<p>每个 mount 都被可以有如下标记 ：</p>
<ul>
<li>MS_SHARED - 与组内每个成员分享 events 。也就是说相同的 mount 或者 unmount 将自动发生在组内其他的 mounts 中。反之，mount 或者 unmount 事件 也会影响这次的 event 动作。</li>
<li>MS_PRIVATE - 这个 mount 是私有的。mount 或者 unmount events 都不会影响这次的 event 动作。</li>
<li>MS_SLAVE - mount 或者 unmount events 会从 master 节点传入影响该节点。但是这个节点下的 mount 或者 unmount events 不会影响组内的其他节点。</li>
<li>MS_UNBINDABLE - 这也是个私有的 mount 。任何尝试绑定的 mount 在这个设置下都将失败。</li>
</ul>
<p>在文件 <code>/proc/[pid]/mountinfo</code> 中可以看到 <code>propagation</code> 类型的字段。每个对等组都会由内核生成唯一的 ID ，同一对等组的 mount 都是这个 ID（即，下文中的 X ）。</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">(MoeLove) ➜ cat /proc/self/mountinfo  |grep root  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">65 1 0:33 /root / rw,relatime shared:1 - btrfs /dev/nvme0n1p6 rw,seclabel,compress=zstd:1,ssd,space_cache,subvolid=256,subvol=/root</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1210 65 0:33 /root/var/lib/docker/btrfs /var/lib/docker/btrfs rw,relatime shared:1 - btrfs /dev/nvme0n1p6 rw,seclabel,compress=zstd:1,ssd,space_cache,subvolid=256,subvol=/root</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li>shared<!-- -->:X<!-- --> - 在组 X 中共享。</li>
<li>master<!-- -->:X<!-- --> - 对于组 X 而言是 slave，即，从属于 ID 为 X 的主。</li>
<li>propagate_from<!-- -->:X<!-- --> - 接收从组 X 发出的共享 mount。这个标签总是个 master<!-- -->:X<!-- --> 一同出现。</li>
<li>unbindable - 表示不能被绑定，即，不与其他关联从属。</li>
</ul>
<p>新 mount namespace 的传播类型取决于它的父节点。如果父节点的传播类型是 MS_SHARED ，那么新 mount namespace 的传播类型是 MS_SHARED ，不然  会默认为 MS_PRIVATE。</p>
<p>关于 mount namespaces 我们还需要注意以下几点：</p>
<p>（1）每个 mount namespace 都有一个 owner user namespace。如果新的 mount namespace 和拷贝的 mount namespace 分属于不同的 user namespace ，那么，新的 mount namespace 优先级低。</p>
<p>（2）当创建的 mount namespace 优先级低时，那么，slave 的 mount events 会优先于 shared 的 mount events。</p>
<p>（3）高优先级和低优先级的 mount namespace 有关联被锁定在一起时，他们都不能被单独卸载。</p>
<p>（4）mount(2) 标识和 atime 标识会被锁定，即，不能被传播影响而修改。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="cgroup-相关参考网友文档">cgroup 相关参考网友文档<a href="#cgroup-相关参考网友文档" class="hash-link" aria-label="cgroup 相关参考网友文档的直接链接" title="cgroup 相关参考网友文档的直接链接">​</a></h4>
<p><a href="https://zhuanlan.zhihu.com/p/434731896" target="_blank" rel="noopener noreferrer">https://zhuanlan.zhihu.com/p/434731896</a></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="日志清理">日志清理<a href="#日志清理" class="hash-link" aria-label="日志清理的直接链接" title="日志清理的直接链接">​</a></h2>
<p>清理5天前日志</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">find ./* -mtime +5 -name &quot;*.log.gz&quot; -exec rm -f {} \;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">查找当前目录下所有以.tar结尾的文件然后移动到指定目录：</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">find ./ -name &quot;*.tar&quot;  -exec mv {} ./backup;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">查找当前目录30天以前大于100M的LOG文件并删除：</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">find ./ -name &quot;*.log&quot; -mtime +30 -type f -size  +100M|xargs rm -rf {};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">清理容器日志</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cat /data/scripts/clean_docker_log.sh </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">truncate -s 0   /var/lib/docker/containers/*/*-json.log</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="https://iteshell.oss-cn-beijing.aliyuncs.com/bookshell/operator/image-20231102190225684.png" alt="image-20231102190225684" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="tcpip协议栈">TCP/IP协议栈<a href="#tcpip协议栈" class="hash-link" aria-label="TCP/IP协议栈的直接链接" title="TCP/IP协议栈的直接链接">​</a></h2>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="三次握手">三次握手<a href="#三次握手" class="hash-link" aria-label="三次握手的直接链接" title="三次握手的直接链接">​</a></h4>
<p><a href="https://www.cnblogs.com/dbhui/p/9596465.html" target="_blank" rel="noopener noreferrer">https://www.cnblogs.com/dbhui/p/9596465.html</a></p>
<p><img decoding="async" loading="lazy" src="https://iteshell.oss-cn-beijing.aliyuncs.com/bookshell/operator/image-20231102190429487.png" alt="image-20231102190429487" class="img_ev3q"></p>
<p><img decoding="async" loading="lazy" src="https://iteshell.oss-cn-beijing.aliyuncs.com/bookshell/operator/image-20231102190452559.png" alt="image-20231102190452559" class="img_ev3q"></p>
<p>（1）第一次握手：Client将标志位SYN置为1，随机产生一个值seq=J，并将该数据包发送给Server，Client进入SYN_SENT状态，等待Server确认。</p>
<p>（2）第二次握手：Server收到数据包后由标志位SYN=1知道Client请求建立连接，Server将标志位SYN和ACK都置为1，ack=J+1，随机产生一个值seq=K，并将该数据包发送给Client以确认连接请求，Server进入SYN_RCVD状态。</p>
<p>（3）第三次握手：Client收到确认后，检查ack是否为J+1，ACK是否为1，如果正确则将标志位ACK置为1，ack=K+1，并将该数据包发送给Server，Server检查ack是否为K+1，ACK是否为1，如果正确则连接建立成功，Client和Server进入ESTABLISHED状态，完成三次握手，随后Client与Server之间可以开始传输数据了。</p>
<p>SYN攻击：
在三次握手过程中，Server发送SYN-ACK之后，收到Client的ACK之前的TCP连接称为半连接（half-open connect），此时Server处于SYN_RCVD状态，当收到ACK后，Server转入ESTABLISHED状态。SYN攻击就是Client在短时间内伪造大量不存在的IP地址，并向Server不断地发送SYN包，Server回复确认包，并等待Client的确认，由于源地址是不存在的，因此，Server需要不断重发直至超时，这些伪造的SYN包将产时间占用未连接队列，导致正常的SYN请求因为队列满而被丢弃，从而引起网络堵塞甚至<a href="http://www.2cto.com/os/" target="_blank" rel="noopener noreferrer">系统</a>瘫痪。SYN攻击时一种典型的DDOS攻击，检测SYN攻击的方式非常简单，即当Server上有大量半连接状态且源IP地址是随机的，则可以断定遭到SYN攻击了，使用如下命令可以让之现行：</p>
<p>#netstat -nap | grep SYN_RECV</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="四层握手的几种状态">四层握手的几种状态<a href="#四层握手的几种状态" class="hash-link" aria-label="四层握手的几种状态的直接链接" title="四层握手的几种状态的直接链接">​</a></h4>
<p>待补充</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="11种状态">11种状态<a href="#11种状态" class="hash-link" aria-label="11种状态的直接链接" title="11种状态的直接链接">​</a></h5>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="prometheus中都有metrics监控可以根据情况进行监控">prometheus中都有metrics监控,可以根据情况进行监控<a href="#prometheus中都有metrics监控可以根据情况进行监控" class="hash-link" aria-label="prometheus中都有metrics监控,可以根据情况进行监控的直接链接" title="prometheus中都有metrics监控,可以根据情况进行监控的直接链接">​</a></h5>
<div class="language-txt codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-txt codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">LISTEN：等待从任 何远端 TCP 和端口的连接请求</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SYN_SENT：发送完一个连接请求后等待一个匹配的连接请求</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SYN_RECEIVED：发送连接请求并且接收到匹配的连接请求以后等待连接请求确认</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ESTABLISHED：表示一个打开的连接，接收到的数据可以被投递给用户。连接的数据传输阶段的正常状态</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">FIN_WAIT_1：等待远端 TCP 的连接终止请求，或者等待之前发送的连接终止请求的确认</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">FIN_WAIT_2：等待远端 TCP 的连接终止请求</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CLOSE_WAIT：等待本地用户的连接终止请求</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CLOSING：等待远端 TCP 的连接终止请求确认</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">LAST_ACK：等待先前发送给远端 TCP 的连接终止请求的确认（包括它字节的连接终止请求的确认）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">TIME_WAIT：等待足够的时间过去以确保远端 TCP 接收到它的连接终止请求的确认</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">TIME_WAIT 两个存在的理由：</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          1.可靠的实现 TCP 全双工连接的终止</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          2.允许老 的重复分节在网络中消逝</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CLOSED：不在连接状态（这是为方便描述假想的状态，实际不存在）</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="mysql相关">mysql相关<a href="#mysql相关" class="hash-link" aria-label="mysql相关的直接链接" title="mysql相关的直接链接">​</a></h2>
<p>一、MySQL5.6.16版本的主从复制搭建：
主机A IP：192.168.233.131
主机B IP：192.168.233.132
1）修改mysql的配置文件：</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">（1）开启二进制日志功能</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">（2）server-id = 1  //另外一台设置为2</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>2）在slave数据库上添加授权复制用户，在master数据库上进行授权：</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">create user &#x27;repl&#x27;@&#x27;192.168.1.%&#x27; identified by &#x27;your-password&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GRANT REPLICATION SLAVE ON *.* TO &#x27;repl&#x27;@&#x27;192.168.1.%&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">flush privileges;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>3）在master数据库上执行<code>show master status;</code>命令：（查看）</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mysql&gt; show master status\G;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">*************************** 1. row ***************************</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">File: mysql-master-bin.000005</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Position: 120</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Binlog_Do_DB:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Binlog_Ignore_DB:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Executed_Gtid_Set:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1 row in set (0.00 sec)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">4）在slave数据库上执行：</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mysql&gt; change master to master_host=&#x27;192.168.233.131&#x27;, master_user=&#x27;repl&#x27;,master_password=&#x27;your-password&#x27;,master_auto_position=1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Query OK, 0 rows affected, 2 warnings (0.24 sec)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mysql&gt; start slave;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Query OK, 0 rows affected, 1 warning (0.04 sec)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">5）在slave上执行`show slave status;`查看slave的状态：如果下面这俩个文件都为YES，则表示mysql主从复制搭建成功：</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Slave_IO_Running: Yes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Slave_SQL_Running: Yes</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>二、mysql 主从不一致解决方法
方法一：忽略错误，同步
该方法适用于主从库数据相差不大，或者要求数据可以不完全统一的情况，数据要求不严格的情况
解决：</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">stop slave;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#表示跳过一步错误，后面的数字可变</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">set global sql_slave_skip_counter =1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">start slave;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">之后再用mysql&gt; show slave status\G  查看：</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Slave_IO_Running: Yes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Slave_SQL_Running: Yes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ok，现在主从同步状态正常了</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>主从复制原理</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">主从复制是MySQL提供的基本的技术，主从复制的流程：binlog二进制日志（除了查询其他的更改相关的操作都会记录在binlog里面）、relay log日志和三个线程（master的一个线程和slave的两个线程）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">主从复制的 好处：数据备份，我们甚至可以给它做一个热备份，就是通过MySQL中间件mycat，可以实现容灾，容灾也体现了高可用。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">主从复制的流程：</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">两个日志（binlog二进制日志和relay log日志）和三个线程（master的一个线程和slave的两个线程）。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">主库的更新操作写入binlog二进制日志中（主库需要打开binlog开关）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">master服务器创建一个binlog转储线程，将二进制日志内容发送到从服务器</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">slave机器执行START SLAVE命令会在从服务器创建一个IO线程，接收master的binary log复制到其中继日志（处于内存中，读写快）。 首先slave开始一个工作线程（I/O线程），I/O线程会主动连接master ，然后主库会开启dump线程，dump线程从master的binlog中读取事件并发送给slave的I/O线程，如果dump线程已经跟上master（主库上的dump线程已经把binlog的内容发完了，而且主库上binlog没有产生更多的内容），dump线程会睡眠并等待binlog产生新的事件，slave的I/O线程接收的事件写入中继日志</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">slave的SQL线程处理该过程的最后一步，SQL线程从relay log中读取事件，并执行其中的事件更新slave的数据，使其与master的数据同步。只要SQL线程与I/O线程保持一致，中继日志通常会位于os缓存中，所以中继日志的开销很小</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="https://iteshell.oss-cn-beijing.aliyuncs.com/bookshell/operator/image-20240508010949153.png" alt="image-20240508010949153" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="安全审计">安全审计<a href="#安全审计" class="hash-link" aria-label="安全审计的直接链接" title="安全审计的直接链接">​</a></h2>
<p><strong>分析业务需求和数据分类</strong>：</p>
<ul>
<li>
<p>与业务部门合作，了解哪些数据是敏感的，需要加密和保护。分类数据，以便知道如何处</p>
</li>
<li>
<p>参与安全审计和漏洞扫描，以发现和纠正潜在的安全问题</p>
</li>
<li>
<p>紧急响应：</p>
<ul>
<li>协助建立紧急响应计划，以应对数据泄露或其他安全事件</li>
</ul>
</li>
<li>
<p>部署加密系统：</p>
<ul>
<li>协助信息安全团队部署加密系统，确保其正确运行。</li>
<li>监控加密系统的性能和安全性，及时发现并应对潜在的问题。</li>
</ul>
</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="nginx">nginx<a href="#nginx" class="hash-link" aria-label="nginx的直接链接" title="nginx的直接链接">​</a></h2>
<p>请解释Nginx服务器上的Master和Worker进程分别是什么?</p>
<p>Master进程：读取及评估配置和维持</p>
<p>Worker进程：处理请求</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="mirror">mirror<a href="#mirror" class="hash-link" aria-label="mirror的直接链接" title="mirror的直接链接">​</a></h4>
<p>实现简单流量复制</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">location / {                        # location /指定了源uri为/，也可以定义为其他指定接口</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    mirror /mirrorone;                # mirror /mirror指定镜像uri为/mirror</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    mirror /mirrortwo;                # 有多个需要复制流量的，可以配置多条</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    mirror /mirrortwo;                # 配置多条情况下，将会起到流量放大的作用，即主配置请求一次，镜像端会有两次</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # mirror_request_body on;         # 指定是否镜像请求body部 分，请求自动缓存;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    proxy_pass http://backend;      # 指定处理主流量的后端Server</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">location = /mirrorone {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    internal;       # 指定此location只能被“内部的”请求调用，外部的调用请求会返回”Not found” (404)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    proxy_pass http://test_backend1$request_uri;    # 指定将要复制流量的Server1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">location = /mirrortwo {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    internal;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    proxy_pass http://test_backend2$request_uri;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><a href="https://cloud.tencent.com/developer/article/1842884" target="_blank" rel="noopener noreferrer">https://cloud.tencent.com/developer/article/1842884</a></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="rewrite">rewrite<a href="#rewrite" class="hash-link" aria-label="rewrite的直接链接" title="rewrite的直接链接">​</a></h4>
<p>rewrite功能就是，使用nginx提供的全局变量或自己设置的变量，结合正则表达式和标记位实现URL重写以及重定向。
比如：更换域名后需要保持旧的域名能跳转到新的域名上、某网页发生改变需要跳转到新的页面、网站防盗链等等需求。</p>
<blockquote>
<p>rewrite只能放在server<!-- -->,location<!-- -->,if<!-- -->中，并且默认只能对域名后边的除去传递的参数外的字符串起作用</p>
<p><strong>例如：<a href="http://www.kgc.com/abc/%5Bbbs" target="_blank" rel="noopener noreferrer">http://www.kgc.com/abc/[bbs</a>](<a href="https://so.csdn.net/so/search?q=bbs&amp;spm=1001.2101.3001.7020)/index.php?a=1&amp;b=2" target="_blank" rel="noopener noreferrer">https://so.csdn.net/so/search?q=bbs&amp;spm=1001.2101.3001.7020)/index.php?a=1&amp;b=2</a> 只对/abc/bbs/index.php重写</strong></p>
</blockquote>
<p>版权声明：本文为博主原创文章，遵循 CC 4.0 BY-SA 版权协议，转载请附上原文出处链接和本声明。</p>
<p>原文链接：<a href="https://blog.csdn.net/SmileLife_/article/details/125014507" target="_blank" rel="noopener noreferrer">https://blog.csdn.net/SmileLife_/article/details/125014507</a></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="location">location<a href="#location" class="hash-link" aria-label="location的直接链接" title="location的直接链接">​</a></h4>
<p>1location大致分为三类</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">精准匹配：location = / {...}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">一般匹配：location / {...} </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">正则匹配：location ~ / {...}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>2 location 常用的匹配规则</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">= ：进行普通字符精确匹配，也就是完全匹配。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">^~ ：表示普通字符匹配。使用前缀匹配。如果匹配成功，则不再匹配其它 location。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">~ ：区分大小写的匹配。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">~* ：不区分大小写的匹配。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">!~   ：区分大小写的匹配取非。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">!~* ：不区分大小写的匹配取非。</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>3 location的优先级</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">相同类型的表达式，字符串长的会优先匹配</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">首先精确匹配 =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">其次前缀匹配 ^~</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">其次是按文件中顺序的正则匹配 ~或~*</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">然后匹配不带任何修饰的前缀匹配</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">最后是交给 / 通用匹配</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>4 location 匹配</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">首先看 优先级：精确&gt;前缀&gt;正则&gt;一般&gt;通用</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">优先级相同：正则看上下顺序，上面的优先；一般匹配看长度，最长匹配的优先</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">精确、前缀、正则、一般 都没有匹配到，最后再看通用匹配</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>5 实际网站使用中，至少有三个匹配规则定义</p>
<p>1、第一个必选规则</p>
<ul>
<li>直接匹配网站根，通过域名访问网站首页比较频繁，使用这个会加速处理，比如说官网。</li>
<li>可以是一个静态首页，也可以直接转发给后端应用服务器</li>
</ul>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">location = / {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    root   html;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	index  index.html index.htm;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>2、第二个必选规则</p>
<p>处理静态文件请求，这是nginx作为http服务器的强项；有两种配置模式，目录匹配或后缀匹配,任选其一或搭配使用</p>
<div class="language-cobol codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cobol codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">location ^~ /static/ {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    root /webroot/static/;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">location ~* \.(html|gif|jpg|jpeg|png|css|js|ico)$ {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    root /webroot/res/;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>3、第三个必选规则</p>
<p>就是通用规则，比如用来转发带.php、.jsp后缀的动态请求到后端应用服务器非静态文件请求就默认是动态请求</p>
<div class="language-cobol codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cobol codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">location / {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    proxy_pass http://tomcat_server;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>二、rewrite实例</p>
<p>1、基于域名的跳转</p>
<p>2、基于客户端 IP 访问跳转</p>
<p>3、 基于旧域名跳转到新域名后面加目录</p>
<p>4、基于参数匹配的跳转</p>
<p>5、基于目录下所有 php 结尾的文件跳转</p>
<p>6、基于最普通一条 url 请求的跳转</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="比较rewrite和location">比较rewrite和location<a href="#比较rewrite和location" class="hash-link" aria-label="比较rewrite和location的直接链接" title="比较rewrite和location的直接链接">​</a></h4>
<p>1、相同点：都能实现跳转</p>
<p>2、不同点：</p>
<p>①、rewrite是在同一域名内更改获取资源的路径</p>
<p>②、location是对一类路径控制访问或反向代理，还可以proxy_pass到其他机器</p>
<p>3、rewrite会写在location里，执行顺序</p>
<p>①、执行server块里面的rewrite指令</p>
<p>②、执行location匹配</p>
<p>③、执行选定的location中的rewrite指令</p>
<p><strong>localtion优先级</strong></p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">匹配某个具体文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">（location = 完整路径）&gt;（location ^~ 完整路径）&gt;（location ~* 完整路径）=（location ~ 完整路径）&gt;（location /）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">用目录做匹配访问某个文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">（location = 目录）&gt;（location ^~ 目录）&gt;（location ~* 目录）=（location ~ 目录）&gt;（location /）</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="nginx限流">nginx限流<a href="#nginx限流" class="hash-link" aria-label="nginx限流的直接链接" title="nginx限流的直接链接">​</a></h4>
<p>两个命令</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">限流由两个主要指令limit_req_zone和进行配置limit_req，如下例所示:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">limit_req_zone $binary_remote_addr zone=mylimit:10m rate=10r/s;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">server {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    location /qhyu/ {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        limit_req zone=mylimit;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        proxy_pass http://my_upstream;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">limit_req_zone指令定义了速率限制的参数,zone-请求限制URL的频率的共享内存区域,rate-设置最大请求速率</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">limit_req在它出现的上下文中启用速率限制,速率不能超过每秒10个请求</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="nginx七层代理">nginx七层代理<a href="#nginx七层代理" class="hash-link" aria-label="nginx七层代理的直接链接" title="nginx七层代理的直接链接">​</a></h4>
<p><strong>只能写在http模块的全局配置当中。
upstream: 用于处理http请求，支持反向代理，负载均衡，缓存功能
在upstream模块中可以配置对个服务器</strong></p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">upstream liu {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        server 192.168.10.30;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        server 192.168.10.20;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">location {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        proxy_pass http://test;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="nginx四层代理">nginx四层代理<a href="#nginx四层代理" class="hash-link" aria-label="nginx四层代理的直接链接" title="nginx四层代理的直接链接">​</a></h4>
<p><strong>stream只能写在全局模块当中的单独配置。stream代理无谓协议，只管流量。</strong></p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">stream {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   upstream ilync{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    server 192.168.10.20:8080;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    server 192.168.10.21:8080;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   server {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       listen 80;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       proxy_pass ilync;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">不能用 hash（哈希），只可以使用weight 和 least_conn。</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="基于域名的反向代理">基于域名的反向代理<a href="#基于域名的反向代理" class="hash-link" aria-label="基于域名的反向代理的直接链接" title="基于域名的反向代理的直接链接">​</a></h4>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">upstream ky32 (</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">server www.kgc.com;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">server www.benet.com;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">location {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">proxy_pass http://ky32</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">proxy_set_header HoST $host</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#把请求的主机名发送给后端</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">proxy_set header X-Real-IP $remote_addr;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#后端服务器获取客户端的真实ip地址。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="正向代理和反向代理">正向代理和反向代理<a href="#正向代理和反向代理" class="hash-link" aria-label="正向代理和反向代理的直接链接" title="正向代理和反向代理的直接链接">​</a></h4>
<p>代理对象不同。正向代理代理的是客户端(比如qq通过代理实现上网,服务器端通过socket5来实现代理)，反向代理代理的是服务器。</p>
<p>正向代理帮助客户访问其无法访问的服务器资源，反向代理帮助服务器做负载均衡，另外，由于客户端跟真实服务器不直接接触，能起到一定安全防护的作用。</p>
<p>架设主体不同。正向代理一般是客户端架设的，比如在自己的机器上装一个代理软件，反向代理一般是服务器架设的，通常是在机器集群中部署个反向代理服务器</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/shouji1128955/bookshell/edit/main/docs/Sre/3-面试题/1.基础面试题.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>编辑此页</a></div><div class="col lastUpdated_JAkA"><span class="theme-last-updated">最后<!-- -->由 <b>AMiner</b> <!-- -->于 <b><time datetime="2024-06-22T16:15:00.000Z" itemprop="dateModified">2024年6月22日</time></b> <!-- -->更新</span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="文件选项卡"><a class="pagination-nav__link pagination-nav__link--next" href="/bookshell/docs/Sre/面试题/kubernetes面试题"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">kubernetes面试题</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#linux系统" class="table-of-contents__link toc-highlight">Linux系统</a></li><li><a href="#shell脚本" class="table-of-contents__link toc-highlight">shell脚本</a></li><li><a href="#linux-namespace" class="table-of-contents__link toc-highlight">linux namespace</a></li><li><a href="#日志清理" class="table-of-contents__link toc-highlight">日志清理</a></li><li><a href="#tcpip协议栈" class="table-of-contents__link toc-highlight">TCP/IP协议栈</a></li><li><a href="#mysql相关" class="table-of-contents__link toc-highlight">mysql相关</a></li><li><a href="#安全审计" class="table-of-contents__link toc-highlight">安全审计</a></li><li><a href="#nginx" class="table-of-contents__link toc-highlight">nginx</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://shouji1128955.github.io" target="_blank" rel="noopener noreferrer" class="footer__link-item">LiteShell<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://kubernetes.io/" target="_blank" rel="noopener noreferrer" class="footer__link-item">kubernetes<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://mindoc.zlqit.com" target="_blank" rel="noopener noreferrer" class="footer__link-item">mindoc<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/shouji1128955" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 My Blog Project - LiteShell</div></div></div></footer></div>
</body>
</html>