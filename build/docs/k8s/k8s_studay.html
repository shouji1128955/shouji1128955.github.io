<!doctype html>
<html lang="zh-CN" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-k8s/k8s_studay" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.5.2">
<title data-rh="true">k8s_studay | LiteShell</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://docusaurus.io/zh-CN/img/undraw_typewriter.svg"><meta data-rh="true" name="twitter:image" content="https://docusaurus.io/zh-CN/img/undraw_typewriter.svg"><meta data-rh="true" property="og:url" content="https://shouji1128955.github.io/bookshell/docs/k8s/k8s_studay"><meta data-rh="true" property="og:locale" content="zh_CN"><meta data-rh="true" property="og:locale:alternate" content="en"><meta data-rh="true" name="docusaurus_locale" content="zh-CN"><meta data-rh="true" name="docsearch:language" content="zh-CN"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="k8s_studay | LiteShell"><meta data-rh="true" name="description" content="1、容器运行时"><meta data-rh="true" property="og:description" content="1、容器运行时"><link data-rh="true" rel="icon" href="/bookshell/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://shouji1128955.github.io/bookshell/docs/k8s/k8s_studay"><link data-rh="true" rel="alternate" href="https://shouji1128955.github.io/bookshell/docs/k8s/k8s_studay" hreflang="zh-CN"><link data-rh="true" rel="alternate" href="https://shouji1128955.github.io/bookshell/en/docs/k8s/k8s_studay" hreflang="en"><link data-rh="true" rel="alternate" href="https://shouji1128955.github.io/bookshell/docs/k8s/k8s_studay" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/bookshell/blog/rss.xml" title="LiteShell RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/bookshell/blog/atom.xml" title="LiteShell Atom Feed"><link rel="stylesheet" href="/bookshell/assets/css/styles.fb7577d1.css">
<script src="/bookshell/assets/js/runtime~main.c0446ed9.js" defer="defer"></script>
<script src="/bookshell/assets/js/main.d13dfaa7.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="跳到主要内容"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">跳到主要内容</a></div><nav aria-label="主导航" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/bookshell/"><div class="navbar__logo"><img src="/bookshell/img/logo.svg" alt="LiteShell" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/bookshell/img/logo.svg" alt="LiteShell" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">LiteShell</b></a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Sre</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/bookshell/docs/Sre/日常运维/operator">日常运维</a></li><li><a class="dropdown__link" href="/bookshell/docs/Sre/中间件/Harbor">中间件</a></li><li><a class="dropdown__link" href="/bookshell/docs/Sre/面试题/基础面试题">面试题</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Kubernetes</a><ul class="dropdown__menu"><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/bookshell/docs/k8s/operator">Kubernetes</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Prometheus</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/bookshell/docs/Prometheus/grafana">grafana</a></li><li><a class="dropdown__link" href="/bookshell/docs/Prometheus/prometheus/告警指标汇总">Prometheus</a></li><li><a class="dropdown__link" href="/bookshell/docs/Prometheus/alertManager/alertmanager告警配置">AlertManager</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">DevOps</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/bookshell/docs/DevOps/jenkins/jenkins安装配置/jenkins安装配置">jenkins</a></li><li><a class="dropdown__link" href="/bookshell/docs/DevOps/gitOps/tekton安装">gitOps</a></li><li><a class="dropdown__link" href="/bookshell/docs/DevOps/ELK/ELK测试部署">ELK</a></li><li><a class="dropdown__link" href="/bookshell/docs/DevOps/skywalking/zookeeper安装">skywalking</a></li><li><a class="dropdown__link" href="/bookshell/docs/DevOps/observability/OpenTelemetry">observability</a></li><li><a class="dropdown__link" href="/bookshell/docs/DevOps/terraform/terraform">terraform</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Golang</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/bookshell/docs/Golang/golang基础/Go核心编程2023/golang">golang基础</a></li><li><a class="dropdown__link" href="/bookshell/docs/Golang/golang进阶/gin框架2023/Gin框架">golang进阶</a></li><li><a class="dropdown__link" href="/bookshell/docs/Golang/golang运维/项目1-Bingo/Bingo">golang运维</a></li><li><a class="dropdown__link" href="/bookshell/docs/Golang/VUE/vue入门教程/html基础">Vue</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">JAVA</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/bookshell/docs/Java/JAVA/admin组件">Java</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Treasure</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/bookshell/docs/Treasure/Wisdom/国学经典">Plan and strategize</a></li><li><a class="dropdown__link" href="/bookshell/docs/Treasure/Studytour/莱卡">read book</a></li></ul></div><a class="navbar__item navbar__link" href="/bookshell/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="切换浅色/暗黑模式（当前为浅色模式）" aria-label="切换浅色/暗黑模式（当前为浅色模式）" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><div class="navbar__search searchBarContainer_NW3z" dir="ltr"><input placeholder="搜索" aria-label="Search" class="navbar__search-input"><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="文档侧边栏" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/bookshell/docs/k8s/operator">operator</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/bookshell/docs/k8s/k8s_studay">k8s_studay</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/bookshell/docs/k8s/helm">helm</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/bookshell/docs/k8s/kubernetes_cka">kubernetes_cka</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/bookshell/docs/k8s/更新内核">更新内核</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/bookshell/docs/k8s/ansible安装k8s-1.24.12">ansible安装k8s-1.24.12</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/bookshell/docs/k8s/Controller">控制器 CRD 介绍</a></li></ul></nav><button type="button" title="收起侧边栏" aria-label="收起侧边栏" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="页面路径"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="主页面" class="breadcrumbs__link" href="/bookshell/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">k8s_studay</span><meta itemprop="position" content="1"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">本页总览</button></div><div class="theme-doc-markdown markdown"><header><h1>k8s_studay</h1></header><h2 class="anchor anchorWithStickyNavbar_LWe7" id="1容器运行时">1、容器运行时<a href="#1容器运行时" class="hash-link" aria-label="1、容器运行时的直接链接" title="1、容器运行时的直接链接">​</a></h2>
<p>容器在kubernetes中几种场景</p>
<ul>
<li>Docker 作为 k8s 容器运行时，调用关系如下：</li>
<li>kubelet --&gt; docker shim （在 kubelet 进程中） --&gt; dockerd --&gt; containerd</li>
<li>Containerd 作为 k8s 容器运行时，调用关系如下：</li>
<li>kubelet --&gt; cri plugin（在 containerd 进程中） --&gt; containerd</li>
</ul>
<p>容器运行时跟k8s的版本的对应关系参考</p>
<p><a href="https://github.com/containerd/containerd/blob/main/RELEASES.md#deprecated-features" target="_blank" rel="noopener noreferrer">https://github.com/containerd/containerd/blob/main/RELEASES.md#deprecated-features</a></p>
<p><a href="https://github.com/containerd/containerd/blob/main/docs/getting-started.md" target="_blank" rel="noopener noreferrer">https://github.com/containerd/containerd/blob/main/docs/getting-started.md</a></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="11kubernetes-support">1.1、Kubernetes Support<a href="#11kubernetes-support" class="hash-link" aria-label="1.1、Kubernetes Support的直接链接" title="1.1、Kubernetes Support的直接链接">​</a></h3>
<p>The Kubernetes version matrix represents the versions of containerd which are recommended for a Kubernetes release. Any actively supported version of containerd may receive patches to fix bugs encountered in any version of Kubernetes, however, our recommendation is based on which versions have been the most thoroughly tested. See the <a href="https://testgrid.k8s.io/sig-node-containerd" target="_blank" rel="noopener noreferrer">Kubernetes test grid</a> for the list of actively tested versions. Kubernetes only supports n-3 minor release versions and containerd will ensure there is always a supported version of containerd for every supported version of Kubernetes.</p>
<table><thead><tr><th>Kubernetes Version</th><th>containerd Version</th><th>CRI Version</th></tr></thead><tbody><tr><td>1.26</td><td>1.7.0+, 1.6.15+</td><td>v1, v1alpha2 **</td></tr><tr><td>1.27</td><td>1.7.0+, 1.6.15+</td><td>v1</td></tr><tr><td>1.28</td><td>1.7.0+, 1.6.15+</td><td>v1</td></tr><tr><td>1.29</td><td>1.7.11+, 1.6.27+</td><td>v1</td></tr><tr><td>1.30</td><td>2.0(wip), 1.7.13+, 1.6.28+</td><td>v1</td></tr><tr><td>1.31</td><td>2.0(wip), 1.7.20+, 1.6.34+</td><td>v1</td></tr></tbody></table>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="2affinity亲和性">2、affinity亲和性<a href="#2affinity亲和性" class="hash-link" aria-label="2、affinity亲和性的直接链接" title="2、affinity亲和性的直接链接">​</a></h2>
<p>实现对Pod均衡的调度到某些节点</p>
<p>需要对节点添加污点</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  template:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      creationTimestamp: null</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      labels:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        app: topo-dep</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 软性要求</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 如果节点上的pod标签存在满足app=topo-dep，也可以部署到节点上，尽可能先部署到其它节点，如果没有满足也可以部署到此节点</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    spec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      affinity:                  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        podAntiAffinity:             #pod反亲和</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          preferredDuringSchedulingIgnoredDuringExecution:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          - weight: 100              #根据权重分配</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            podAffinityTerm:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              labelSelector:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                matchExpressions:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                - key: &quot;app&quot;        #对于app=topo-dep的pod尽量不调度到该节点</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                  operator: In</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                  values: </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                  - topo-dep</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              topologyKey: &quot;kubernetes.io/hostname&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>以上是软性要求，可以配置硬性要求</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 硬性要求</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 如果节点上的pod标签存在满足app=nginx，则不能部署到节点上</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    spec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      affinity:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        podAntiAffinity:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          requiredDuringSchedulingIgnoredDuringExecution:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          - labelSelector:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              matchExpressions:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              - key: app</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                operator: In</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                values:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                - nginx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            topologyKey: &quot;kubernetes.io/hostname&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="21food-match-案例讲解">2.1、food-match 案例讲解<a href="#21food-match-案例讲解" class="hash-link" aria-label="2.1、food-match 案例讲解的直接链接" title="2.1、food-match 案例讲解的直接链接">​</a></h3>
<p>先给服务器添加lable</p>
<p>kubec label nodes sanjiu-uat-0001 node_app=sanjiu</p>
<p>kubec label nodes sanjiu-uat-0002 node_app=sanjiu</p>
<p>kubec label nodes sanjiu-uat-0003 node_app=sanjiu</p>
<p>首先需要给业务在部署的时候添加label, 比如给deployment文件中 添加 app=food-match</p>
<p>1.集群新增三个节点,sanjiu-uat-0001,sanjiu-uat-0002,sanjiu-uat-0003，这三个节点不能让其他服务调度过来</p>
<p>方法： 添加污点</p>
<p>kubectl taint nodes sanjiu-uat-0001 name=sanjiu<!-- -->:NoSchedule</p>
<p>kubectl taint nodes sanjiu-uat-0002 name=sanjiu<!-- -->:NoSchedule</p>
<p>kubectl taint nodes sanjiu-uat-0003 name=sanjiu<!-- -->:NoSchedule</p>
<p>deploy文件参考如下</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">      tolerations:   #容忍污点</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - key: name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        value: sanjiu</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        effect: NoSchedule	</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      nodeSelector:  #选择node带标签的节点</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        node_app: sanjiu</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      affinity:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        podAntiAffinity: #pod反亲和</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          preferredDuringSchedulingIgnoredDuringExecution:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          - weight: 100</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            podAffinityTerm:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              labelSelector:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                matchExpressions:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                - key: &quot;app&quot;      #对于app=food-match进行反亲和，就是一个节点尽量一个pod</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                  operator: In</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                  values: </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                  - food-match</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              topologyKey: &quot;kubernetes.io/hostname&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>2.先调度到sanjiu-uat-0001,sanjiu-uat-0002，各一个Pod，但是不能调度到sanjiu-uat-0003</p>
<p>方法:
在sanjiu-uat-0003执行
kubec label nodes sanjiu-uat-0003 node_app=sanjiu-</p>
<p>deploy文件参考如下</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">      tolerations:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - key: name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        value: sanjiu</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        effect: NoSchedule	</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      nodeSelector:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        node_app: sanjiu</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      affinity:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        podAntiAffinity:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          preferredDuringSchedulingIgnoredDuringExecution:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          - weight: 100</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            podAffinityTerm:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              labelSelector:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                matchExpressions:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                - key: &quot;app&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                  operator: In</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                  values: </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                  - food-match</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              topologyKey: &quot;kubernetes.io/hostname&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>​</p>
<p>3.调度到sanjiu-uat-0001,sanjiu-uat-0002，sanjiu-uat-0003各一个Pod
方法:
在sanjiu-uat-0003执行
kubec label nodes sanjiu-uat-0003 node_app=sanjiu-</p>
<p>deploy文件参考如下</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">      tolerations:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - key: name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        value: sanjiu</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        effect: NoSchedule	</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      nodeSelector:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        node_app: sanjiu</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      affinity:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        podAntiAffinity:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          preferredDuringSchedulingIgnoredDuringExecution:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          - weight: 100</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            podAffinityTerm:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              labelSelector:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                matchExpressions:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                - key: &quot;app&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                  operator: In</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                  values: </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                  - food-match</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              topologyKey: &quot;kubernetes.io/hostname&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>#io.rancher.scheduler.global: &#x27;true&#x27;
#io.rancher.scheduler.affinity:host_label: node=foodmatch</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="22亲和和反亲和的案例">2.2、亲和和反亲和的案例<a href="#22亲和和反亲和的案例" class="hash-link" aria-label="2.2、亲和和反亲和的案例的直接链接" title="2.2、亲和和反亲和的案例的直接链接">​</a></h3>
<p>ai-api/ai-admin</p>
<p>均衡的调度每个节点-pod反亲和(软)</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	  </span><span class="token key atrule" style="color:#00a4db">nodeSelector</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">node_app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> sanjiu</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">tolerations</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">key</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">value</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> sanjiu</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">effect</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> NoSchedule </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">affinity</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">podAntiAffinity</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">preferredDuringSchedulingIgnoredDuringExecution</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">weight</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">100</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">podAffinityTerm</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token key atrule" style="color:#00a4db">labelSelector</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token key atrule" style="color:#00a4db">matchExpressions</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">key</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> app</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                  </span><span class="token key atrule" style="color:#00a4db">operator</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> In</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                  </span><span class="token key atrule" style="color:#00a4db">values</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> health</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">cloud</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">ai</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">activity</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">api</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token key atrule" style="color:#00a4db">topologyKey</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> kubernetes.io/hostname</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			  </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>均衡的调度每个节点-pod反亲和(硬-节点上的pod标签存在满足app=health-cloud-ai-activity-api，则不能部署到节点上)
部署实例数需要小于匹配污点的固定节点。</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">nodeSelector</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">node_app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> sanjiu</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">tolerations</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">key</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">value</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> sanjiu</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">effect</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> NoSchedule</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">affinity</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">podAntiAffinity</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">requiredDuringSchedulingIgnoredDuringExecution</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">labelSelector</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token key atrule" style="color:#00a4db">matchExpressions</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">key</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> app</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token key atrule" style="color:#00a4db">operator</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> In</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token key atrule" style="color:#00a4db">values</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> health</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">cloud</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">ai</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">activity</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">api</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">topologyKey</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;kubernetes.io/hostname&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<blockquote>
<p>如果pod实例数跟需要绑定的节点数相同的情况下，第一次部署没有问题， 如果需要更新升级，那么需要有多余匹配的节点数，否则会pending, 因为滚动更新不会首次删除节点，所以会额外的筛选资源，这种情况下可以通过修改更新策略来实现。</p>
</blockquote>
<p>下面这个例子，就是保证打了污点的节点能够按照期望的值去部署一个节点，更新的时候，会先删除30%的pod，然后逐一更新</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> strategy:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   type: RollingUpdate</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   rollingUpdate:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     maxSurge: 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     maxUnavailable: 30%</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> selector:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   matchLabels:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     app: topo-dep</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> template:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     creationTimestamp: null</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     labels:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       app: topo-dep</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   spec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     nodeSelector:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       node_app: sanjiu</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     tolerations:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     - key: name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       value: sanjiu</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       effect: NoSchedule</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     affinity:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       podAntiAffinity:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         requiredDuringSchedulingIgnoredDuringExecution:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         - labelSelector:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">             matchExpressions:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">             - key: app</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">               operator: In</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">               values: </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">               - topo-dep</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           topologyKey: &quot;kubernetes.io/hostname&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>maxSurge：  指定升级期间存在的总Pod对象数量最多以超出期望值的个数，其值可以为0或者正整数，也可以是一个期望值的百分比：例如如果期望值是3，当前的属性值为1，则表示Pod对象的总数不能超过4个。
maxUnavailable：升级期间正常可用的Pod副本数（包括新旧版本）最多不能低于期望的个数、其值可以是0或者正整数。也可以是一个期望值的百分比，默认值为1；该值意味着如果期望值是3，那么在升级期间至少要有两个Pod对象处于正常提供服务的状态。</p>
<blockquote>
<p>maxSurge和maxUnavailable的数量不能同时为0，否则Pod对象的复本数量在符合用户期望的数量后无法做出合理变动以进行滚动更新操作。</p>
</blockquote>
<p>   配置时，用户还可以使用 Deployment控制器的 spec.min.Ready.Seconds属性来控制应用升级的速度。新旧更替过程中，新创建的Pod对象一旦成功响应就绪探测即被视作可用，而后即可立即开始下一轮的替换操作。而 spec.minReady.Seconds能够定义在新的Pod对象创建后至少要等待多久才会将其视作就绪，在此期间，更新操作会被阻塞。因此，它可以用来让 Kubernetes在每次创建出Pod资源后都要等上一段时长后再开始下一轮的更替，这个时间长度的理想值是等到Pod对象中的应用已经可以接受并处理请求流量。事实上，一个精心设计的等待时长和就绪性探测能让 Kubernetes系统规避一部分因程序Bug而导致的升级故障。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="3镜像操作">3、镜像操作<a href="#3镜像操作" class="hash-link" aria-label="3、镜像操作的直接链接" title="3、镜像操作的直接链接">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="31拉取指定平台的镜像">3.1、拉取指定平台的镜像<a href="#31拉取指定平台的镜像" class="hash-link" aria-label="3.1、拉取指定平台的镜像的直接链接" title="3.1、拉取指定平台的镜像的直接链接">​</a></h3>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">docker pull --platform amd64  docker.io/calico/kube-controllers:v3.26.3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#docker 导出的tar包支持ctr导入</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">#清理没有使用的镜像</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ctr -n k8s.io image prune --all</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="32镜像导出导入">3.2、镜像导出导入<a href="#32镜像导出导入" class="hash-link" aria-label="3.2、镜像导出导入的直接链接" title="3.2、镜像导出导入的直接链接">​</a></h3>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">#导出镜像</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ctr -n k8s.io image   export  pause.tar  registry.k8s.io/pause:3.9</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#导入镜像</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ctr -n k8s.io image import feature.tar</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[root@master nginx-demo]# kubectl patch deployments myapp-deployment -p &#x27;{&quot;spec&quot;:{&quot;minReadySeconds&quot;:8}}&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">deployment.extensions/myapp-deployment patched (change)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@master nginx-demo]# kubectl set image deployments myapp-deployment myapp=ikubernetes/myapp:v2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">deployment.extensions/myapp-deployment image updated</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>滚动更新时， myapp-deploy控制器会创建一个新的 ReplicaSe控制器对象来管控新版本的Pod对象，升级完成后，旧版本的 Replicase会保留在历史记录中，但其此前的管控Pod对象将会被删除。</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">root@k8s-master:~# kubectl  get replicasets -l app=topo-dep</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                  DESIRED   CURRENT   READY   AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">topo-dep-54b55fb587   2         2         2       105m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">topo-dep-6b66c5b6c7   0         0         0       103m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root@k8s-master:~#  kubectl get pods -l app=topo-dep</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                        READY   STATUS    RESTARTS   AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">topo-dep-54b55fb587-74vxp   1/1     Running   0          42m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">topo-dep-54b55fb587-vc2cp   1/1     Running   0          42m</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="33镜像导出导入脚本">3.3、镜像导出导入脚本<a href="#33镜像导出导入脚本" class="hash-link" aria-label="3.3、镜像导出导入脚本的直接链接" title="3.3、镜像导出导入脚本的直接链接">​</a></h3>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">root@node4:~/img_node/img_node# cat img_export.sh </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#!/bin/bash</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">images=$(ctr -n=k8s.io image ls -q|egrep -v &#x27;sha256&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">for image in $images; do</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    echo &quot;Exporting $image...&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ctr -n=k8s.io image export &quot;$(echo $image | tr &#x27;/&#x27; &#x27;_&#x27;).tar&quot; $image</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">done</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root@node4:~/img_node/img_node# cat img_import.sh </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#!/bin/bash</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">files=(*.tar)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">for file in &quot;${files[@]}&quot;; do</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    echo &quot;Importing $file...&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ctr -n=k8s.io image import &quot;$file&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">done</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="4服务调度策略">4、服务调度策略<a href="#4服务调度策略" class="hash-link" aria-label="4、服务调度策略的直接链接" title="4、服务调度策略的直接链接">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="41回滚策略">4.1、回滚策略<a href="#41回滚策略" class="hash-link" aria-label="4.1、回滚策略的直接链接" title="4.1、回滚策略的直接链接">​</a></h3>
<p>kubectl rollout history 检查Deployment部署历史</p>
<p>kubectl rollout undo deployment/…   --revision=2</p>
<p>暂停策略
kubectl roollout pause deployment/…</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="5节点维护操作">5、节点维护操作<a href="#5节点维护操作" class="hash-link" aria-label="5、节点维护操作的直接链接" title="5、节点维护操作的直接链接">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="51污点添加">5.1、污点添加<a href="#51污点添加" class="hash-link" aria-label="5.1、污点添加的直接链接" title="5.1、污点添加的直接链接">​</a></h3>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl taint nodes sanjiu-uat-0001 name=sanjiu:NoSchedule</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl taint nodes sanjiu-uat-0002 name=sanjiu:NoSchedule</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl taint nodes sanjiu-uat-0003 name=sanjiu:NoSchedule</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="52污点取消">5.2、污点取消<a href="#52污点取消" class="hash-link" aria-label="5.2、污点取消的直接链接" title="5.2、污点取消的直接链接">​</a></h3>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl taint nodes sanjiu-uat-0003 name=sanjiu:NoSchedule-</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/shouji1128955/bookshell/edit/main/docs/k8s/2.k8s_studay.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>编辑此页</a></div><div class="col lastUpdated_JAkA"><span class="theme-last-updated">最后<!-- -->由 <b>zhanglaiqiang</b> <!-- -->于 <b><time datetime="2024-10-01T06:07:28.000Z" itemprop="dateModified">2024年10月1日</time></b> <!-- -->更新</span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="文件选项卡"><a class="pagination-nav__link pagination-nav__link--prev" href="/bookshell/docs/k8s/operator"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">operator</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/bookshell/docs/k8s/helm"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">helm</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#1容器运行时" class="table-of-contents__link toc-highlight">1、容器运行时</a><ul><li><a href="#11kubernetes-support" class="table-of-contents__link toc-highlight">1.1、Kubernetes Support</a></li></ul></li><li><a href="#2affinity亲和性" class="table-of-contents__link toc-highlight">2、affinity亲和性</a><ul><li><a href="#21food-match-案例讲解" class="table-of-contents__link toc-highlight">2.1、food-match 案例讲解</a></li><li><a href="#22亲和和反亲和的案例" class="table-of-contents__link toc-highlight">2.2、亲和和反亲和的案例</a></li></ul></li><li><a href="#3镜像操作" class="table-of-contents__link toc-highlight">3、镜像操作</a><ul><li><a href="#31拉取指定平台的镜像" class="table-of-contents__link toc-highlight">3.1、拉  取指定平台的镜像</a></li><li><a href="#32镜像导出导入" class="table-of-contents__link toc-highlight">3.2、镜像导出导入</a></li><li><a href="#33镜像导出导入脚本" class="table-of-contents__link toc-highlight">3.3、镜像导出导入脚本</a></li></ul></li><li><a href="#4服务调度策略" class="table-of-contents__link toc-highlight">4、服务调度策略</a><ul><li><a href="#41回滚策略" class="table-of-contents__link toc-highlight">4.1、回滚策略</a></li></ul></li><li><a href="#5节点维护操作" class="table-of-contents__link toc-highlight">5、节点维护操作</a><ul><li><a href="#51污点添加" class="table-of-contents__link toc-highlight">5.1、污点添加</a></li><li><a href="#52污点取消" class="table-of-contents__link toc-highlight">5.2、污点取消</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://shouji1128955.github.io" target="_blank" rel="noopener noreferrer" class="footer__link-item">LiteShell<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://kubernetes.io/" target="_blank" rel="noopener noreferrer" class="footer__link-item">kubernetes<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://mindoc.zlqit.com" target="_blank" rel="noopener noreferrer" class="footer__link-item">mindoc<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/shouji1128955" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 My Blog Project - LiteShell</div></div></div></footer></div>
</body>
</html>