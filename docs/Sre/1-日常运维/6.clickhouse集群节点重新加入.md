

## 故障节点重新加入集群

### 1、当前现状

#### 1.1、现状情况： 

由于之前clickhouse03节点磁盘直接打满，节点停止大概二十天时间，局限于扩容磁盘，因为其他节点清理历史的数据，所以腾出来了空间，我们现在需要对clickhouse03节点做完快照后，需要做数据同步.

| 集群节点     | 现状                   | 分片副本     |
| ------------ | ---------------------- | ------------ |
| clickhouse01 | 节点正常               | 分片1，副本1 |
| clickhouse02 | 节点正常               | 分片1，副本2 |
| clickhouse03 | 节点故障(磁盘做了快照) | 分片2，副本1 |
| clickhouse04 | 节点正常               | 分片2，副本2 |







需要的操作，需要将数据从clickhouse04 同步元数据到clickhouse03，以及对应的store目录中的数据





#### 1.2、元数据表文件迁移到clickhouse03

类似下面这种,*.sql这种是数据定义的,需要迁移到clickhouse03对应的目录,以及库所对应的软链接文件,都要迁移到clickhouse03对应的目录

就是类似下面的这种数据

![image-20231224150940700](https://iteshell.oss-cn-beijing.aliyuncs.com/bookshell/operator/image-20231224150940700.png)



#clickhouse03节点操作:   

备份原来的旧数据 /data/container/clickhouse/data/store/下面的所有文件

```shell
mkdir -p /root/clickhouse-20231223bak
cd /data/container/clickhouse/data/store
mv  * /root/clickhouse-20231223bak/
```





#clickhouse04节点导出数据到clickhouse03
#拷贝元数据目录到clickhouse03
#打印确认

```shell
cd /data/container/clickhouse/data/metadata/
ls -l |egrep  -v 'default|system' | awk '{print $NF}' | grep -w  data | awk '{print $7}'
for i in `ls -l |egrep  -v 'default|system' | awk '{print $NF}' | grep -w '/data/container/clickhouse' |  awk -F '/' '{print $7}'`; do  rsync -rvza -e "ssh -p 2022"  /data/container/clickhouse/data/store/${i}  root@192.168.0.150:/data/container/clickhouse/data/store/ ;done

```





#### 1.3、元数据库文件迁移clickhouse03

##打印确认

```shell
cd /data/container/clickhouse/metadata/
ls -l |egrep  -v 'default|system|information_schema|INFORMATION_SCHEMA' | egrep [a-z,A-Z,0-9,_]+.sql | awk '{print $NF}' 
```



clickhouse03节点操作:

备份原来的旧数据 /data/container/clickhouse/data/metadata/下面的所有文件

```shell
#保留system, default相关的库文件和数据表文件,异除其他没用的节点

cp metadata metadata.bak  -r
mv blmdq20231128* ckhdq20200728* data_platform* dghhdq20200728* ghzhl20200602* hdhdq20200728* /tmp/
mv kchtljzdqxxssfjc20231127*  lj* nw* /tmp/
```





#clickhouse04节点操作

同步数据

```shell
for i in `ls -l |egrep  -v 'default|system|information_schema|INFORMATION_SCHEMA' | egrep [a-z,A-Z,0-9,_]+.sql | awk '{print $NF}'`; do  rsync -rvza -e "ssh -p 2022"  ${i}  root@192.168.0.150:/data/container/clickhouse/data/metadata/ ;done
```







#### 1.4 数据库对比

 主要是比对迁移前后数据库的是否一样





![](https://iteshell.oss-cn-beijing.aliyuncs.com/bookshell/operator/img-2023-12-24-320.gif)





```shell
106个库  --- show databases   # clickhouse04节点统计
```



```shell
101个库  --- 迁移(排除,system, default,information_schema,INFORMATION_SCHEMA,) # 需要迁移的库
```





#### 1.5、启动服务



授权同步后的权限

```shell

chown -R  clickhouse:clickhouse  /data/container/clickhouse/data

chown clickhouse:clickhouse  /data2/container/clickhouse -R 

chown clickhouse:clickhouse  /data3/container/clickhouse -R
```



启动服务

systemctl start clickhouse-server





#授权用户 根据报错,需要授权用户

![image-20231224152832117](https://iteshell.oss-cn-beijing.aliyuncs.com/bookshell/operator/image-20231224152832117.png)



```shel
GRANT INSERT ON *.* TO d2c;
```



### 2、服务启动后的数据不一致问题修复



####  2.1、clickhouse启动后的问题收集汇总

服务器启动后遇到一些问题，此处需要根据报错修复

根据下面的报错，就能看出，目前很多的分布式表已经处于readonly 模式， 就是在zk中没找到元数据，可能原因就是zk的超时机制，由于该节点宕机时间过长导致的问题。

![image-20231224152958677](https://iteshell.oss-cn-beijing.aliyuncs.com/bookshell/operator/image-20231224152958677.png)



接下来，我们需要在zk中验证是否是真的不存在



```shell
zkCli.sh -server 127.0.0.1:3181  #登录zk验证
/clickhouse/01-02/tables/"ghzhl20200602".TempHumiContData_local/replicas/
```





如图，确实看不到另外一个ckc03节点的元数据，这种的可以修复。

![](https://iteshell.oss-cn-beijing.aliyuncs.com/bookshell/operator/image-20231224153152598.png)



我接着在验证一个表，结果如下，同样的问题。那接下来，就需要通过脚本的方式，批量化先操作一次，并观察操作中出现的异常日志。

```shell
/clickhouse/01-02/tables/"ghzhl20200602".TempHumiContData_local/replicas
```



![](https://iteshell.oss-cn-beijing.aliyuncs.com/bookshell/operator/image-20231224153402785.png)

#### 2.2、统计只读表



**统计clickhouse03只读表**

select table,zookeeper_path,replica_path from `system`.replicas where is_readonly

```shell
root@clickhouse03:~# clickhouse-client -q 'select table,zookeeper_path,replica_path from `system`.replicas where is_readonly'
HOS_4000_calc_params	/clickhouse/a-a/tables/"bjhdq20200722".HOS_4000_calc_params	/clickhouse/a-a/tables/"bjhdq20200722".HOS_4000_calc_params/replicas/ekc03
HOS_4000_calc_params_new	/clickhouse/a-a/tables/"bjhdq20200722".HOS_4000_calc_params_new	/clickhouse/a-a/tables/"bjhdq20200722".HOS_4000_calc_params_new/replicas/ekc03
IncliHCF2000V1_calc_params	/clickhouse/a-a/tables/"bjhdq20200722".IncliHCF2000V1_calc_params	/clickhouse/a-a/tables/"bjhdq20200722".IncliHCF2000V1_calc_params/replicas/ekc03
LZHCF2000_calc_params	/clickhouse/a-a/tables/"bjhdq20200722".LZHCF2000_calc_params	/clickhouse/a-a/tables/"bjhdq20200722".LZHCF2000_calc_params/replicas/ekc03
AnemometerContData_local	/clickhouse/01-02/tables/"blmdq20231128".AnemometerContData_local	/clickhouse/01-02/tables/"blmdq20231128".AnemometerContData_local/replicas/ekc03
AnemometerContData_materialized_local	/clickhouse/01-02/tables/"blmdq20231128".AnemometerContData_materialized_local	/clickhouse/01-02/tables/"blmdq20231128".AnemometerContData_materialized_local/replicas/ekc03
IncliContData_materialized_local	/clickhouse/01-02/tables/"blmdq20231128".IncliContData_materialized_local	/clickhouse/01-02/tables/"blmdq20231128".IncliContData_materialized_local/replicas/ekc03
SettlementContData_local	/clickhouse/01-02/tables/"blmdq20231128".SettlementContData_local	/clickhouse/01-02/tables/"blmdq20231128".SettlementContData_local/replicas/ekc03
VibraCable_calc_params	/clickhouse/a-a/tables/"bmhtdq20230625".VibraCable_calc_params	/clickhouse/a-a/tables/"bmhtdq20230625".VibraCable_calc_params/replicas/ekc03
SmoothHOS4000_calc_params	/clickhouse/a-a/tables/"bshdq20220123".SmoothHOS4000_calc_params	/clickhouse/a-a/tables/"bshdq20220123".SmoothHOS4000_calc_params/replicas/ekc03
CablePeaksHCF4000_calc_params	/clickhouse/a-a/tables/"bzhhdq20220906".CablePeaksHCF4000_calc_params_new	/clickhouse/a-a/tables/"bzhhdq20220906".CablePeaksHCF4000_calc_params_new/replicas/ekc03
VibraCable_calc_params	/clickhouse/a-a/tables/"bzhhdq20220906".VibraCable_calc_params	/clickhouse/a-a/tables/"bzhhdq20220906".VibraCable_calc_params/replicas/ekc03
AxleLoadAtlas_local	/clickhouse/01-02/tables/"chgszdqfzjc20231115".AxleLoadAtlas_local	/clickhouse/01-02/tables/"chgszdqfzjc20231115".AxleLoadAtlas_local/replicas/ekc03
ClockTaskSampleInfoAndTriggerSampleInfo_local	/clickhouse/01-02/tables/"chgszdqfzjc20231115".ClockTaskSampleInfoAndTriggerSampleInfo_local	/clickhouse/01-02/tables/"chgszdqfzjc20231115".ClockTaskSampleInfoAndTriggerSampleInfo_local/replicas/ekc03
ClockTaskSampleInfo_local	/clickhouse/01-02/tables/"chgszdqfzjc20231115".ClockTaskSampleInfo_local	/clickhouse/01-02/tables/"chgszdqfzjc20231115".ClockTaskSampleInfo_local/replicas/ekc03
ClockTaskTimeInfoSensorNode_local	/clickhouse/01-02/tables/"chgszdqfzjc20231115".ClockTaskTimeInfoSensorNode_local	/clickhouse/01-02/tables/"chgszdqfzjc20231115".ClockTaskTimeInfoSensorNode_local/replicas/ekc03
IncliContData_local	/clickhouse/01-02/tables/"chgszdqfzjc20231115".IncliContData_local	/clickhouse/01-02/tables/"chgszdqfzjc20231115".IncliContData_local/replicas/ekc03
InitIncliInfo_local	/clickhouse/01-02/tables/"chgszdqfzjc20231115".InitIncliInfo_local	/clickhouse/01-02/tables/"chgszdqfzjc20231115".InitIncliInfo_local/replicas/ekc03
PowerStateNodeData_local	/clickhouse/01-02/tables/"chgszdqfzjc20231115".PowerStateNodeData_local	/clickhouse/01-02/tables/"chgszdqfzjc20231115".PowerStateNodeData_local/replicas/ekc03
SensorConfigInfoHIS400_local	/clickhouse/01-02/tables/"chgszdqfzjc20231115".SensorConfigInfoHIS400_local	/clickhouse/01-02/tables/"chgszdqfzjc20231115".SensorConfigInfoHIS400_local/replicas/ekc03
SerialNumber_local	/clickhouse/01-02/tables/"chgszdqfzjc20231115".SerialNumber_local	/clickhouse/01-02/tables/"chgszdqfzjc20231115".SerialNumber_local/replicas/ekc03
SoftVersion_local	/clickhouse/01-02/tables/"chgszdqfzjc20231115".SoftVersion_local	/clickhouse/01-02/tables/"chgszdqfzjc20231115".SoftVersion_local/replicas/ekc03
TopInfoNodeData_local	/clickhouse/01-02/tables/"chgszdqfzjc20231115".TopInfoNodeData_local	/clickhouse/01-02/tables/"chgszdqfzjc20231115".TopInfoNodeData_local/replicas/ekc03
TrafficFlowData_local	/clickhouse/01-02/tables/"chgszdqfzjc20231115".TrafficFlowData_local	/clickhouse/01-02/tables/"chgszdqfzjc20231115".TrafficFlowData_local/replicas/ekc03
TriggerEvent_local	/clickhouse/01-02/tables/"chgszdqfzjc20231115".TriggerEvent_local	/clickhouse/01-02/tables/"chgszdqfzjc20231115".TriggerEvent_local/replicas/ekc03
VibrationData_local	/clickhouse/01-02/tables/"chgszdqfzjc20231115".VibrationData_local	/clickhouse/01-02/tables/"chgszdqfzjc20231115".VibrationData_local/replicas/ekc03
VibrationData_materialized_local	/clickhouse/01-02/tables/"chgszdqfzjc20231115".VibrationData_materialized_local	/clickhouse/01-02/tables/"chgszdqfzjc20231115".VibrationData_materialized_local/replicas/ekc03
WeightingData_local	/clickhouse/01-02/tables/"chgszdqfzjc20231115".WeightingData_local	/clickhouse/01-02/tables/"chgszdqfzjc20231115".WeightingData_local/replicas/ekc03
AxleLoadAtlas_local	/clickhouse/01-02/tables/"chgszdqfzjc20231117".AxleLoadAtlas_local	/clickhouse/01-02/tables/"chgszdqfzjc20231117".AxleLoadAtlas_local/replicas/ekc03
ClockTaskSampleInfoAndTriggerSampleInfo_local	/clickhouse/01-02/tables/"chgszdqfzjc20231117".ClockTaskSampleInfoAndTriggerSampleInfo_local	/clickhouse/01-02/tables/"chgszdqfzjc20231117".ClockTaskSampleInfoAndTriggerSampleInfo_local/replicas/ekc03
ClockTaskSampleInfo_local	/clickhouse/01-02/tables/"chgszdqfzjc20231117".ClockTaskSampleInfo_local	/clickhouse/01-02/tables/"chgszdqfzjc20231117".ClockTaskSampleInfo_local/replicas/ekc03
ClockTaskTimeInfoSensorNode_local	/clickhouse/01-02/tables/"chgszdqfzjc20231117".ClockTaskTimeInfoSensorNode_local	/clickhouse/01-02/tables/"chgszdqfzjc20231117".ClockTaskTimeInfoSensorNode_local/replicas/ekc03
IncliContData_local	/clickhouse/01-02/tables/"chgszdqfzjc20231117".IncliContData_local	/clickhouse/01-02/tables/"chgszdqfzjc20231117".IncliContData_local/replicas/ekc03
IncliContData_materialized_local	/clickhouse/01-02/tables/"chgszdqfzjc20231117".IncliContData_materialized_local	/clickhouse/01-02/tables/"chgszdqfzjc20231117".IncliContData_materialized_local/replicas/ekc03
InitIncliInfo_local	/clickhouse/01-02/tables/"chgszdqfzjc20231117".InitIncliInfo_local	/clickhouse/01-02/tables/"chgszdqfzjc20231117".InitIncliInfo_local/replicas/ekc03
PowerStateNodeData_local	/clickhouse/01-02/tables/"chgszdqfzjc20231117".PowerStateNodeData_local	/clickhouse/01-02/tables/"chgszdqfzjc20231117".PowerStateNodeData_local/replicas/ekc03
SensorConfigInfoHIS400_local	/clickhouse/01-02/tables/"chgszdqfzjc20231117".SensorConfigInfoHIS400_local	/clickhouse/01-02/tables/"chgszdqfzjc20231117".SensorConfigInfoHIS400_local/replicas/ekc03
SerialNumber_local	/clickhouse/01-02/tables/"chgszdqfzjc20231117".SerialNumber_local	/clickhouse/01-02/tables/"chgszdqfzjc20231117".SerialNumber_local/replicas/ekc03
SoftVersion_local	/clickhouse/01-02/tables/"chgszdqfzjc20231117".SoftVersion_local	/clickhouse/01-02/tables/"chgszdqfzjc20231117".SoftVersion_local/replicas/ekc03
TopInfoNodeData_local	/clickhouse/01-02/tables/"chgszdqfzjc20231117".TopInfoNodeData_local	/clickhouse/01-02/tables/"chgszdqfzjc20231117".TopInfoNodeData_local/replicas/ekc03
TrafficFlowData_local	/clickhouse/01-02/tables/"chgszdqfzjc20231117".TrafficFlowData_local	/clickhouse/01-02/tables/"chgszdqfzjc20231117".TrafficFlowData_local/replicas/ekc03
TriggerEvent_local	/clickhouse/01-02/tables/"chgszdqfzjc20231117".TriggerEvent_local	/clickhouse/01-02/tables/"chgszdqfzjc20231117".TriggerEvent_local/replicas/ekc03
VibrationData_local	/clickhouse/01-02/tables/"chgszdqfzjc20231117".VibrationData_local	/clickhouse/01-02/tables/"chgszdqfzjc20231117".VibrationData_local/replicas/ekc03
VibrationData_materialized_local	/clickhouse/01-02/tables/"chgszdqfzjc20231117".VibrationData_materialized_local	/clickhouse/01-02/tables/"chgszdqfzjc20231117".VibrationData_materialized_local/replicas/ekc03
WeightingData_local	/clickhouse/01-02/tables/"chgszdqfzjc20231117".WeightingData_local	/clickhouse/01-02/tables/"chgszdqfzjc20231117".WeightingData_local/replicas/ekc03
LufftData_local	/clickhouse/01-02/tables/"cqhhdq20221230".LufftData_local	/clickhouse/01-02/tables/"cqhhdq20221230".LufftData_local/replicas/ekc03
HCF4000_hourly_dist_local	/clickhouse/a-a/tables/"dataquality".HCF4000_hourly_dist_local	/clickhouse/a-a/tables/"dataquality".HCF4000_hourly_dist_local/replicas/ekc03
AxleLoadAtlas_local	/clickhouse/01-02/tables/"dyhhgldq20231120".AxleLoadAtlas_local	/clickhouse/01-02/tables/"dyhhgldq20231120".AxleLoadAtlas_local/replicas/ekc03
ClockTaskSampleInfoAndTriggerSampleInfo_local	/clickhouse/01-02/tables/"dyhhgldq20231120".ClockTaskSampleInfoAndTriggerSampleInfo_local	/clickhouse/01-02/tables/"dyhhgldq20231120".ClockTaskSampleInfoAndTriggerSampleInfo_local/replicas/ekc03
ClockTaskSampleInfo_local	/clickhouse/01-02/tables/"dyhhgldq20231120".ClockTaskSampleInfo_local	/clickhouse/01-02/tables/"dyhhgldq20231120".ClockTaskSampleInfo_local/replicas/ekc03
ClockTaskTimeInfoSensorNode_local	/clickhouse/01-02/tables/"dyhhgldq20231120".ClockTaskTimeInfoSensorNode_local	/clickhouse/01-02/tables/"dyhhgldq20231120".ClockTaskTimeInfoSensorNode_local/replicas/ekc03
DistanceContData_local	/clickhouse/01-02/tables/"dyhhgldq20231120".DistanceContData_local	/clickhouse/01-02/tables/"dyhhgldq20231120".DistanceContData_local/replicas/ekc03
DistanceContData_materialized_local	/clickhouse/01-02/tables/"dyhhgldq20231120".DistanceContData_materialized_local	/clickhouse/01-02/tables/"dyhhgldq20231120".DistanceContData_materialized_local/replicas/ekc03
InitIncliInfo_local	/clickhouse/01-02/tables/"dyhhgldq20231120".InitIncliInfo_local	/clickhouse/01-02/tables/"dyhhgldq20231120".InitIncliInfo_local/replicas/ekc03
PowerStateNodeData_local	/clickhouse/01-02/tables/"dyhhgldq20231120".PowerStateNodeData_local	/clickhouse/01-02/tables/"dyhhgldq20231120".PowerStateNodeData_local/replicas/ekc03
RadarCamera_local	/clickhouse/01-02/tables/"dyhhgldq20231120".RadarCamera_local	/clickhouse/01-02/tables/"dyhhgldq20231120".RadarCamera_local/replicas/ekc03
SensorConfigInfoHIS400_local	/clickhouse/01-02/tables/"dyhhgldq20231120".SensorConfigInfoHIS400_local	/clickhouse/01-02/tables/"dyhhgldq20231120".SensorConfigInfoHIS400_local/replicas/ekc03
SerialNumber_local	/clickhouse/01-02/tables/"dyhhgldq20231120".SerialNumber_local	/clickhouse/01-02/tables/"dyhhgldq20231120".SerialNumber_local/replicas/ekc03
SoftVersion_local	/clickhouse/01-02/tables/"dyhhgldq20231120".SoftVersion_local	/clickhouse/01-02/tables/"dyhhgldq20231120".SoftVersion_local/replicas/ekc03
StressData_materialized_local	/clickhouse/01-02/tables/"dyhhgldq20231120".StressData_materialized_local	/clickhouse/01-02/tables/"dyhhgldq20231120".StressData_materialized_local/replicas/ekc03
TempHumiContData_materialized_local	/clickhouse/01-02/tables/"dyhhgldq20231120".TempHumiContData_materialized_local	/clickhouse/01-02/tables/"dyhhgldq20231120".TempHumiContData_materialized_local/replicas/ekc03
TopInfoNodeData_local	/clickhouse/01-02/tables/"dyhhgldq20231120".TopInfoNodeData_local	/clickhouse/01-02/tables/"dyhhgldq20231120".TopInfoNodeData_local/replicas/ekc03
TrafficFlowData_local	/clickhouse/01-02/tables/"dyhhgldq20231120".TrafficFlowData_local	/clickhouse/01-02/tables/"dyhhgldq20231120".TrafficFlowData_local/replicas/ekc03
TriggerEvent_local	/clickhouse/01-02/tables/"dyhhgldq20231120".TriggerEvent_local	/clickhouse/01-02/tables/"dyhhgldq20231120".TriggerEvent_local/replicas/ekc03
VibrationData_materialized_local	/clickhouse/01-02/tables/"dyhhgldq20231120".VibrationData_materialized_local	/clickhouse/01-02/tables/"dyhhgldq20231120".VibrationData_materialized_local/replicas/ekc03
WeightingData_local	/clickhouse/01-02/tables/"dyhhgldq20231120".WeightingData_local	/clickhouse/01-02/tables/"dyhhgldq20231120".WeightingData_local/replicas/ekc03
TempHumiContData_local	/clickhouse/01-02/tables/"ghzhl20200602".TempHumiContData_local	/clickhouse/01-02/tables/"ghzhl20200602".TempHumiContData_local/replicas/ekc03
CablePeaksHCF4000_calc_params	/clickhouse/a-a/tables/"hjcjeq20211210".CablePeaksHCF4000_calc_params	/clickhouse/a-a/tables/"hjcjeq20211210".CablePeaksHCF4000_calc_params/replicas/ekc03
VibraCable_calc_params	/clickhouse/a-a/tables/"hjcjeq20211210".VibraCable_calc_params	/clickhouse/a-a/tables/"hjcjeq20211210".VibraCable_calc_params/replicas/ekc03
VibrationDataJS02_calc_params	/clickhouse/a-a/tables/"hjcjeq20211210".VibrationDataJS02_calc_params_new	/clickhouse/a-a/tables/"hjcjeq20211210".VibrationDataJS02_calc_params_new/replicas/ekc03
CablePeaksHCF4000_calc_params	/clickhouse/a-a/tables/"hjcjyq20211210".CablePeaksHCF4000_calc_params	/clickhouse/a-a/tables/"hjcjyq20211210".CablePeaksHCF4000_calc_params/replicas/ekc03
AxleLoadAtlas_local	/clickhouse/01-02/tables/"hxdlgfhdq20231128".AxleLoadAtlas_local	/clickhouse/01-02/tables/"hxdlgfhdq20231128".AxleLoadAtlas_local/replicas/ekc03
ClockTaskSampleInfoAndTriggerSampleInfo_local	/clickhouse/01-02/tables/"hxdlgfhdq20231128".ClockTaskSampleInfoAndTriggerSampleInfo_local	/clickhouse/01-02/tables/"hxdlgfhdq20231128".ClockTaskSampleInfoAndTriggerSampleInfo_local/replicas/ekc03
ClockTaskSampleInfo_local	/clickhouse/01-02/tables/"hxdlgfhdq20231128".ClockTaskSampleInfo_local	/clickhouse/01-02/tables/"hxdlgfhdq20231128".ClockTaskSampleInfo_local/replicas/ekc03
ClockTaskTimeInfoSensorNode_local	/clickhouse/01-02/tables/"hxdlgfhdq20231128".ClockTaskTimeInfoSensorNode_local	/clickhouse/01-02/tables/"hxdlgfhdq20231128".ClockTaskTimeInfoSensorNode_local/replicas/ekc03
DistanceContData_local	/clickhouse/01-02/tables/"hxdlgfhdq20231128".DistanceContData_local	/clickhouse/01-02/tables/"hxdlgfhdq20231128".DistanceContData_local/replicas/ekc03
DistanceContData_materialized_local	/clickhouse/01-02/tables/"hxdlgfhdq20231128".DistanceContData_materialized_local	/clickhouse/01-02/tables/"hxdlgfhdq20231128".DistanceContData_materialized_local/replicas/ekc03
InitIncliInfo_local	/clickhouse/01-02/tables/"hxdlgfhdq20231128".InitIncliInfo_local	/clickhouse/01-02/tables/"hxdlgfhdq20231128".InitIncliInfo_local/replicas/ekc03
PowerStateNodeData_local	/clickhouse/01-02/tables/"hxdlgfhdq20231128".PowerStateNodeData_local	/clickhouse/01-02/tables/"hxdlgfhdq20231128".PowerStateNodeData_local/replicas/ekc03
SensorConfigInfoHIS400_local	/clickhouse/01-02/tables/"hxdlgfhdq20231128".SensorConfigInfoHIS400_local	/clickhouse/01-02/tables/"hxdlgfhdq20231128".SensorConfigInfoHIS400_local/replicas/ekc03
SerialNumber_local	/clickhouse/01-02/tables/"hxdlgfhdq20231128".SerialNumber_local	/clickhouse/01-02/tables/"hxdlgfhdq20231128".SerialNumber_local/replicas/ekc03
SoftVersion_local	/clickhouse/01-02/tables/"hxdlgfhdq20231128".SoftVersion_local	/clickhouse/01-02/tables/"hxdlgfhdq20231128".SoftVersion_local/replicas/ekc03
StressData_local	/clickhouse/01-02/tables/"hxdlgfhdq20231128".StressData_local	/clickhouse/01-02/tables/"hxdlgfhdq20231128".StressData_local/replicas/ekc03
StressData_materialized_local	/clickhouse/01-02/tables/"hxdlgfhdq20231128".StressData_materialized_local	/clickhouse/01-02/tables/"hxdlgfhdq20231128".StressData_materialized_local/replicas/ekc03
TempHumiContData_local	/clickhouse/01-02/tables/"hxdlgfhdq20231128".TempHumiContData_local	/clickhouse/01-02/tables/"hxdlgfhdq20231128".TempHumiContData_local/replicas/ekc03
TempHumiContData_materialized_local	/clickhouse/01-02/tables/"hxdlgfhdq20231128".TempHumiContData_materialized_local	/clickhouse/01-02/tables/"hxdlgfhdq20231128".TempHumiContData_materialized_local/replicas/ekc03
TopInfoNodeData_local	/clickhouse/01-02/tables/"hxdlgfhdq20231128".TopInfoNodeData_local	/clickhouse/01-02/tables/"hxdlgfhdq20231128".TopInfoNodeData_local/replicas/ekc03
TrafficFlowData_local	/clickhouse/01-02/tables/"hxdlgfhdq20231128".TrafficFlowData_local	/clickhouse/01-02/tables/"hxdlgfhdq20231128".TrafficFlowData_local/replicas/ekc03
TriggerEvent_local	/clickhouse/01-02/tables/"hxdlgfhdq20231128".TriggerEvent_local	/clickhouse/01-02/tables/"hxdlgfhdq20231128".TriggerEvent_local/replicas/ekc03
VibrationData_local	/clickhouse/01-02/tables/"hxdlgfhdq20231128".VibrationData_local	/clickhouse/01-02/tables/"hxdlgfhdq20231128".VibrationData_local/replicas/ekc03
VibrationData_materialized_local	/clickhouse/01-02/tables/"hxdlgfhdq20231128".VibrationData_materialized_local	/clickhouse/01-02/tables/"hxdlgfhdq20231128".VibrationData_materialized_local/replicas/ekc03
WeightingData_local	/clickhouse/01-02/tables/"hxdlgfhdq20231128".WeightingData_local	/clickhouse/01-02/tables/"hxdlgfhdq20231128".WeightingData_local/replicas/ekc03
CablePeaksHCF4000_calc_params	/clickhouse/a-a/tables/"jhyhtdq20210316".CablePeaksHCF4000_calc_params	/clickhouse/a-a/tables/"jhyhtdq20210316".CablePeaksHCF4000_calc_params/replicas/ekc03
Correlation_Analysis_calc_params	/clickhouse/a-a/tables/"jhyhtdq20210316".Correlation_Analysis_calc_params	/clickhouse/a-a/tables/"jhyhtdq20210316".Correlation_Analysis_calc_params/replicas/ekc03
IncliHCF2000V1_calc_params	/clickhouse/a-a/tables/"jhyhtdq20210316".IncliHCF2000V1_calc_params	/clickhouse/a-a/tables/"jhyhtdq20210316".IncliHCF2000V1_calc_params/replicas/ekc03
TotalStationDataTS16_calc_params	/clickhouse/a-a/tables/"jhyhtdq20210316".TotalStationDataTS16_calc_params	/clickhouse/a-a/tables/"jhyhtdq20210316".TotalStationDataTS16_calc_params/replicas/ekc03
USRM100_calc_params	/clickhouse/a-a/tables/"jhyhtdq20210316".USRM100_calc_params	/clickhouse/a-a/tables/"jhyhtdq20210316".USRM100_calc_params/replicas/ekc03
CablePeaksHCF4000_calc_params	/clickhouse/a-a/tables/"jnrcgsxhdhhtdq20230530".CablePeaksHCF4000_calc_params	/clickhouse/a-a/tables/"jnrcgsxhdhhtdq20230530".CablePeaksHCF4000_calc_params/replicas/ekc03
ADAM4117_calc_params	/clickhouse/a-a/tables/"jwgsckqqljc20230922".ADAM4117_calc_params	/clickhouse/a-a/tables/"jwgsckqqljc20230922".ADAM4117_calc_params/replicas/ekc03
HCF2100_calc_params	/clickhouse/a-a/tables/"jwgsckqqljc20230922".HCF2100_calc_params	/clickhouse/a-a/tables/"jwgsckqqljc20230922".HCF2100_calc_params/replicas/ekc03
PressHCF710I0RSUC_calc_params	/clickhouse/a-a/tables/"jwgsckqqljc20230922".PressHCF710I0RSUC_calc_params	/clickhouse/a-a/tables/"jwgsckqqljc20230922".PressHCF710I0RSUC_calc_params/replicas/ekc03
VibrationDataBYS007_calc_params	/clickhouse/a-a/tables/"jwmjtdq20220823".VibrationDataBYS007_calc_params	/clickhouse/a-a/tables/"jwmjtdq20220823".VibrationDataBYS007_calc_params/replicas/ekc03
AxleLoadAtlas_local	/clickhouse/01-02/tables/"jzlgfhdq20231128".AxleLoadAtlas_local	/clickhouse/01-02/tables/"jzlgfhdq20231128".AxleLoadAtlas_local/replicas/ekc03
ClockTaskSampleInfoAndTriggerSampleInfo_local	/clickhouse/01-02/tables/"jzlgfhdq20231128".ClockTaskSampleInfoAndTriggerSampleInfo_local	/clickhouse/01-02/tables/"jzlgfhdq20231128".ClockTaskSampleInfoAndTriggerSampleInfo_local/replicas/ekc03
ClockTaskSampleInfo_local	/clickhouse/01-02/tables/"jzlgfhdq20231128".ClockTaskSampleInfo_local	/clickhouse/01-02/tables/"jzlgfhdq20231128".ClockTaskSampleInfo_local/replicas/ekc03
ClockTaskTimeInfoSensorNode_local	/clickhouse/01-02/tables/"jzlgfhdq20231128".ClockTaskTimeInfoSensorNode_local	/clickhouse/01-02/tables/"jzlgfhdq20231128".ClockTaskTimeInfoSensorNode_local/replicas/ekc03
DistanceContData_local	/clickhouse/01-02/tables/"jzlgfhdq20231128".DistanceContData_local	/clickhouse/01-02/tables/"jzlgfhdq20231128".DistanceContData_local/replicas/ekc03
DistanceContData_materialized_local	/clickhouse/01-02/tables/"jzlgfhdq20231128".DistanceContData_materialized_local	/clickhouse/01-02/tables/"jzlgfhdq20231128".DistanceContData_materialized_local/replicas/ekc03
InitIncliInfo_local	/clickhouse/01-02/tables/"jzlgfhdq20231128".InitIncliInfo_local	/clickhouse/01-02/tables/"jzlgfhdq20231128".InitIncliInfo_local/replicas/ekc03
PowerStateNodeData_local	/clickhouse/01-02/tables/"jzlgfhdq20231128".PowerStateNodeData_local	/clickhouse/01-02/tables/"jzlgfhdq20231128".PowerStateNodeData_local/replicas/ekc03
SensorConfigInfoHIS400_local	/clickhouse/01-02/tables/"jzlgfhdq20231128".SensorConfigInfoHIS400_local	/clickhouse/01-02/tables/"jzlgfhdq20231128".SensorConfigInfoHIS400_local/replicas/ekc03
SerialNumber_local	/clickhouse/01-02/tables/"jzlgfhdq20231128".SerialNumber_local	/clickhouse/01-02/tables/"jzlgfhdq20231128".SerialNumber_local/replicas/ekc03
SoftVersion_local	/clickhouse/01-02/tables/"jzlgfhdq20231128".SoftVersion_local	/clickhouse/01-02/tables/"jzlgfhdq20231128".SoftVersion_local/replicas/ekc03
StressData_local	/clickhouse/01-02/tables/"jzlgfhdq20231128".StressData_local	/clickhouse/01-02/tables/"jzlgfhdq20231128".StressData_local/replicas/ekc03
StressData_materialized_local	/clickhouse/01-02/tables/"jzlgfhdq20231128".StressData_materialized_local	/clickhouse/01-02/tables/"jzlgfhdq20231128".StressData_materialized_local/replicas/ekc03
TempHumiContData_local	/clickhouse/01-02/tables/"jzlgfhdq20231128".TempHumiContData_local	/clickhouse/01-02/tables/"jzlgfhdq20231128".TempHumiContData_local/replicas/ekc03
TempHumiContData_materialized_local	/clickhouse/01-02/tables/"jzlgfhdq20231128".TempHumiContData_materialized_local	/clickhouse/01-02/tables/"jzlgfhdq20231128".TempHumiContData_materialized_local/replicas/ekc03
TopInfoNodeData_local	/clickhouse/01-02/tables/"jzlgfhdq20231128".TopInfoNodeData_local	/clickhouse/01-02/tables/"jzlgfhdq20231128".TopInfoNodeData_local/replicas/ekc03
TrafficFlowData_local	/clickhouse/01-02/tables/"jzlgfhdq20231128".TrafficFlowData_local	/clickhouse/01-02/tables/"jzlgfhdq20231128".TrafficFlowData_local/replicas/ekc03
TriggerEvent_local	/clickhouse/01-02/tables/"jzlgfhdq20231128".TriggerEvent_local	/clickhouse/01-02/tables/"jzlgfhdq20231128".TriggerEvent_local/replicas/ekc03
VibrationData_local	/clickhouse/01-02/tables/"jzlgfhdq20231128".VibrationData_local	/clickhouse/01-02/tables/"jzlgfhdq20231128".VibrationData_local/replicas/ekc03
VibrationData_materialized_local	/clickhouse/01-02/tables/"jzlgfhdq20231128".VibrationData_materialized_local	/clickhouse/01-02/tables/"jzlgfhdq20231128".VibrationData_materialized_local/replicas/ekc03
WeightingData_local	/clickhouse/01-02/tables/"jzlgfhdq20231128".WeightingData_local	/clickhouse/01-02/tables/"jzlgfhdq20231128".WeightingData_local/replicas/ekc03
CablePeaksHCF4000_calc_params	/clickhouse/a-a/tables/"ljhhdqjgaqjc20220718".CablePeaksHCF4000_calc_params_new	/clickhouse/a-a/tables/"ljhhdqjgaqjc20220718".CablePeaksHCF4000_calc_params_new/replicas/ekc03
VibraCable_calc_params	/clickhouse/a-a/tables/"ljhhdqjgaqjc20220718".VibraCable_calc_params	/clickhouse/a-a/tables/"ljhhdqjgaqjc20220718".VibraCable_calc_params/replicas/ekc03
AnemometerContData_local	/clickhouse/01-02/tables/"ljyhxtdq20231215".AnemometerContData_local	/clickhouse/01-02/tables/"ljyhxtdq20231215".AnemometerContData_local/replicas/ekc03
AnemometerContData_materialized_local	/clickhouse/01-02/tables/"ljyhxtdq20231215".AnemometerContData_materialized_local	/clickhouse/01-02/tables/"ljyhxtdq20231215".AnemometerContData_materialized_local/replicas/ekc03
AxleLoadAtlas_local	/clickhouse/01-02/tables/"ljyhxtdq20231215".AxleLoadAtlas_local	/clickhouse/01-02/tables/"ljyhxtdq20231215".AxleLoadAtlas_local/replicas/ekc03
ClockTaskSampleInfoAndTriggerSampleInfo_local	/clickhouse/01-02/tables/"ljyhxtdq20231215".ClockTaskSampleInfoAndTriggerSampleInfo_local	/clickhouse/01-02/tables/"ljyhxtdq20231215".ClockTaskSampleInfoAndTriggerSampleInfo_local/replicas/ekc03
ClockTaskSampleInfo_local	/clickhouse/01-02/tables/"ljyhxtdq20231215".ClockTaskSampleInfo_local	/clickhouse/01-02/tables/"ljyhxtdq20231215".ClockTaskSampleInfo_local/replicas/ekc03
ClockTaskTimeInfoSensorNode_local	/clickhouse/01-02/tables/"ljyhxtdq20231215".ClockTaskTimeInfoSensorNode_local	/clickhouse/01-02/tables/"ljyhxtdq20231215".ClockTaskTimeInfoSensorNode_local/replicas/ekc03
DistanceContData_local	/clickhouse/01-02/tables/"ljyhxtdq20231215".DistanceContData_local	/clickhouse/01-02/tables/"ljyhxtdq20231215".DistanceContData_local/replicas/ekc03
DistanceContData_materialized_local	/clickhouse/01-02/tables/"ljyhxtdq20231215".DistanceContData_materialized_local	/clickhouse/01-02/tables/"ljyhxtdq20231215".DistanceContData_materialized_local/replicas/ekc03
IncliContData_local	/clickhouse/01-02/tables/"ljyhxtdq20231215".IncliContData_local	/clickhouse/01-02/tables/"ljyhxtdq20231215".IncliContData_local/replicas/ekc03
IncliContData_materialized_local	/clickhouse/01-02/tables/"ljyhxtdq20231215".IncliContData_materialized_local	/clickhouse/01-02/tables/"ljyhxtdq20231215".IncliContData_materialized_local/replicas/ekc03
InitIncliInfo_local	/clickhouse/01-02/tables/"ljyhxtdq20231215".InitIncliInfo_local	/clickhouse/01-02/tables/"ljyhxtdq20231215".InitIncliInfo_local/replicas/ekc03
PowerStateNodeData_local	/clickhouse/01-02/tables/"ljyhxtdq20231215".PowerStateNodeData_local	/clickhouse/01-02/tables/"ljyhxtdq20231215".PowerStateNodeData_local/replicas/ekc03
SensorConfigInfoHIS400_local	/clickhouse/01-02/tables/"ljyhxtdq20231215".SensorConfigInfoHIS400_local	/clickhouse/01-02/tables/"ljyhxtdq20231215".SensorConfigInfoHIS400_local/replicas/ekc03
SerialNumber_local	/clickhouse/01-02/tables/"ljyhxtdq20231215".SerialNumber_local	/clickhouse/01-02/tables/"ljyhxtdq20231215".SerialNumber_local/replicas/ekc03
SoftVersion_local	/clickhouse/01-02/tables/"ljyhxtdq20231215".SoftVersion_local	/clickhouse/01-02/tables/"ljyhxtdq20231215".SoftVersion_local/replicas/ekc03
StressData_local	/clickhouse/01-02/tables/"ljyhxtdq20231215".StressData_local	/clickhouse/01-02/tables/"ljyhxtdq20231215".StressData_local/replicas/ekc03
StressData_materialized_local	/clickhouse/01-02/tables/"ljyhxtdq20231215".StressData_materialized_local	/clickhouse/01-02/tables/"ljyhxtdq20231215".StressData_materialized_local/replicas/ekc03
TempHumiContData_local	/clickhouse/01-02/tables/"ljyhxtdq20231215".TempHumiContData_local	/clickhouse/01-02/tables/"ljyhxtdq20231215".TempHumiContData_local/replicas/ekc03
TempHumiContData_materialized_local	/clickhouse/01-02/tables/"ljyhxtdq20231215".TempHumiContData_materialized_local	/clickhouse/01-02/tables/"ljyhxtdq20231215".TempHumiContData_materialized_local/replicas/ekc03
TopInfoNodeData_local	/clickhouse/01-02/tables/"ljyhxtdq20231215".TopInfoNodeData_local	/clickhouse/01-02/tables/"ljyhxtdq20231215".TopInfoNodeData_local/replicas/ekc03
TrafficFlowData_local	/clickhouse/01-02/tables/"ljyhxtdq20231215".TrafficFlowData_local	/clickhouse/01-02/tables/"ljyhxtdq20231215".TrafficFlowData_local/replicas/ekc03
TriggerEvent_local	/clickhouse/01-02/tables/"ljyhxtdq20231215".TriggerEvent_local	/clickhouse/01-02/tables/"ljyhxtdq20231215".TriggerEvent_local/replicas/ekc03
VibrationData_local	/clickhouse/01-02/tables/"ljyhxtdq20231215".VibrationData_local	/clickhouse/01-02/tables/"ljyhxtdq20231215".VibrationData_local/replicas/ekc03
VibrationData_materialized_local	/clickhouse/01-02/tables/"ljyhxtdq20231215".VibrationData_materialized_local	/clickhouse/01-02/tables/"ljyhxtdq20231215".VibrationData_materialized_local/replicas/ekc03
WeightingData_local	/clickhouse/01-02/tables/"ljyhxtdq20231215".WeightingData_local	/clickhouse/01-02/tables/"ljyhxtdq20231215".WeightingData_local/replicas/ekc03
DisplacementHIS900_calc_params	/clickhouse/a-a/tables/"lqhq20200728".DisplacementHIS900_calc_params	/clickhouse/a-a/tables/"lqhq20200728".DisplacementHIS900_calc_params/replicas/ekc03
CablePeaksHCF4000_calc_params	/clickhouse/a-a/tables/"mshdq20220126".CablePeaksHCF4000_calc_params	/clickhouse/a-a/tables/"mshdq20220126".CablePeaksHCF4000_calc_params/replicas/ekc03
AnemometerContData_local	/clickhouse/01-02/tables/"nehjhdyhq20231215".AnemometerContData_local	/clickhouse/01-02/tables/"nehjhdyhq20231215".AnemometerContData_local/replicas/ekc03
AnemometerContData_materialized_local	/clickhouse/01-02/tables/"nehjhdyhq20231215".AnemometerContData_materialized_local	/clickhouse/01-02/tables/"nehjhdyhq20231215".AnemometerContData_materialized_local/replicas/ekc03
AxleLoadAtlas_local	/clickhouse/01-02/tables/"nehjhdyhq20231215".AxleLoadAtlas_local	/clickhouse/01-02/tables/"nehjhdyhq20231215".AxleLoadAtlas_local/replicas/ekc03
CablePeaksData_local	/clickhouse/01-02/tables/"nehjhdyhq20231215".CablePeaksData_local	/clickhouse/01-02/tables/"nehjhdyhq20231215".CablePeaksData_local/replicas/ekc03
CablePeaksData_materialized_local	/clickhouse/01-02/tables/"nehjhdyhq20231215".CablePeaksData_materialized_local	/clickhouse/01-02/tables/"nehjhdyhq20231215".CablePeaksData_materialized_local/replicas/ekc03
CablePeaksSS40N1_calc_params	/clickhouse/a-a/tables/"nehjhdyhq20231215".CablePeaksSS40N1_calc_params	/clickhouse/a-a/tables/"nehjhdyhq20231215".CablePeaksSS40N1_calc_params/replicas/ekc03
ClockTaskSampleInfoAndTriggerSampleInfo_local	/clickhouse/01-02/tables/"nehjhdyhq20231215".ClockTaskSampleInfoAndTriggerSampleInfo_local	/clickhouse/01-02/tables/"nehjhdyhq20231215".ClockTaskSampleInfoAndTriggerSampleInfo_local/replicas/ekc03
ClockTaskSampleInfo_local	/clickhouse/01-02/tables/"nehjhdyhq20231215".ClockTaskSampleInfo_local	/clickhouse/01-02/tables/"nehjhdyhq20231215".ClockTaskSampleInfo_local/replicas/ekc03
ClockTaskTimeInfoSensorNode_local	/clickhouse/01-02/tables/"nehjhdyhq20231215".ClockTaskTimeInfoSensorNode_local	/clickhouse/01-02/tables/"nehjhdyhq20231215".ClockTaskTimeInfoSensorNode_local/replicas/ekc03
DistanceContData_local	/clickhouse/01-02/tables/"nehjhdyhq20231215".DistanceContData_local	/clickhouse/01-02/tables/"nehjhdyhq20231215".DistanceContData_local/replicas/ekc03
DistanceContData_materialized_local	/clickhouse/01-02/tables/"nehjhdyhq20231215".DistanceContData_materialized_local	/clickhouse/01-02/tables/"nehjhdyhq20231215".DistanceContData_materialized_local/replicas/ekc03
InitIncliInfo_local	/clickhouse/01-02/tables/"nehjhdyhq20231215".InitIncliInfo_local	/clickhouse/01-02/tables/"nehjhdyhq20231215".InitIncliInfo_local/replicas/ekc03
PowerStateNodeData_local	/clickhouse/01-02/tables/"nehjhdyhq20231215".PowerStateNodeData_local	/clickhouse/01-02/tables/"nehjhdyhq20231215".PowerStateNodeData_local/replicas/ekc03
SensorConfigInfoHIS400_local	/clickhouse/01-02/tables/"nehjhdyhq20231215".SensorConfigInfoHIS400_local	/clickhouse/01-02/tables/"nehjhdyhq20231215".SensorConfigInfoHIS400_local/replicas/ekc03
SerialNumber_local	/clickhouse/01-02/tables/"nehjhdyhq20231215".SerialNumber_local	/clickhouse/01-02/tables/"nehjhdyhq20231215".SerialNumber_local/replicas/ekc03
SoftVersion_local	/clickhouse/01-02/tables/"nehjhdyhq20231215".SoftVersion_local	/clickhouse/01-02/tables/"nehjhdyhq20231215".SoftVersion_local/replicas/ekc03
StressData_local	/clickhouse/01-02/tables/"nehjhdyhq20231215".StressData_local	/clickhouse/01-02/tables/"nehjhdyhq20231215".StressData_local/replicas/ekc03
StressData_materialized_local	/clickhouse/01-02/tables/"nehjhdyhq20231215".StressData_materialized_local	/clickhouse/01-02/tables/"nehjhdyhq20231215".StressData_materialized_local/replicas/ekc03
TempHumiContData_local	/clickhouse/01-02/tables/"nehjhdyhq20231215".TempHumiContData_local	/clickhouse/01-02/tables/"nehjhdyhq20231215".TempHumiContData_local/replicas/ekc03
TempHumiContData_materialized_local	/clickhouse/01-02/tables/"nehjhdyhq20231215".TempHumiContData_materialized_local	/clickhouse/01-02/tables/"nehjhdyhq20231215".TempHumiContData_materialized_local/replicas/ekc03
TempHumiData_local	/clickhouse/01-02/tables/"nehjhdyhq20231215".TempHumiData_local	/clickhouse/01-02/tables/"nehjhdyhq20231215".TempHumiData_local/replicas/ekc03
TopInfoNodeData_local	/clickhouse/01-02/tables/"nehjhdyhq20231215".TopInfoNodeData_local	/clickhouse/01-02/tables/"nehjhdyhq20231215".TopInfoNodeData_local/replicas/ekc03
TrafficFlowData_local	/clickhouse/01-02/tables/"nehjhdyhq20231215".TrafficFlowData_local	/clickhouse/01-02/tables/"nehjhdyhq20231215".TrafficFlowData_local/replicas/ekc03
TriggerEvent_local	/clickhouse/01-02/tables/"nehjhdyhq20231215".TriggerEvent_local	/clickhouse/01-02/tables/"nehjhdyhq20231215".TriggerEvent_local/replicas/ekc03
VibrationData_local	/clickhouse/01-02/tables/"nehjhdyhq20231215".VibrationData_local	/clickhouse/01-02/tables/"nehjhdyhq20231215".VibrationData_local/replicas/ekc03
VibrationData_materialized_local	/clickhouse/01-02/tables/"nehjhdyhq20231215".VibrationData_materialized_local	/clickhouse/01-02/tables/"nehjhdyhq20231215".VibrationData_materialized_local/replicas/ekc03
LufftData_local	/clickhouse/01-02/tables/"plsd20200602".LufftData_local	/clickhouse/01-02/tables/"plsd20200602".LufftData_local/replicas/ekc03
IncliContData_local	/clickhouse/01-02/tables/"qygsjnhhdqzq20200426".IncliContData_local	/clickhouse/01-02/tables/"qygsjnhhdqzq20200426".IncliContData_local/replicas/ekc03
IncliContData_materialized_local	/clickhouse/01-02/tables/"qygsjnhhdqzq20200426".IncliContData_materialized_local	/clickhouse/01-02/tables/"qygsjnhhdqzq20200426".IncliContData_materialized_local/replicas/ekc03
VibraCable_calc_params	/clickhouse/a-a/tables/"rcgsehxxhdhhtdq20220606".VibraCable_calc_params	/clickhouse/a-a/tables/"rcgsehxxhdhhtdq20220606".VibraCable_calc_params/replicas/ekc03
AnemometerContData_local	/clickhouse/01-02/tables/"rygfhdq20231215".AnemometerContData_local	/clickhouse/01-02/tables/"rygfhdq20231215".AnemometerContData_local/replicas/ekc03
AnemometerContData_materialized_local	/clickhouse/01-02/tables/"rygfhdq20231215".AnemometerContData_materialized_local	/clickhouse/01-02/tables/"rygfhdq20231215".AnemometerContData_materialized_local/replicas/ekc03
AxleLoadAtlas_local	/clickhouse/01-02/tables/"rygfhdq20231215".AxleLoadAtlas_local	/clickhouse/01-02/tables/"rygfhdq20231215".AxleLoadAtlas_local/replicas/ekc03
ClockTaskSampleInfoAndTriggerSampleInfo_local	/clickhouse/01-02/tables/"rygfhdq20231215".ClockTaskSampleInfoAndTriggerSampleInfo_local	/clickhouse/01-02/tables/"rygfhdq20231215".ClockTaskSampleInfoAndTriggerSampleInfo_local/replicas/ekc03
ClockTaskSampleInfo_local	/clickhouse/01-02/tables/"rygfhdq20231215".ClockTaskSampleInfo_local	/clickhouse/01-02/tables/"rygfhdq20231215".ClockTaskSampleInfo_local/replicas/ekc03
ClockTaskTimeInfoSensorNode_local	/clickhouse/01-02/tables/"rygfhdq20231215".ClockTaskTimeInfoSensorNode_local	/clickhouse/01-02/tables/"rygfhdq20231215".ClockTaskTimeInfoSensorNode_local/replicas/ekc03
DistanceContData_local	/clickhouse/01-02/tables/"rygfhdq20231215".DistanceContData_local	/clickhouse/01-02/tables/"rygfhdq20231215".DistanceContData_local/replicas/ekc03
DistanceContData_materialized_local	/clickhouse/01-02/tables/"rygfhdq20231215".DistanceContData_materialized_local	/clickhouse/01-02/tables/"rygfhdq20231215".DistanceContData_materialized_local/replicas/ekc03
IncliContData_local	/clickhouse/01-02/tables/"rygfhdq20231215".IncliContData_local	/clickhouse/01-02/tables/"rygfhdq20231215".IncliContData_local/replicas/ekc03
IncliContData_materialized_local	/clickhouse/01-02/tables/"rygfhdq20231215".IncliContData_materialized_local	/clickhouse/01-02/tables/"rygfhdq20231215".IncliContData_materialized_local/replicas/ekc03
InitIncliInfo_local	/clickhouse/01-02/tables/"rygfhdq20231215".InitIncliInfo_local	/clickhouse/01-02/tables/"rygfhdq20231215".InitIncliInfo_local/replicas/ekc03
PowerStateNodeData_local	/clickhouse/01-02/tables/"rygfhdq20231215".PowerStateNodeData_local	/clickhouse/01-02/tables/"rygfhdq20231215".PowerStateNodeData_local/replicas/ekc03
SensorConfigInfoHIS400_local	/clickhouse/01-02/tables/"rygfhdq20231215".SensorConfigInfoHIS400_local	/clickhouse/01-02/tables/"rygfhdq20231215".SensorConfigInfoHIS400_local/replicas/ekc03
SerialNumber_local	/clickhouse/01-02/tables/"rygfhdq20231215".SerialNumber_local	/clickhouse/01-02/tables/"rygfhdq20231215".SerialNumber_local/replicas/ekc03
SoftVersion_local	/clickhouse/01-02/tables/"rygfhdq20231215".SoftVersion_local	/clickhouse/01-02/tables/"rygfhdq20231215".SoftVersion_local/replicas/ekc03
StressData_local	/clickhouse/01-02/tables/"rygfhdq20231215".StressData_local	/clickhouse/01-02/tables/"rygfhdq20231215".StressData_local/replicas/ekc03
StressData_materialized_local	/clickhouse/01-02/tables/"rygfhdq20231215".StressData_materialized_local	/clickhouse/01-02/tables/"rygfhdq20231215".StressData_materialized_local/replicas/ekc03
TempHumiContData_local	/clickhouse/01-02/tables/"rygfhdq20231215".TempHumiContData_local	/clickhouse/01-02/tables/"rygfhdq20231215".TempHumiContData_local/replicas/ekc03
TempHumiContData_materialized_local	/clickhouse/01-02/tables/"rygfhdq20231215".TempHumiContData_materialized_local	/clickhouse/01-02/tables/"rygfhdq20231215".TempHumiContData_materialized_local/replicas/ekc03
TopInfoNodeData_local	/clickhouse/01-02/tables/"rygfhdq20231215".TopInfoNodeData_local	/clickhouse/01-02/tables/"rygfhdq20231215".TopInfoNodeData_local/replicas/ekc03
TrafficFlowData_local	/clickhouse/01-02/tables/"rygfhdq20231215".TrafficFlowData_local	/clickhouse/01-02/tables/"rygfhdq20231215".TrafficFlowData_local/replicas/ekc03
TriggerEvent_local	/clickhouse/01-02/tables/"rygfhdq20231215".TriggerEvent_local	/clickhouse/01-02/tables/"rygfhdq20231215".TriggerEvent_local/replicas/ekc03
VibrationData_local	/clickhouse/01-02/tables/"rygfhdq20231215".VibrationData_local	/clickhouse/01-02/tables/"rygfhdq20231215".VibrationData_local/replicas/ekc03
VibrationData_materialized_local	/clickhouse/01-02/tables/"rygfhdq20231215".VibrationData_materialized_local	/clickhouse/01-02/tables/"rygfhdq20231215".VibrationData_materialized_local/replicas/ekc03
WeightingData_local	/clickhouse/01-02/tables/"rygfhdq20231215".WeightingData_local	/clickhouse/01-02/tables/"rygfhdq20231215".WeightingData_local/replicas/ekc03
HOS_4000_calc_params	/clickhouse/a-a/tables/"smgsnpjtdq20200728".HOS_4000_calc_params	/clickhouse/a-a/tables/"smgsnpjtdq20200728".HOS_4000_calc_params/replicas/ekc03
IncliHCF2000V1_calc_params	/clickhouse/a-a/tables/"smgsnpjtdq20200728".IncliHCF2000V1_calc_params	/clickhouse/a-a/tables/"smgsnpjtdq20200728".IncliHCF2000V1_calc_params/replicas/ekc03
CablePeaksHCF100_calc_params	/clickhouse/a-a/tables/"tdhhdq20210906".CablePeaksHCF100_calc_params	/clickhouse/a-a/tables/"tdhhdq20210906".CablePeaksHCF100_calc_params/replicas/ekc03
CablePeaksHCF4000_calc_params	/clickhouse/a-a/tables/"tdhhdq20210906".CablePeaksHCF4000_calc_params	/clickhouse/a-a/tables/"tdhhdq20210906".CablePeaksHCF4000_calc_params/replicas/ekc03
VibraCable_calc_params	/clickhouse/a-a/tables/"tdhhdq20210906".VibraCable_calc_params_new	/clickhouse/a-a/tables/"tdhhdq20210906".VibraCable_calc_params_new/replicas/ekc03
VibrationData_materialized_local	/clickhouse/01-02/tables/"tzgjq20211109".VibrationData_materialized_local	/clickhouse/01-02/tables/"tzgjq20211109".VibrationData_materialized_local/replicas/ekc03
Modal_Analysis_calc_params	/clickhouse/a-a/tables/"wwgdq20200728".Modal_Analysis_calc_params	/clickhouse/a-a/tables/"wwgdq20200728".Modal_Analysis_calc_params/replicas/ekc03
AxleLoadAtlas_local	/clickhouse/01-02/tables/"yhlgjq20231207".AxleLoadAtlas_local	/clickhouse/01-02/tables/"yhlgjq20231207".AxleLoadAtlas_local/replicas/ekc03
ClockTaskSampleInfoAndTriggerSampleInfo_local	/clickhouse/01-02/tables/"yhlgjq20231207".ClockTaskSampleInfoAndTriggerSampleInfo_local	/clickhouse/01-02/tables/"yhlgjq20231207".ClockTaskSampleInfoAndTriggerSampleInfo_local/replicas/ekc03
ClockTaskSampleInfo_local	/clickhouse/01-02/tables/"yhlgjq20231207".ClockTaskSampleInfo_local	/clickhouse/01-02/tables/"yhlgjq20231207".ClockTaskSampleInfo_local/replicas/ekc03
ClockTaskTimeInfoSensorNode_local	/clickhouse/01-02/tables/"yhlgjq20231207".ClockTaskTimeInfoSensorNode_local	/clickhouse/01-02/tables/"yhlgjq20231207".ClockTaskTimeInfoSensorNode_local/replicas/ekc03
DistanceContData_local	/clickhouse/01-02/tables/"yhlgjq20231207".DistanceContData_local	/clickhouse/01-02/tables/"yhlgjq20231207".DistanceContData_local/replicas/ekc03
DistanceContData_materialized_local	/clickhouse/01-02/tables/"yhlgjq20231207".DistanceContData_materialized_local	/clickhouse/01-02/tables/"yhlgjq20231207".DistanceContData_materialized_local/replicas/ekc03
InitIncliInfo_local	/clickhouse/01-02/tables/"yhlgjq20231207".InitIncliInfo_local	/clickhouse/01-02/tables/"yhlgjq20231207".InitIncliInfo_local/replicas/ekc03
PowerStateNodeData_local	/clickhouse/01-02/tables/"yhlgjq20231207".PowerStateNodeData_local	/clickhouse/01-02/tables/"yhlgjq20231207".PowerStateNodeData_local/replicas/ekc03
SensorConfigInfoHIS400_local	/clickhouse/01-02/tables/"yhlgjq20231207".SensorConfigInfoHIS400_local	/clickhouse/01-02/tables/"yhlgjq20231207".SensorConfigInfoHIS400_local/replicas/ekc03
SerialNumber_local	/clickhouse/01-02/tables/"yhlgjq20231207".SerialNumber_local	/clickhouse/01-02/tables/"yhlgjq20231207".SerialNumber_local/replicas/ekc03
SoftVersion_local	/clickhouse/01-02/tables/"yhlgjq20231207".SoftVersion_local	/clickhouse/01-02/tables/"yhlgjq20231207".SoftVersion_local/replicas/ekc03
StressData_local	/clickhouse/01-02/tables/"yhlgjq20231207".StressData_local	/clickhouse/01-02/tables/"yhlgjq20231207".StressData_local/replicas/ekc03
StressData_materialized_local	/clickhouse/01-02/tables/"yhlgjq20231207".StressData_materialized_local	/clickhouse/01-02/tables/"yhlgjq20231207".StressData_materialized_local/replicas/ekc03
TempHumiContData_local	/clickhouse/01-02/tables/"yhlgjq20231207".TempHumiContData_local	/clickhouse/01-02/tables/"yhlgjq20231207".TempHumiContData_local/replicas/ekc03
TempHumiContData_materialized_local	/clickhouse/01-02/tables/"yhlgjq20231207".TempHumiContData_materialized_local	/clickhouse/01-02/tables/"yhlgjq20231207".TempHumiContData_materialized_local/replicas/ekc03
TopInfoNodeData_local	/clickhouse/01-02/tables/"yhlgjq20231207".TopInfoNodeData_local	/clickhouse/01-02/tables/"yhlgjq20231207".TopInfoNodeData_local/replicas/ekc03
TrafficFlowData_local	/clickhouse/01-02/tables/"yhlgjq20231207".TrafficFlowData_local	/clickhouse/01-02/tables/"yhlgjq20231207".TrafficFlowData_local/replicas/ekc03
TriggerEvent_local	/clickhouse/01-02/tables/"yhlgjq20231207".TriggerEvent_local	/clickhouse/01-02/tables/"yhlgjq20231207".TriggerEvent_local/replicas/ekc03
VibrationData_local	/clickhouse/01-02/tables/"yhlgjq20231207".VibrationData_local	/clickhouse/01-02/tables/"yhlgjq20231207".VibrationData_local/replicas/ekc03
VibrationData_materialized_local	/clickhouse/01-02/tables/"yhlgjq20231207".VibrationData_materialized_local	/clickhouse/01-02/tables/"yhlgjq20231207".VibrationData_materialized_local/replicas/ekc03
WeightingData_local	/clickhouse/01-02/tables/"yhlgjq20231207".WeightingData_local	/clickhouse/01-02/tables/"yhlgjq20231207".WeightingData_local/replicas/ekc03
CablePeaksHCF4000_calc_params	/clickhouse/a-a/tables/"ztzs20210917".CablePeaksHCF4000_calc_params	/clickhouse/a-a/tables/"ztzs20210917".CablePeaksHCF4000_calc_params/replicas/ekc03
DistanceHOS9120I0RSUC_calc_params	/clickhouse/a-a/tables/"ztzs20210917".DistanceHOS9120I0RSUC_calc_params	/clickhouse/a-a/tables/"ztzs20210917".DistanceHOS9120I0RSUC_calc_params/replicas/ekc03
Uart485ForHCF1100SampleData_calc_params	/clickhouse/a-a/tables/"ztzs20210917".Uart485ForHCF1100SampleData_calc_params	/clickhouse/a-a/tables/"ztzs20210917".Uart485ForHCF1100SampleData_calc_params/replicas/ekc03
VibraCable_calc_params	/clickhouse/a-a/tables/"ztzs20210917".VibraCable_calc_params	/clickhouse/a-a/tables/"ztzs20210917".VibraCable_calc_params/replicas/ekc03
```



对于上面的，只需要保留库和表，需要做数据清洗处理,处理完类似：  ztzs20210917.VibraCable_calc_params ，并且把它存到3.txt文本中

处理后的如图： 

![](https://iteshell.oss-cn-beijing.aliyuncs.com/bookshell/operator/image-20231224235612428.png)





**统计clickhouse04只读表**

这里为什么要统计clickhouse04的，因为我们要确定哪些是我们这次需要处理的只读表，哪些是之前就本身存在的，存在的此处我们就需要过滤掉，有可能是存在问题的， 经过查询，下面类似a-a的这种类型，

需要过滤掉。

select table,zookeeper_path,replica_path from `system`.replicas where is_readonly



```shell
root@clickhouse04:~# clickhouse-client -q 'select table,zookeeper_path,replica_path from `system`.replicas where is_readonly'
HOS_4000_calc_params	/clickhouse/a-a/tables/"bjhdq20200722".HOS_4000_calc_params	/clickhouse/a-a/tables/"bjhdq20200722".HOS_4000_calc_params/replicas/ekc04
IncliHCF2000V1_calc_params	/clickhouse/a-a/tables/"bjhdq20200722".IncliHCF2000V1_calc_params	/clickhouse/a-a/tables/"bjhdq20200722".IncliHCF2000V1_calc_params/replicas/ekc04
LZHCF2000_calc_params	/clickhouse/a-a/tables/"bjhdq20200722".LZHCF2000_calc_params	/clickhouse/a-a/tables/"bjhdq20200722".LZHCF2000_calc_params/replicas/ekc04
VibraCable_calc_params	/clickhouse/a-a/tables/"bmhtdq20230625".VibraCable_calc_params	/clickhouse/a-a/tables/"bmhtdq20230625".VibraCable_calc_params/replicas/ekc04
SmoothHOS4000_calc_params	/clickhouse/a-a/tables/"bshdq20220123".SmoothHOS4000_calc_params	/clickhouse/a-a/tables/"bshdq20220123".SmoothHOS4000_calc_params/replicas/ekc04
VibraCable_calc_params	/clickhouse/a-a/tables/"bzhhdq20220906".VibraCable_calc_params	/clickhouse/a-a/tables/"bzhhdq20220906".VibraCable_calc_params/replicas/ekc04
CablePeaksHCF4000_calc_params	/clickhouse/a-a/tables/"hjcjeq20211210".CablePeaksHCF4000_calc_params	/clickhouse/a-a/tables/"hjcjeq20211210".CablePeaksHCF4000_calc_params/replicas/ekc04
VibraCable_calc_params	/clickhouse/a-a/tables/"hjcjeq20211210".VibraCable_calc_params	/clickhouse/a-a/tables/"hjcjeq20211210".VibraCable_calc_params/replicas/ekc04
CablePeaksHCF4000_calc_params	/clickhouse/a-a/tables/"hjcjyq20211210".CablePeaksHCF4000_calc_params	/clickhouse/a-a/tables/"hjcjyq20211210".CablePeaksHCF4000_calc_params/replicas/ekc04
CablePeaksHCF4000_calc_params	/clickhouse/a-a/tables/"jhyhtdq20210316".CablePeaksHCF4000_calc_params	/clickhouse/a-a/tables/"jhyhtdq20210316".CablePeaksHCF4000_calc_params/replicas/ekc04
Correlation_Analysis_calc_params	/clickhouse/a-a/tables/"jhyhtdq20210316".Correlation_Analysis_calc_params	/clickhouse/a-a/tables/"jhyhtdq20210316".Correlation_Analysis_calc_params/replicas/ekc04
IncliHCF2000V1_calc_params	/clickhouse/a-a/tables/"jhyhtdq20210316".IncliHCF2000V1_calc_params	/clickhouse/a-a/tables/"jhyhtdq20210316".IncliHCF2000V1_calc_params/replicas/ekc04
TotalStationDataTS16_calc_params	/clickhouse/a-a/tables/"jhyhtdq20210316".TotalStationDataTS16_calc_params	/clickhouse/a-a/tables/"jhyhtdq20210316".TotalStationDataTS16_calc_params/replicas/ekc04
USRM100_calc_params	/clickhouse/a-a/tables/"jhyhtdq20210316".USRM100_calc_params	/clickhouse/a-a/tables/"jhyhtdq20210316".USRM100_calc_params/replicas/ekc04
CablePeaksHCF4000_calc_params	/clickhouse/a-a/tables/"jnrcgsxhdhhtdq20230530".CablePeaksHCF4000_calc_params	/clickhouse/a-a/tables/"jnrcgsxhdhhtdq20230530".CablePeaksHCF4000_calc_params/replicas/ekc04
VibraCable_calc_params	/clickhouse/a-a/tables/"jnrcgsxhdhhtdq20230530".VibraCable_calc_params	/clickhouse/a-a/tables/"jnrcgsxhdhhtdq20230530".VibraCable_calc_params/replicas/ekc04
ADAM4117_calc_params	/clickhouse/a-a/tables/"jwgsckqqljc20230922".ADAM4117_calc_params	/clickhouse/a-a/tables/"jwgsckqqljc20230922".ADAM4117_calc_params/replicas/ekc04
HCF2100_calc_params	/clickhouse/a-a/tables/"jwgsckqqljc20230922".HCF2100_calc_params	/clickhouse/a-a/tables/"jwgsckqqljc20230922".HCF2100_calc_params/replicas/ekc04
VibrationDataBYS007_calc_params	/clickhouse/a-a/tables/"jwmjtdq20220823".VibrationDataBYS007_calc_params	/clickhouse/a-a/tables/"jwmjtdq20220823".VibrationDataBYS007_calc_params/replicas/ekc04
VibraCable_calc_params	/clickhouse/a-a/tables/"ljhhdqjgaqjc20220718".VibraCable_calc_params	/clickhouse/a-a/tables/"ljhhdqjgaqjc20220718".VibraCable_calc_params/replicas/ekc04
DisplacementHIS900_calc_params	/clickhouse/a-a/tables/"lqhq20200728".DisplacementHIS900_calc_params	/clickhouse/a-a/tables/"lqhq20200728".DisplacementHIS900_calc_params/replicas/ekc04
CablePeaksHCF4000_calc_params	/clickhouse/a-a/tables/"mshdq20220126".CablePeaksHCF4000_calc_params	/clickhouse/a-a/tables/"mshdq20220126".CablePeaksHCF4000_calc_params/replicas/ekc04
CablePeaksData_calc_params	/clickhouse/a-a/tables/"rcgsehxxhdhhtdq20220606".CablePeaksData_calc_params	/clickhouse/a-a/tables/"rcgsehxxhdhhtdq20220606".CablePeaksData_calc_params/replicas/ekc04
VibraCable_calc_params	/clickhouse/a-a/tables/"rcgsehxxhdhhtdq20220606".VibraCable_calc_params	/clickhouse/a-a/tables/"rcgsehxxhdhhtdq20220606".VibraCable_calc_params/replicas/ekc04
HOS_4000_calc_params	/clickhouse/a-a/tables/"smgsnpjtdq20200728".HOS_4000_calc_params	/clickhouse/a-a/tables/"smgsnpjtdq20200728".HOS_4000_calc_params/replicas/ekc04
IncliHCF2000V1_calc_params	/clickhouse/a-a/tables/"smgsnpjtdq20200728".IncliHCF2000V1_calc_params	/clickhouse/a-a/tables/"smgsnpjtdq20200728".IncliHCF2000V1_calc_params/replicas/ekc04
CablePeaksHCF100_calc_params	/clickhouse/a-a/tables/"tdhhdq20210906".CablePeaksHCF100_calc_params	/clickhouse/a-a/tables/"tdhhdq20210906".CablePeaksHCF100_calc_params/replicas/ekc04
CablePeaksHCF4000_calc_params	/clickhouse/a-a/tables/"tdhhdq20210906".CablePeaksHCF4000_calc_params	/clickhouse/a-a/tables/"tdhhdq20210906".CablePeaksHCF4000_calc_params/replicas/ekc04
Modal_Analysis_calc_params	/clickhouse/a-a/tables/"wwgdq20200728".Modal_Analysis_calc_params	/clickhouse/a-a/tables/"wwgdq20200728".Modal_Analysis_calc_params/replicas/ekc04
StressDataDH1205_calc_params	/clickhouse/a-a/tables/"wwgdq20200728".StressDataDH1205_calc_params	/clickhouse/a-a/tables/"wwgdq20200728".StressDataDH1205_calc_params/replicas/ekc04
CablePeaksHCF4000_calc_params	/clickhouse/a-a/tables/"ztzs20210917".CablePeaksHCF4000_calc_params	/clickhouse/a-a/tables/"ztzs20210917".CablePeaksHCF4000_calc_params/replicas/ekc04
DistanceHOS9120I0RSUC_calc_params	/clickhouse/a-a/tables/"ztzs20210917".DistanceHOS9120I0RSUC_calc_params	/clickhouse/a-a/tables/"ztzs20210917".DistanceHOS9120I0RSUC_calc_params/replicas/ekc04
Uart485ForHCF1100SampleData_calc_params	/clickhouse/a-a/tables/"ztzs20210917".Uart485ForHCF1100SampleData_calc_params	/clickhouse/a-a/tables/"ztzs20210917".Uart485ForHCF1100SampleData_calc_params/replicas/ekc04
VibraCable_calc_params	/clickhouse/a-a/tables/"ztzs20210917".VibraCable_calc_params	/clickhouse/a-a/tables/"ztzs20210917".VibraCable_calc_params/replicas/ekc04

```



综上,这里只只需要对clickhouse03节点的存在01-02需要处理,对于a-a的不需要处理,然后处理数据,通过脚本来实现







在clickhouse03上把只读表进行清洗处理以下格式,并且将它存放到3.txt文件中,然后统计这些表哪些表本地有数据,对本地有数据的表在此3.txt先排除掉

```shell
root@clickhouse04:~# cat 3.txt 
blmdq20231128.AnemometerContData_local
blmdq20231128.AnemometerContData_materialized_local
blmdq20231128.IncliContData_materialized_local
blmdq20231128.SettlementContData_local
chgszdqfzjc20231115.AxleLoadAtlas_local
chgszdqfzjc20231115.ClockTaskSampleInfoAndTriggerSampleInfo_local
chgszdqfzjc20231115.ClockTaskSampleInfo_local
chgszdqfzjc20231115.ClockTaskTimeInfoSensorNode_local
chgszdqfzjc20231115.IncliContData_local
chgszdqfzjc20231115.InitIncliInfo_local
chgszdqfzjc20231115.PowerStateNodeData_local
chgszdqfzjc20231115.SensorConfigInfoHIS400_local
chgszdqfzjc20231115.SerialNumber_local
chgszdqfzjc20231115.SoftVersion_local
chgszdqfzjc20231115.TopInfoNodeData_local
chgszdqfzjc20231115.TrafficFlowData_local
chgszdqfzjc20231115.TriggerEvent_local
chgszdqfzjc20231115.VibrationData_local
chgszdqfzjc20231115.VibrationData_materialized_local
chgszdqfzjc20231115.WeightingData_local
chgszdqfzjc20231117.AxleLoadAtlas_local
chgszdqfzjc20231117.ClockTaskSampleInfoAndTriggerSampleInfo_local
chgszdqfzjc20231117.ClockTaskSampleInfo_local
chgszdqfzjc20231117.ClockTaskTimeInfoSensorNode_local
chgszdqfzjc20231117.IncliContData_local
chgszdqfzjc20231117.IncliContData_materialized_local
chgszdqfzjc20231117.InitIncliInfo_local
chgszdqfzjc20231117.PowerStateNodeData_local
chgszdqfzjc20231117.SensorConfigInfoHIS400_local
chgszdqfzjc20231117.SerialNumber_local
chgszdqfzjc20231117.SoftVersion_local
chgszdqfzjc20231117.TopInfoNodeData_local
chgszdqfzjc20231117.TrafficFlowData_local
chgszdqfzjc20231117.TriggerEvent_local
chgszdqfzjc20231117.VibrationData_local
chgszdqfzjc20231117.VibrationData_materialized_local
chgszdqfzjc20231117.WeightingData_local
cqhhdq20221230.LufftData_local
dyhhgldq20231120.AxleLoadAtlas_local
dyhhgldq20231120.ClockTaskSampleInfoAndTriggerSampleInfo_local
dyhhgldq20231120.ClockTaskSampleInfo_local
dyhhgldq20231120.ClockTaskTimeInfoSensorNode_local
dyhhgldq20231120.DistanceContData_local
dyhhgldq20231120.DistanceContData_materialized_local
dyhhgldq20231120.InitIncliInfo_local
dyhhgldq20231120.PowerStateNodeData_local
dyhhgldq20231120.RadarCamera_local
dyhhgldq20231120.SensorConfigInfoHIS400_local
dyhhgldq20231120.SerialNumber_local
dyhhgldq20231120.SoftVersion_local
dyhhgldq20231120.StressData_materialized_local
dyhhgldq20231120.TempHumiContData_materialized_local
dyhhgldq20231120.TopInfoNodeData_local
dyhhgldq20231120.TrafficFlowData_local
dyhhgldq20231120.TriggerEvent_local
dyhhgldq20231120.VibrationData_materialized_local
dyhhgldq20231120.WeightingData_local
ghzhl20200602.TempHumiContData_local
hxdlgfhdq20231128.AxleLoadAtlas_local
hxdlgfhdq20231128.ClockTaskSampleInfoAndTriggerSampleInfo_local
hxdlgfhdq20231128.ClockTaskSampleInfo_local
hxdlgfhdq20231128.ClockTaskTimeInfoSensorNode_local
hxdlgfhdq20231128.DistanceContData_local
hxdlgfhdq20231128.DistanceContData_materialized_local
hxdlgfhdq20231128.InitIncliInfo_local
hxdlgfhdq20231128.PowerStateNodeData_local
hxdlgfhdq20231128.SensorConfigInfoHIS400_local
hxdlgfhdq20231128.SerialNumber_local
hxdlgfhdq20231128.SoftVersion_local
hxdlgfhdq20231128.StressData_local
hxdlgfhdq20231128.StressData_materialized_local
hxdlgfhdq20231128.TempHumiContData_local
hxdlgfhdq20231128.TempHumiContData_materialized_local
hxdlgfhdq20231128.TopInfoNodeData_local
hxdlgfhdq20231128.TrafficFlowData_local
hxdlgfhdq20231128.TriggerEvent_local
hxdlgfhdq20231128.VibrationData_local
hxdlgfhdq20231128.VibrationData_materialized_local
hxdlgfhdq20231128.WeightingData_local
jzlgfhdq20231128.AxleLoadAtlas_local
jzlgfhdq20231128.ClockTaskSampleInfoAndTriggerSampleInfo_local
jzlgfhdq20231128.ClockTaskSampleInfo_local
jzlgfhdq20231128.ClockTaskTimeInfoSensorNode_local
jzlgfhdq20231128.DistanceContData_local
jzlgfhdq20231128.DistanceContData_materialized_local
jzlgfhdq20231128.InitIncliInfo_local
jzlgfhdq20231128.PowerStateNodeData_local
jzlgfhdq20231128.SensorConfigInfoHIS400_local
jzlgfhdq20231128.SerialNumber_local
jzlgfhdq20231128.SoftVersion_local
jzlgfhdq20231128.StressData_local
jzlgfhdq20231128.StressData_materialized_local
jzlgfhdq20231128.TempHumiContData_local
jzlgfhdq20231128.TempHumiContData_materialized_local
jzlgfhdq20231128.TopInfoNodeData_local
jzlgfhdq20231128.TrafficFlowData_local
jzlgfhdq20231128.TriggerEvent_local
jzlgfhdq20231128.VibrationData_local
jzlgfhdq20231128.VibrationData_materialized_local
jzlgfhdq20231128.WeightingData_local
ljyhxtdq20231215.AnemometerContData_local
ljyhxtdq20231215.AnemometerContData_materialized_local
ljyhxtdq20231215.AxleLoadAtlas_local
ljyhxtdq20231215.ClockTaskSampleInfoAndTriggerSampleInfo_local
ljyhxtdq20231215.ClockTaskSampleInfo_local
ljyhxtdq20231215.ClockTaskTimeInfoSensorNode_local
ljyhxtdq20231215.DistanceContData_local
ljyhxtdq20231215.DistanceContData_materialized_local
ljyhxtdq20231215.IncliContData_local
ljyhxtdq20231215.IncliContData_materialized_local
ljyhxtdq20231215.InitIncliInfo_local
ljyhxtdq20231215.PowerStateNodeData_local
ljyhxtdq20231215.SensorConfigInfoHIS400_local
ljyhxtdq20231215.SerialNumber_local
ljyhxtdq20231215.SoftVersion_local
ljyhxtdq20231215.StressData_local
ljyhxtdq20231215.StressData_materialized_local
ljyhxtdq20231215.TempHumiContData_local
ljyhxtdq20231215.TempHumiContData_materialized_local
ljyhxtdq20231215.TopInfoNodeData_local
ljyhxtdq20231215.TrafficFlowData_local
ljyhxtdq20231215.TriggerEvent_local
ljyhxtdq20231215.VibrationData_local
ljyhxtdq20231215.VibrationData_materialized_local
ljyhxtdq20231215.WeightingData_local
nehjhdyhq20231215.AnemometerContData_local
nehjhdyhq20231215.AnemometerContData_materialized_local
nehjhdyhq20231215.AxleLoadAtlas_local
nehjhdyhq20231215.CablePeaksData_local
nehjhdyhq20231215.CablePeaksData_materialized_local
nehjhdyhq20231215.ClockTaskSampleInfoAndTriggerSampleInfo_local
nehjhdyhq20231215.ClockTaskSampleInfo_local
nehjhdyhq20231215.ClockTaskTimeInfoSensorNode_local
nehjhdyhq20231215.DistanceContData_local
nehjhdyhq20231215.DistanceContData_materialized_local
nehjhdyhq20231215.InitIncliInfo_local
nehjhdyhq20231215.PowerStateNodeData_local
nehjhdyhq20231215.SensorConfigInfoHIS400_local
nehjhdyhq20231215.SerialNumber_local
nehjhdyhq20231215.SoftVersion_local
nehjhdyhq20231215.StressData_local
nehjhdyhq20231215.StressData_materialized_local
nehjhdyhq20231215.TempHumiContData_local
nehjhdyhq20231215.TempHumiContData_materialized_local
nehjhdyhq20231215.TempHumiData_local
nehjhdyhq20231215.TopInfoNodeData_local
nehjhdyhq20231215.TrafficFlowData_local
nehjhdyhq20231215.TriggerEvent_local
nehjhdyhq20231215.VibrationData_local
nehjhdyhq20231215.VibrationData_materialized_local
plsd20200602.LufftData_local
qygsjnhhdqzq20200426.IncliContData_local
qygsjnhhdqzq20200426.IncliContData_materialized_local
rygfhdq20231215.AnemometerContData_local
rygfhdq20231215.AnemometerContData_materialized_local
rygfhdq20231215.AxleLoadAtlas_local
rygfhdq20231215.ClockTaskSampleInfoAndTriggerSampleInfo_local
rygfhdq20231215.ClockTaskSampleInfo_local
rygfhdq20231215.ClockTaskTimeInfoSensorNode_local
rygfhdq20231215.DistanceContData_local
rygfhdq20231215.DistanceContData_materialized_local
rygfhdq20231215.IncliContData_local
rygfhdq20231215.IncliContData_materialized_local
rygfhdq20231215.InitIncliInfo_local
rygfhdq20231215.PowerStateNodeData_local
rygfhdq20231215.SensorConfigInfoHIS400_local
rygfhdq20231215.SerialNumber_local
rygfhdq20231215.SoftVersion_local
rygfhdq20231215.StressData_local
rygfhdq20231215.StressData_materialized_local
rygfhdq20231215.TempHumiContData_local
rygfhdq20231215.TempHumiContData_materialized_local
rygfhdq20231215.TopInfoNodeData_local
rygfhdq20231215.TrafficFlowData_local
rygfhdq20231215.TriggerEvent_local
rygfhdq20231215.VibrationData_local
rygfhdq20231215.VibrationData_materialized_local
rygfhdq20231215.WeightingData_local
tzgjq20211109.VibrationData_materialized_local
yhlgjq20231207.AxleLoadAtlas_local
yhlgjq20231207.ClockTaskSampleInfoAndTriggerSampleInfo_local
yhlgjq20231207.ClockTaskSampleInfo_local
yhlgjq20231207.ClockTaskTimeInfoSensorNode_local
yhlgjq20231207.DistanceContData_local
yhlgjq20231207.DistanceContData_materialized_local
yhlgjq20231207.InitIncliInfo_local
yhlgjq20231207.PowerStateNodeData_local
yhlgjq20231207.SensorConfigInfoHIS400_local
yhlgjq20231207.SerialNumber_local
yhlgjq20231207.SoftVersion_local
yhlgjq20231207.StressData_local
yhlgjq20231207.StressData_materialized_local
yhlgjq20231207.TempHumiContData_local
yhlgjq20231207.TempHumiContData_materialized_local
yhlgjq20231207.TopInfoNodeData_local
yhlgjq20231207.TrafficFlowData_local
yhlgjq20231207.TriggerEvent_local
yhlgjq20231207.VibrationData_local
yhlgjq20231207.VibrationData_materialized_local
yhlgjq20231207.WeightingData_local
```



#### 2.3、核实只读表正常副本节点的数据量

核实clickhouse03节点只读表在clickhouse04节点的数据量

这里我们需要在clickhouse04节点上核实只读表正常的数据量是多少，我们需要在clickhouse03上恢复这些只读表后，验证数据的一致性。



然后在clickhouse04机器上查看3.txt文件中只读表所有的数据是多少 

```shell
for i in `cat 3.txt `; do echo $i && sleep 1 && clickhouse-client -q "select count(*)  from ${i} "; done
```

统计后的结果如下:

```shell
root@clickhouse04:~# cat db-table-count.txt 
blmdq20231128.AnemometerContData_local
677674
blmdq20231128.AnemometerContData_materialized_local
9154
blmdq20231128.IncliContData_materialized_local
53043
blmdq20231128.SettlementContData_local
58255
chgszdqfzjc20231115.AxleLoadAtlas_local
0
chgszdqfzjc20231115.ClockTaskSampleInfoAndTriggerSampleInfo_local
0
chgszdqfzjc20231115.ClockTaskSampleInfo_local
0
chgszdqfzjc20231115.ClockTaskTimeInfoSensorNode_local
0
chgszdqfzjc20231115.IncliContData_local
1312036319
chgszdqfzjc20231115.InitIncliInfo_local
0
chgszdqfzjc20231115.PowerStateNodeData_local
0
chgszdqfzjc20231115.SensorConfigInfoHIS400_local
0
chgszdqfzjc20231115.SerialNumber_local
0
chgszdqfzjc20231115.SoftVersion_local
0
chgszdqfzjc20231115.TopInfoNodeData_local
0
chgszdqfzjc20231115.TrafficFlowData_local
0
chgszdqfzjc20231115.TriggerEvent_local
29
chgszdqfzjc20231115.VibrationData_local
525529165
chgszdqfzjc20231115.VibrationData_materialized_local
209080
chgszdqfzjc20231115.WeightingData_local
0
chgszdqfzjc20231117.AxleLoadAtlas_local
0
chgszdqfzjc20231117.ClockTaskSampleInfoAndTriggerSampleInfo_local
0
chgszdqfzjc20231117.ClockTaskSampleInfo_local
0
chgszdqfzjc20231117.ClockTaskTimeInfoSensorNode_local
0
chgszdqfzjc20231117.IncliContData_local
1156011200
chgszdqfzjc20231117.IncliContData_materialized_local
461230
chgszdqfzjc20231117.InitIncliInfo_local
0
chgszdqfzjc20231117.PowerStateNodeData_local
0
chgszdqfzjc20231117.SensorConfigInfoHIS400_local
0
chgszdqfzjc20231117.SerialNumber_local
0
chgszdqfzjc20231117.SoftVersion_local
0
chgszdqfzjc20231117.TopInfoNodeData_local
0
chgszdqfzjc20231117.TrafficFlowData_local
0
chgszdqfzjc20231117.TriggerEvent_local
23
chgszdqfzjc20231117.VibrationData_local
494884251
chgszdqfzjc20231117.VibrationData_materialized_local
198286
chgszdqfzjc20231117.WeightingData_local
0
cqhhdq20221230.LufftData_local
0
dyhhgldq20231120.AxleLoadAtlas_local
0
dyhhgldq20231120.ClockTaskSampleInfoAndTriggerSampleInfo_local
0
dyhhgldq20231120.ClockTaskSampleInfo_local
0
dyhhgldq20231120.ClockTaskTimeInfoSensorNode_local
0
dyhhgldq20231120.DistanceContData_local
1506328581
dyhhgldq20231120.DistanceContData_materialized_local
1081033
dyhhgldq20231120.InitIncliInfo_local
0
dyhhgldq20231120.PowerStateNodeData_local
0
dyhhgldq20231120.RadarCamera_local
0
dyhhgldq20231120.SensorConfigInfoHIS400_local
0
dyhhgldq20231120.SerialNumber_local
0
dyhhgldq20231120.SoftVersion_local
0
dyhhgldq20231120.StressData_materialized_local
1423085
dyhhgldq20231120.TempHumiContData_materialized_local
1562454
dyhhgldq20231120.TopInfoNodeData_local
0
dyhhgldq20231120.TrafficFlowData_local
0
dyhhgldq20231120.TriggerEvent_local
0
dyhhgldq20231120.VibrationData_materialized_local
585168
dyhhgldq20231120.WeightingData_local
0
ghzhl20200602.TempHumiContData_local
215881
hxdlgfhdq20231128.AxleLoadAtlas_local
0
hxdlgfhdq20231128.ClockTaskSampleInfoAndTriggerSampleInfo_local
0
hxdlgfhdq20231128.ClockTaskSampleInfo_local
0
hxdlgfhdq20231128.ClockTaskTimeInfoSensorNode_local
0
hxdlgfhdq20231128.DistanceContData_local
0
hxdlgfhdq20231128.DistanceContData_materialized_local
0
hxdlgfhdq20231128.InitIncliInfo_local
0
hxdlgfhdq20231128.PowerStateNodeData_local
0
hxdlgfhdq20231128.SensorConfigInfoHIS400_local
0
hxdlgfhdq20231128.SerialNumber_local
0
hxdlgfhdq20231128.SoftVersion_local
0
hxdlgfhdq20231128.StressData_local
167398879
hxdlgfhdq20231128.StressData_materialized_local
109819
hxdlgfhdq20231128.TempHumiContData_local
5449
hxdlgfhdq20231128.TempHumiContData_materialized_local
2624
hxdlgfhdq20231128.TopInfoNodeData_local
0
hxdlgfhdq20231128.TrafficFlowData_local
0
hxdlgfhdq20231128.TriggerEvent_local
0
hxdlgfhdq20231128.VibrationData_local
262130599
hxdlgfhdq20231128.VibrationData_materialized_local
109947
hxdlgfhdq20231128.WeightingData_local
0
jzlgfhdq20231128.AxleLoadAtlas_local
0
jzlgfhdq20231128.ClockTaskSampleInfoAndTriggerSampleInfo_local
0
jzlgfhdq20231128.ClockTaskSampleInfo_local
0
jzlgfhdq20231128.ClockTaskTimeInfoSensorNode_local
0
jzlgfhdq20231128.DistanceContData_local
0
jzlgfhdq20231128.DistanceContData_materialized_local
0
jzlgfhdq20231128.InitIncliInfo_local
0
jzlgfhdq20231128.PowerStateNodeData_local
0
jzlgfhdq20231128.SensorConfigInfoHIS400_local
0
jzlgfhdq20231128.SerialNumber_local
0
jzlgfhdq20231128.SoftVersion_local
0
jzlgfhdq20231128.StressData_local
342007046
jzlgfhdq20231128.StressData_materialized_local
221175
jzlgfhdq20231128.TempHumiContData_local
317237
jzlgfhdq20231128.TempHumiContData_materialized_local
46655
jzlgfhdq20231128.TopInfoNodeData_local
0
jzlgfhdq20231128.TrafficFlowData_local
0
jzlgfhdq20231128.TriggerEvent_local
0
jzlgfhdq20231128.VibrationData_local
594282315
jzlgfhdq20231128.VibrationData_materialized_local
247654
jzlgfhdq20231128.WeightingData_local
0
ljyhxtdq20231215.AnemometerContData_local
0
ljyhxtdq20231215.AnemometerContData_materialized_local
0
ljyhxtdq20231215.AxleLoadAtlas_local
0
ljyhxtdq20231215.ClockTaskSampleInfoAndTriggerSampleInfo_local
0
ljyhxtdq20231215.ClockTaskSampleInfo_local
0
ljyhxtdq20231215.ClockTaskTimeInfoSensorNode_local
0
ljyhxtdq20231215.DistanceContData_local
0
ljyhxtdq20231215.DistanceContData_materialized_local
0
ljyhxtdq20231215.IncliContData_local
0
ljyhxtdq20231215.IncliContData_materialized_local
0
ljyhxtdq20231215.InitIncliInfo_local
0
ljyhxtdq20231215.PowerStateNodeData_local
0
ljyhxtdq20231215.SensorConfigInfoHIS400_local
0
ljyhxtdq20231215.SerialNumber_local
0
ljyhxtdq20231215.SoftVersion_local
0
ljyhxtdq20231215.StressData_local
0
ljyhxtdq20231215.StressData_materialized_local
0
ljyhxtdq20231215.TempHumiContData_local
0
ljyhxtdq20231215.TempHumiContData_materialized_local
0
ljyhxtdq20231215.TopInfoNodeData_local
0
ljyhxtdq20231215.TrafficFlowData_local
0
ljyhxtdq20231215.TriggerEvent_local
0
ljyhxtdq20231215.VibrationData_local
0
ljyhxtdq20231215.VibrationData_materialized_local
0
ljyhxtdq20231215.WeightingData_local
0
nehjhdyhq20231215.AnemometerContData_local
0
nehjhdyhq20231215.AnemometerContData_materialized_local
0
nehjhdyhq20231215.AxleLoadAtlas_local
2684
nehjhdyhq20231215.CablePeaksData_local
0
nehjhdyhq20231215.CablePeaksData_materialized_local
0
nehjhdyhq20231215.ClockTaskSampleInfoAndTriggerSampleInfo_local
0
nehjhdyhq20231215.ClockTaskSampleInfo_local
0
nehjhdyhq20231215.ClockTaskTimeInfoSensorNode_local
0
nehjhdyhq20231215.DistanceContData_local
0
nehjhdyhq20231215.DistanceContData_materialized_local
0
nehjhdyhq20231215.InitIncliInfo_local
0
nehjhdyhq20231215.PowerStateNodeData_local
0
nehjhdyhq20231215.SensorConfigInfoHIS400_local
0
nehjhdyhq20231215.SerialNumber_local
0
nehjhdyhq20231215.SoftVersion_local
0
nehjhdyhq20231215.StressData_local
0
nehjhdyhq20231215.StressData_materialized_local
0
nehjhdyhq20231215.TempHumiContData_local
0
nehjhdyhq20231215.TempHumiContData_materialized_local
0
nehjhdyhq20231215.TempHumiData_local
0
nehjhdyhq20231215.TopInfoNodeData_local
0
nehjhdyhq20231215.TrafficFlowData_local
0
nehjhdyhq20231215.TriggerEvent_local
0
nehjhdyhq20231215.VibrationData_local
0
nehjhdyhq20231215.VibrationData_materialized_local
0
plsd20200602.LufftData_local
60216
qygsjnhhdqzq20200426.IncliContData_local
0
qygsjnhhdqzq20200426.IncliContData_materialized_local
0
rygfhdq20231215.AnemometerContData_local
0
rygfhdq20231215.AnemometerContData_materialized_local
0
rygfhdq20231215.AxleLoadAtlas_local
0
rygfhdq20231215.ClockTaskSampleInfoAndTriggerSampleInfo_local
0
rygfhdq20231215.ClockTaskSampleInfo_local
0
rygfhdq20231215.ClockTaskTimeInfoSensorNode_local
0
rygfhdq20231215.DistanceContData_local
0
rygfhdq20231215.DistanceContData_materialized_local
0
rygfhdq20231215.IncliContData_local
0
rygfhdq20231215.IncliContData_materialized_local
0
rygfhdq20231215.InitIncliInfo_local
0
rygfhdq20231215.PowerStateNodeData_local
0
rygfhdq20231215.SensorConfigInfoHIS400_local
0
rygfhdq20231215.SerialNumber_local
0
rygfhdq20231215.SoftVersion_local
0
rygfhdq20231215.StressData_local
0
rygfhdq20231215.StressData_materialized_local
0
rygfhdq20231215.TempHumiContData_local
0
rygfhdq20231215.TempHumiContData_materialized_local
0
rygfhdq20231215.TopInfoNodeData_local
0
rygfhdq20231215.TrafficFlowData_local
0
rygfhdq20231215.TriggerEvent_local
0
rygfhdq20231215.VibrationData_local
0
rygfhdq20231215.VibrationData_materialized_local
0
rygfhdq20231215.WeightingData_local
0
tzgjq20211109.VibrationData_materialized_local
176972
yhlgjq20231207.AxleLoadAtlas_local
0
yhlgjq20231207.ClockTaskSampleInfoAndTriggerSampleInfo_local
0
yhlgjq20231207.ClockTaskSampleInfo_local
0
yhlgjq20231207.ClockTaskTimeInfoSensorNode_local
0
yhlgjq20231207.DistanceContData_local
0
yhlgjq20231207.DistanceContData_materialized_local
0
yhlgjq20231207.InitIncliInfo_local
0
yhlgjq20231207.PowerStateNodeData_local
0
yhlgjq20231207.SensorConfigInfoHIS400_local
0
yhlgjq20231207.SerialNumber_local
0
yhlgjq20231207.SoftVersion_local
0
yhlgjq20231207.StressData_local
0
yhlgjq20231207.StressData_materialized_local
0
yhlgjq20231207.TempHumiContData_local
0
yhlgjq20231207.TempHumiContData_materialized_local
0
yhlgjq20231207.TopInfoNodeData_local
0
yhlgjq20231207.TrafficFlowData_local
0
yhlgjq20231207.TriggerEvent_local
0
yhlgjq20231207.VibrationData_local
0
yhlgjq20231207.VibrationData_materialized_local
0
yhlgjq20231207.WeightingData_local
0
root@clickhouse04:~# 
```



#### 2.4、执行Restore Replica

**clickhouse03中操作**

然后在clickhouse03中**Restore Replica**

这一步,非常重要

![image-20231224160436669](https://iteshell.oss-cn-beijing.aliyuncs.com/bookshell/operator/image-20231224160436669.png)



执行命令

```shell
for i in `cat 3.txt `; do echo $i && sleep 1 && clickhouse-client -q "system restore replica  ${i} "; done
```

备注： 因为这里只有这一个节点有问题，所以就不需要加on cluster来执行，只需要修复clickhouse03节点即可



#### 2.5、收集**Restore Replica** 之后存在异常的表

错误问题记录1 

执行的过程中，有两个报错 

报错提示1：

![image-20231224160528306](https://iteshell.oss-cn-beijing.aliyuncs.com/bookshell/operator/image-20231224160528306.png)

报错提示2：

![image-20231224160743002](https://iteshell.oss-cn-beijing.aliyuncs.com/bookshell/operator/image-20231224160743002.png)



错误问题，暂时我们记下，暂时忽略此问题

观察服务器带宽,已经从clickhouse04同步clickhouse03数据了。

![image-20231224160948656](https://iteshell.oss-cn-beijing.aliyuncs.com/bookshell/operator/image-20231224160948656.png)





查看磁盘使用情况

![image-20231224161034365](https://iteshell.oss-cn-beijing.aliyuncs.com/bookshell/operator/image-20231224161034365.png)





zk验证：发现已经有了元数据

![](https://iteshell.oss-cn-beijing.aliyuncs.com/bookshell/operator/image-20231224161204081.png)



同步数据时刻的监控数据，有明显的持续增高趋势



![image-20231224161938309](https://iteshell.oss-cn-beijing.aliyuncs.com/bookshell/operator/image-20231224161938309.png)





**异常问题readonly核实记录2:**

现在需要核实下**clickhouse03**还有没有异常的只读表，因为当前已经更新了zk的记录，可能还存在异常有问题的。需要手动在核实一次。确定都是Ok的

![image-20231224163312594](https://iteshell.oss-cn-beijing.aliyuncs.com/bookshell/operator/image-20231224163312594.png)



发现还存在三张异常的，这个需要单独在处理下，先查询下是否有数据，经过下面的排查已经显示有数据了



![image-20231224163852066](https://iteshell.oss-cn-beijing.aliyuncs.com/bookshell/operator/image-20231224163852066.png)





zk中查看是否有元数据，目前来看已经存在元数据了。

![image-20231224163803248](https://iteshell.oss-cn-beijing.aliyuncs.com/bookshell/operator/image-20231224163803248.png)



这个问题，我们需要单独处理  ，这个跟前面执行**Restore Replica** 报错是相关的



问题核实记录3： 

对于导出的数据进行比对，找到出现问题的表。目前已经基本锁定出问题的表为 tzgjq20211109.VibrationData_materialized_local

![image-20231224234431697](https://iteshell.oss-cn-beijing.aliyuncs.com/bookshell/operator/image-20231224234431697.png)



接下来，对改变进行修复

#### 2.6、不一致表问题处理

tzgjq20211109.VibrationData_materialized_local  处理此表的问题

**复制配置问题：**确保表没有被标记为只读。可以使用以下命令检查：

```shell
clickhouse03 :) SELECT * FROM system.replicas WHERE database = 'tzgjq20211109' and   table = 'VibrationData_materialized_local'\G;

SELECT *
FROM system.replicas
WHERE (database = 'tzgjq20211109') AND (table = 'VibrationData_materialized_local')

Query id: 3103ff54-4204-445c-9771-485422a6dfcd

Row 1:
──────
database:                    tzgjq20211109
table:                       VibrationData_materialized_local
engine:                      ReplicatedAggregatingMergeTree
is_leader:                   0
can_become_leader:           1
is_readonly:                 1                ##看此处
is_session_expired:          0
future_parts:                0
parts_to_check:              0
zookeeper_path:              /clickhouse/01-02/tables/"tzgjq20211109".VibrationData_materialized_local
replica_name:                ekc03
replica_path:                /clickhouse/01-02/tables/"tzgjq20211109".VibrationData_materialized_local/replicas/ekc03
columns_version:             -1
queue_size:                  0
inserts_in_queue:            0
merges_in_queue:             0
part_mutations_in_queue:     0
queue_oldest_time:           1970-01-01 08:00:00
inserts_oldest_time:         1970-01-01 08:00:00
merges_oldest_time:          1970-01-01 08:00:00
part_mutations_oldest_time:  1970-01-01 08:00:00
oldest_part_to_get:          
oldest_part_to_merge_to:     
oldest_part_to_mutate_to:    
log_max_index:               300940
log_pointer:                 278345
last_queue_update:           1970-01-01 08:00:00
absolute_delay:              1703421376
total_replicas:              2
active_replicas:             1
lost_part_count:             0
last_queue_update_exception: 
zookeeper_exception:         
replica_is_active:           {'ekc03':0,'ekc04':1}

1 row in set. Elapsed: 0.009 sec. 
```





**系统表检查：** 检查 ClickHouse 中的系统表以获取有关表状态的更多信息。例如，可以运行以下查询

```shell
SELECT * FROM system.tables WHERE database = 'tzgjq20211109' AND name = 'VibrationData_materialized_local' \G;
```





![image-20231224204346121](https://iteshell.oss-cn-beijing.aliyuncs.com/bookshell/operator/image-20231224204346121.png)



似乎看不出什么重要的信息

尝试执行restore replica

```shell
clickhouse03 :) system restore replica tzgjq20211109.VibrationData_materialized_local

SYSTEM RESTORE REPLICA tzgjq20211109.VibrationData_materialized_local

Query id: 2905be46-d090-4211-8155-d2f44417bcae


0 rows in set. Elapsed: 0.008 sec. 

Received exception from server (version 23.4.2):
Code: 36. DB::Exception: Received from 127.0.0.1:9000. DB::Exception: Replica path is present at /clickhouse/01-02/tables/"tzgjq20211109".VibrationData_materialized_local/replicas/ekc03 - nothing to restore. If you are sure that metadata is lost and that replica path contains some garbage, then use SYSTEM DROP REPLICA query first.. (BAD_ARGUMENTS)


clickhouse03 :) SYSTEM DROP REPLICA '/clickhouse/01-02/tables/tzgjq20211109.VibrationData_materialized_local/replicas/ekc03';


SYSTEM DROP REPLICA '/clickhouse/01-02/tables/tzgjq20211109.VibrationData_materialized_local/replicas/ekc03'

Query id: 91775ddc-7ca5-456d-bed0-38ed8931da75


0 rows in set. Elapsed: 0.004 sec. 

Received exception from server (version 23.4.2):
Code: 999. DB::Exception: Received from 127.0.0.1:9000. Coordination::Exception. Coordination::Exception: Bad arguments, path: /clickhouse/01-02/tables/"bjgsbp20200828".AxleLoadAtlas_local/replicas//clickhouse/01-02/tables/tzgjq20211109.VibrationData_materialized_local/replicas/ekc03/is_lost. (KEEPER_EXCEPTION)

```

执行SYSTEM DROP REPLICA 提示错误信息，错误的参数





**最后就是终极解决方式**

因为当前似乎在zk中存在相关元数据信息，大那是似乎看着副本是readonly, 根据提示信息，遇到了无法处理的参数。这通常发生在执行还原（restore）操作时，ClickHouse 发现没有需要还原的内容，或者发现 replica path（副本路径）包含一些垃圾数据。所以，接下来就是重新创建副本表



在clickhouse04节点上查看表创建方式

```shell
clickhouse04 :) show create table tzgjq20211109.VibrationData_materialized_local

SHOW CREATE TABLE tzgjq20211109.VibrationData_materialized_local

Query id: 173f4cb4-7350-4c8e-8aef-b16b4dfa766f

┌─statement──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│ CREATE TABLE tzgjq20211109.VibrationData_materialized_local
(
    `packet_name` String,
    `node_id` String,
    `gateway_id` String,
    `minute_unix_time` DateTime,
    `channel` String,
    `err_comment` String,
    `project_name` String,
    `module_name` String,
    `sensor_id` String,
    `ver` UInt32,
    `avg_data` Float64,
    `max_data` SimpleAggregateFunction(max, Float64),
    `min_data` SimpleAggregateFunction(min, Float64),
    `sum_data` SimpleAggregateFunction(sum, Float64),
    `num_data` SimpleAggregateFunction(sum, Int64),
    `squaresum_data` SimpleAggregateFunction(sum, Float64),
    `avg_sample_interval` Float64,
    `max_sample_interval` SimpleAggregateFunction(max, Float64),
    `min_sample_interval` SimpleAggregateFunction(min, Float64),
    `sum_sample_interval` SimpleAggregateFunction(sum, Float64),
    `num_sample_interval` SimpleAggregateFunction(sum, Int64),
    `squaresum_sample_interval` SimpleAggregateFunction(sum, Float64),
    `avg_speed` Float64,
    `max_speed` SimpleAggregateFunction(max, Float64),
    `min_speed` SimpleAggregateFunction(min, Float64),
    `sum_speed` SimpleAggregateFunction(sum, Float64),
    `num_speed` SimpleAggregateFunction(sum, Int64),
    `squaresum_speed` SimpleAggregateFunction(sum, Float64),
    `avg_speed_x` Float64,
    `max_speed_x` SimpleAggregateFunction(max, Float64),
    `min_speed_x` SimpleAggregateFunction(min, Float64),
    `sum_speed_x` SimpleAggregateFunction(sum, Float64),
    `num_speed_x` SimpleAggregateFunction(sum, Int64),
    `squaresum_speed_x` SimpleAggregateFunction(sum, Float64),
    `avg_speed_y` Float64,
    `max_speed_y` SimpleAggregateFunction(max, Float64),
    `min_speed_y` SimpleAggregateFunction(min, Float64),
    `sum_speed_y` SimpleAggregateFunction(sum, Float64),
    `num_speed_y` SimpleAggregateFunction(sum, Int64),
    `squaresum_speed_y` SimpleAggregateFunction(sum, Float64),
    `avg_speed_z` Float64,
    `max_speed_z` SimpleAggregateFunction(max, Float64),
    `min_speed_z` SimpleAggregateFunction(min, Float64),
    `sum_speed_z` SimpleAggregateFunction(sum, Float64),
    `num_speed_z` SimpleAggregateFunction(sum, Int64),
    `squaresum_speed_z` SimpleAggregateFunction(sum, Float64),
    `count` SimpleAggregateFunction(sum, Int64),
    `start_unix_time` SimpleAggregateFunction(min, Float64),
    `end_unix_time` SimpleAggregateFunction(max, Float64),
    `avg_acc` Float64,
    `max_acc` SimpleAggregateFunction(max, Float64),
    `min_acc` SimpleAggregateFunction(min, Float64),
    `sum_acc` SimpleAggregateFunction(sum, Float64),
    `num_acc` SimpleAggregateFunction(sum, Int64),
    `squaresum_acc` SimpleAggregateFunction(sum, Float64),
    `avg_acc_peek_to_peek` Float64,
    `max_acc_peek_to_peek` SimpleAggregateFunction(max, Float64),
    `min_acc_peek_to_peek` SimpleAggregateFunction(min, Float64),
    `sum_acc_peek_to_peek` SimpleAggregateFunction(sum, Float64),
    `num_acc_peek_to_peek` SimpleAggregateFunction(sum, Int64),
    `squaresum_acc_peek_to_peek` SimpleAggregateFunction(sum, Float64),
    `avg_acc_max_abs` Float64,
    `max_acc_max_abs` SimpleAggregateFunction(max, Float64),
    `min_acc_max_abs` SimpleAggregateFunction(min, Float64),
    `sum_acc_max_abs` SimpleAggregateFunction(sum, Float64),
    `num_acc_max_abs` SimpleAggregateFunction(sum, Int64),
    `squaresum_acc_max_abs` SimpleAggregateFunction(sum, Float64),
    `avg_freq` Float64,
    `max_freq` SimpleAggregateFunction(max, Float64),
    `min_freq` SimpleAggregateFunction(min, Float64),
    `sum_freq` SimpleAggregateFunction(sum, Float64),
    `num_freq` SimpleAggregateFunction(sum, Int64),
    `squaresum_freq` SimpleAggregateFunction(sum, Float64),
    `avg_acc_rms` Float64,
    `max_acc_rms` SimpleAggregateFunction(max, Float64),
    `min_acc_rms` SimpleAggregateFunction(min, Float64),
    `sum_acc_rms` SimpleAggregateFunction(sum, Float64),
    `num_acc_rms` SimpleAggregateFunction(sum, Int64),
    `squaresum_acc_rms` SimpleAggregateFunction(sum, Float64),
    `avg_acc_level` Float64,
    `max_acc_level` SimpleAggregateFunction(max, Float64),
    `min_acc_level` SimpleAggregateFunction(min, Float64),
    `sum_acc_level` SimpleAggregateFunction(sum, Float64),
    `num_acc_level` SimpleAggregateFunction(sum, Int64),
    `squaresum_acc_level` SimpleAggregateFunction(sum, Float64),
    `uuid` String,
    `debug_session_id` String,
    `manual_batch_id` String
)
ENGINE = ReplicatedAggregatingMergeTree('/clickhouse/{layer}-{shard}/tables/"tzgjq20211109".VibrationData_materialized_local', '{replica}')
PARTITION BY toYYYYMM(minute_unix_time)
ORDER BY (module_name, sensor_id, node_id, channel, minute_unix_time)
SETTINGS index_granularity = 8192
```



clickhouse03中操作

```shell
##先删除表，这个时候另外一个节点副本不会删除的
drop table tzgjq20211109.VibrationData_materialized_local


##然后从clickhouse04拿过来创建命令创建表
CREATE TABLE tzgjq20211109.VibrationData_materialized_local
(
    `packet_name` String,
    `node_id` String,
    `gateway_id` String,
    `minute_unix_time` DateTime,
    `channel` String,
    `err_comment` String,
    `project_name` String,
    `module_name` String,
    `sensor_id` String,
    `ver` UInt32,
    `avg_data` Float64,
    `max_data` SimpleAggregateFunction(max, Float64),
    `min_data` SimpleAggregateFunction(min, Float64),
    `sum_data` SimpleAggregateFunction(sum, Float64),
    `num_data` SimpleAggregateFunction(sum, Int64),
    `squaresum_data` SimpleAggregateFunction(sum, Float64),
    `avg_sample_interval` Float64,
    `max_sample_interval` SimpleAggregateFunction(max, Float64),
    `min_sample_interval` SimpleAggregateFunction(min, Float64),
    `sum_sample_interval` SimpleAggregateFunction(sum, Float64),
    `num_sample_interval` SimpleAggregateFunction(sum, Int64),
    `squaresum_sample_interval` SimpleAggregateFunction(sum, Float64),
    `avg_speed` Float64,
    `max_speed` SimpleAggregateFunction(max, Float64),
    `min_speed` SimpleAggregateFunction(min, Float64),
    `sum_speed` SimpleAggregateFunction(sum, Float64),
    `num_speed` SimpleAggregateFunction(sum, Int64),
    `squaresum_speed` SimpleAggregateFunction(sum, Float64),
    `avg_speed_x` Float64,
    `max_speed_x` SimpleAggregateFunction(max, Float64),
    `min_speed_x` SimpleAggregateFunction(min, Float64),
    `sum_speed_x` SimpleAggregateFunction(sum, Float64),
    `num_speed_x` SimpleAggregateFunction(sum, Int64),
    `squaresum_speed_x` SimpleAggregateFunction(sum, Float64),
    `avg_speed_y` Float64,
    `max_speed_y` SimpleAggregateFunction(max, Float64),
    `min_speed_y` SimpleAggregateFunction(min, Float64),
    `sum_speed_y` SimpleAggregateFunction(sum, Float64),
    `num_speed_y` SimpleAggregateFunction(sum, Int64),
    `squaresum_speed_y` SimpleAggregateFunction(sum, Float64),
    `avg_speed_z` Float64,
    `max_speed_z` SimpleAggregateFunction(max, Float64),
    `min_speed_z` SimpleAggregateFunction(min, Float64),
    `sum_speed_z` SimpleAggregateFunction(sum, Float64),
    `num_speed_z` SimpleAggregateFunction(sum, Int64),
    `squaresum_speed_z` SimpleAggregateFunction(sum, Float64),
    `count` SimpleAggregateFunction(sum, Int64),
    `start_unix_time` SimpleAggregateFunction(min, Float64),
    `end_unix_time` SimpleAggregateFunction(max, Float64),
    `avg_acc` Float64,
    `max_acc` SimpleAggregateFunction(max, Float64),
    `min_acc` SimpleAggregateFunction(min, Float64),
    `sum_acc` SimpleAggregateFunction(sum, Float64),
    `num_acc` SimpleAggregateFunction(sum, Int64),
    `squaresum_acc` SimpleAggregateFunction(sum, Float64),
    `avg_acc_peek_to_peek` Float64,
    `max_acc_peek_to_peek` SimpleAggregateFunction(max, Float64),
    `min_acc_peek_to_peek` SimpleAggregateFunction(min, Float64),
    `sum_acc_peek_to_peek` SimpleAggregateFunction(sum, Float64),
    `num_acc_peek_to_peek` SimpleAggregateFunction(sum, Int64),
    `squaresum_acc_peek_to_peek` SimpleAggregateFunction(sum, Float64),
    `avg_acc_max_abs` Float64,
    `max_acc_max_abs` SimpleAggregateFunction(max, Float64),
    `min_acc_max_abs` SimpleAggregateFunction(min, Float64),
    `sum_acc_max_abs` SimpleAggregateFunction(sum, Float64),
    `num_acc_max_abs` SimpleAggregateFunction(sum, Int64),
    `squaresum_acc_max_abs` SimpleAggregateFunction(sum, Float64),
    `avg_freq` Float64,
    `max_freq` SimpleAggregateFunction(max, Float64),
    `min_freq` SimpleAggregateFunction(min, Float64),
    `sum_freq` SimpleAggregateFunction(sum, Float64),
    `num_freq` SimpleAggregateFunction(sum, Int64),
    `squaresum_freq` SimpleAggregateFunction(sum, Float64),
    `avg_acc_rms` Float64,
    `max_acc_rms` SimpleAggregateFunction(max, Float64),
    `min_acc_rms` SimpleAggregateFunction(min, Float64),
    `sum_acc_rms` SimpleAggregateFunction(sum, Float64),
    `num_acc_rms` SimpleAggregateFunction(sum, Int64),
    `squaresum_acc_rms` SimpleAggregateFunction(sum, Float64),
    `avg_acc_level` Float64,
    `max_acc_level` SimpleAggregateFunction(max, Float64),
    `min_acc_level` SimpleAggregateFunction(min, Float64),
    `sum_acc_level` SimpleAggregateFunction(sum, Float64),
    `num_acc_level` SimpleAggregateFunction(sum, Int64),
    `squaresum_acc_level` SimpleAggregateFunction(sum, Float64),
    `uuid` String,
    `debug_session_id` String,
    `manual_batch_id` String
)
ENGINE = ReplicatedAggregatingMergeTree('/clickhouse/{layer}-{shard}/tables/"tzgjq20211109".VibrationData_materialized_local', '{replica}')
PARTITION BY toYYYYMM(minute_unix_time)
ORDER BY (module_name, sensor_id, node_id, channel, minute_unix_time)
SETTINGS index_granularity = 8192

Query id: e40b3097-2a2b-47ae-ba89-12ca27528a10


0 rows in set. Elapsed: 0.029 sec. 

Received exception from server (version 23.4.2):
Code: 253. DB::Exception: Received from 127.0.0.1:9000. DB::Exception: Replica /clickhouse/01-02/tables/"tzgjq20211109".VibrationData_materialized_local/replicas/ekc03 already exists. (REPLICA_ALREADY_EXISTS)

```

上面提示错误，clickhouse默认的库引擎是原子数据库引擎，删除[Atomic](https://so.csdn.net/so/search?q=Atomic&spm=1001.2101.3001.7020)数据库中的表后，它不会立即删除，而是会在480秒后删除。由下面这个参数控制：

```shell
<database_atomic_delay_before_drop_table_sec>480</database_atomic_delay_before_drop_table_sec>
```



**解决方法**

1.修改config.xml的配置database_atomic_delay_before_drop_table_sec为0

2.最原始方法，等待480秒后再重新建表

为了保险起见，我用的第二种方法，再次创建成功，不建议修改配置

等待了好长时间，在此创建，创建成功

```shell
clickhouse03 :) CREATE TABLE tzgjq20211109.VibrationData_materialized_local
(
    `packet_name` String,
    `node_id` String,
    `gateway_id` String,
    `minute_unix_time` DateTime,
    `channel` String,
    `err_comment` String,
    `project_name` String,
    `module_name` String,
    `sensor_id` String,
    `ver` UInt32,
    `avg_data` Float64,
    `max_data` SimpleAggregateFunction(max, Float64),
    `min_data` SimpleAggregateFunction(min, Float64),
    `sum_data` SimpleAggregateFunction(sum, Float64),
    `num_data` SimpleAggregateFunction(sum, Int64),
    `squaresum_data` SimpleAggregateFunction(sum, Float64),
    `avg_sample_interval` Float64,
    `max_sample_interval` SimpleAggregateFunction(max, Float64),
    `min_sample_interval` SimpleAggregateFunction(min, Float64),
    `sum_sample_interval` SimpleAggregateFunction(sum, Float64),
    `num_sample_interval` SimpleAggregateFunction(sum, Int64),
    `squaresum_sample_interval` SimpleAggregateFunction(sum, Float64),
    `avg_speed` Float64,
    `max_speed` SimpleAggregateFunction(max, Float64),
    `min_speed` SimpleAggregateFunction(min, Float64),
    `sum_speed` SimpleAggregateFunction(sum, Float64),
    `num_speed` SimpleAggregateFunction(sum, Int64),
    `squaresum_speed` SimpleAggregateFunction(sum, Float64),
    `avg_speed_x` Float64,
    `max_speed_x` SimpleAggregateFunction(max, Float64),
    `min_speed_x` SimpleAggregateFunction(min, Float64),
    `sum_speed_x` SimpleAggregateFunction(sum, Float64),
    `num_speed_x` SimpleAggregateFunction(sum, Int64),
    `squaresum_speed_x` SimpleAggregateFunction(sum, Float64),
    `avg_speed_y` Float64,
    `max_speed_y` SimpleAggregateFunction(max, Float64),
    `min_speed_y` SimpleAggregateFunction(min, Float64),
    `sum_speed_y` SimpleAggregateFunction(sum, Float64),
    `num_speed_y` SimpleAggregateFunction(sum, Int64),
    `squaresum_speed_y` SimpleAggregateFunction(sum, Float64),
    `avg_speed_z` Float64,
    `max_speed_z` SimpleAggregateFunction(max, Float64),
    `min_speed_z` SimpleAggregateFunction(min, Float64),
    `sum_speed_zCREATE TABLE tzgjq20211109.VibrationData_materialized_local
(
    `packet_name` String,
    `node_id` String,
    `gateway_id` String,
    `minute_unix_time` DateTime,
    `channel` String,
    `err_comment` String,
    `project_name` String,
    `module_name` String,
    `sensor_id` String,
    `ver` UInt32,
    `avg_data` Float64,
    `max_data` SimpleAggregateFunction(max, Float64),
    `min_data` SimpleAggregateFunction(min, Float64),
    `sum_data` SimpleAggregateFunction(sum, Float64),
    `num_data` SimpleAggregateFunction(sum, Int64),
    `squaresum_data` SimpleAggregateFunction(sum, Float64),
    `avg_sample_interval` Float64,
    `max_sample_interval` SimpleAggregateFunction(max, Float64),
    `min_sample_interval` SimpleAggregateFunction(min, Float64),
    `sum_sample_interval` SimpleAggregateFunction(sum, Float64),
    `num_sample_interval` SimpleAggregateFunction(sum, Int64),
    `squaresum_sample_interval` SimpleAggregateFunction(sum, Float64),
    `avg_speed` Float64,
    `max_speed` SimpleAggregateFunction(max, Float64),
    `min_speed` SimpleAggregateFunction(min, Float64),
    `sum_speed` SimpleAggregateFunction(sum, Float64),
    `num_speed` SimpleAggregateFunction(sum, Int64),
    `squaresum_speed` SimpleAggregateFunction(sum, Float64),
    `avg_speed_x` Float64,
    `max_speed_x` SimpleAggregateFunction(max, Float64),
    `min_speed_x` SimpleAggregateFunction(min, Float64),
    `sum_speed_x` SimpleAggregateFunction(sum, Float64),
    `num_speed_x` SimpleAggregateFunction(sum, Int64),
    `squaresum_speed_x` SimpleAggregateFunction(sum, Float64),
    `avg_speed_y` Float64,
    `max_speed_y` SimpleAggregateFunction(max, Float64),
    `min_speed_y` SimpleAggregateFunction(min, Float64),
    `sum_speed_y` SimpleAggregateFunction(sum, Float64),
    `num_speed_y` SimpleAggregateFunction(sum, Int64),
    `squaresum_speed_y` SimpleAggregateFunction(sum, Float64),
    `avg_speed_z` Float64,
    `max_speed_z` SimpleAggregateFunction(max, Float64),
    `min_speed_z` SimpleAggregateFunction(min, Float64),
    `sum_speed_z` SimpleAggregateFunction(sum, Float64),
    `num_speed_z` SimpleAggregateFunction(sum, Int64),
    `squaresum_speed_z` SimpleAggregateFunction(sum, Float64),
    `count` SimpleAggregateFunction(sum, Int64),
    `start_unix_time` SimpleAggregateFunction(min, Float64),
    `end_unix_time` SimpleAggregateFunction(max, Float64),
    `avg_acc` Float64,
    `max_acc` SimpleAggregateFunction(max, Float64),
    `min_acc` SimpleAggregateFunction(min, Float64),
    `sum_acc` SimpleAggregateFunction(sum, Float64),
    `num_acc` SimpleAggregateFunction(sum, Int64),
    `squaresum_acc` SimpleAggregateFunction(sum, Float64),
    `avg_acc_peek_to_peek` Float64,
    `max_acc_peek_to_peek` SimpleAggregateFunction(max, Float64),
    `min_acc_peek_to_peek` SimpleAggregateFunction(min, Float64),
    `sum_acc_peek_to_peek` SimpleAggregateFunction(sum, Float64),
    `num_acc_peek_to_peek` SimpleAggregateFunction(sum, Int64),
    `squaresum_acc_peek_to_peek` SimpleAggregateFunction(sum, Float64),
    `avg_acc_max_abs` Float64,
    `max_acc_max_abs` SimpleAggregateFunction(max, Float64),
    `min_acc_max_abs` SimpleAggregateFunction(min, Float64),
    `sum_acc_max_abs` SimpleAggregateFunction(sum, Float64),
    `num_acc_max_abs` SimpleAggregateFunction(sum, Int64),
    `squaresum_acc_max_abs` SimpleAggregateFunction(sum, Float64),
    `avg_freq` Float64,
    `max_freq` SimpleAggregateFunction(max, Float64),
    `min_freq` SimpleAggregateFunction(min, Float64),
    `sum_freq` SimpleAggregateFunction(sum, Float64),
    `num_freq` SimpleAggregateFunction(sum, Int64),
    `squaresum_freq` SimpleAggregateFunction(sum, Float64),
    `avg_acc_rms` Float64,
    `max_acc_rms` SimpleAggregateFunction(max, Float64),
    `min_acc_rms` SimpleAggregateFunction(min, Float64),
    `sum_acc_rms` SimpleAggregateFunction(sum, Float64),
    `num_acc_rms` SimpleAggregateFunction(sum, Int64),
    `squaresum_acc_rms` SimpleAggregateFunction(sum, Float64),
    `avg_acc_level` Float64,
    `max_acc_level` SimpleAggregateFunction(max, Float64),
    `min_acc_level` SimpleAggregateFunction(min, Float64),
    `sum_acc_level` SimpleAggregateFunction(sum, Float64),
    `num_acc_level` SimpleAggregateFunction(sum, Int64),
    `squaresum_acc_level` SimpleAggregateFunction(sum, Float64),
    `uuid` String,
    `debug_session_id` String,
    `manual_batch_id` String
)
ENGINE = ReplicatedAggregatingMergeTree('/clickhouse/{layer}-{shard}/tables/"tzgjq20211109".VibrationData_materialized_local', '{replica}')
PARTITION BY toYYYYMM(minute_unix_time)
ORDER BY (module_name, sensor_id, node_id, channel, minute_unix_time)
SETTINGS index_granularity = 8192

CREATE TABLE tzgjq20211109.VibrationData_materialized_local
(
    `packet_name` String,
    `node_id` String,
    `gateway_id` String,
    `minute_unix_time` DateTime,
    `channel` String,
    `err_comment` String,
    `project_name` String,
    `module_name` String,
    `sensor_id` String,
    `ver` UInt32,
    `avg_data` Float64,
    `max_data` SimpleAggregateFunction(max, Float64),
    `min_data` SimpleAggregateFunction(min, Float64),
    `sum_data` SimpleAggregateFunction(sum, Float64),
    `num_data` SimpleAggregateFunction(sum, Int64),
    `squaresum_data` SimpleAggregateFunction(sum, Float64),
    `avg_sample_interval` Float64,
    `max_sample_interval` SimpleAggregateFunction(max, Float64),
    `min_sample_interval` SimpleAggregateFunction(min, Float64),
    `sum_sample_interval` SimpleAggregateFunction(sum, Float64),
    `num_sample_interval` SimpleAggregateFunction(sum, Int64),
    `squaresum_sample_interval` SimpleAggregateFunction(sum, Float64),
    `avg_speed` Float64,
    `max_speed` SimpleAggregateFunction(max, Float64),
    `min_speed` SimpleAggregateFunction(min, Float64),
    `sum_speed` SimpleAggregateFunction(sum, Float64),
    `num_speed` SimpleAggregateFunction(sum, Int64),
    `squaresum_speed` SimpleAggregateFunction(sum, Float64),
    `avg_speed_x` Float64,
    `max_speed_x` SimpleAggregateFunction(max, Float64),
    `min_speed_x` SimpleAggregateFunction(min, Float64),
    `sum_speed_x` SimpleAggregateFunction(sum, Float64),
    `num_speed_x` SimpleAggregateFunction(sum, Int64),
    `squaresum_speed_x` SimpleAggregateFunction(sum, Float64),
    `avg_speed_y` Float64,
    `max_speed_y` SimpleAggregateFunction(max, Float64),
    `min_speed_y` SimpleAggregateFunction(min, Float64),
    `sum_speed_y` SimpleAggregateFunction(sum, Float64),
    `num_speed_y` SimpleAggregateFunction(sum, Int64),
    `squaresum_speed_y` SimpleAggregateFunction(sum, Float64),
    `avg_speed_z` Float64,
    `max_speed_z` SimpleAggregateFunction(max, Float64),
    `min_speed_z` SimpleAggregateFunction(min, Float64),
    `sum_speed_z` SimpleAggregateFunction(sum, Float64),
    `num_speed_z` SimpleAggregateFunction(sum, Int64),
    `squaresum_speed_z` SimpleAggregateFunction(sum, Float64),
    `count` SimpleAggregateFunction(sum, Int64),
    `start_unix_time` SimpleAggregateFunction(min, Float64),
    `end_unix_time` SimpleAggregateFunction(max, Float64),
    `avg_acc` Float64,
    `max_acc` SimpleAggregateFunction(max, Float64),
    `min_acc` SimpleAggregateFunction(min, Float64),
    `sum_acc` SimpleAggregateFunction(sum, Float64),
    `num_acc` SimpleAggregateFunction(sum, Int64),
    `squaresum_acc` SimpleAggregateFunction(sum, Float64),
    `avg_acc_peek_to_peek` Float64,
    `max_acc_peek_to_peek` SimpleAggregateFunction(max, Float64),
    `min_acc_peek_to_peek` SimpleAggregateFunction(min, Float64),
    `sum_acc_peek_to_peek` SimpleAggregateFunction(sum, Float64),
    `num_acc_peek_to_peek` SimpleAggregateFunction(sum, Int64),
    `squaresum_acc_peek_to_peek` SimpleAggregateFunction(sum, Float64),
    `avg_acc_max_abs` Float64,
    `max_acc_max_abs` SimpleAggregateFunction(max, Float64),
    `min_acc_max_abs` SimpleAggregateFunction(min, Float64),
    `sum_acc_max_abs` SimpleAggregateFunction(sum, Float64),
    `num_acc_max_abs` SimpleAggregateFunction(sum, Int64),
    `squaresum_acc_max_abs` SimpleAggregateFunction(sum, Float64),
    `avg_freq` Float64,
    `max_freq` SimpleAggregateFunction(max, Float64),
    `min_freq` SimpleAggregateFunction(min, Float64),
    `sum_freq` SimpleAggregateFunction(sum, Float64),
    `num_freq` SimpleAggregateFunction(sum, Int64),
    `squaresum_freq` SimpleAggregateFunction(sum, Float64),
    `avg_acc_rms` Float64,
    `max_acc_rms` SimpleAggregateFunction(max, Float64),
    `min_acc_rms` SimpleAggregateFunction(min, Float64),
    `sum_acc_rms` SimpleAggregateFunction(sum, Float64),
    `num_acc_rms` SimpleAggregateFunction(sum, Int64),
    `squaresum_acc_rms` SimpleAggregateFunction(sum, Float64),
    `avg_acc_level` Float64,
    `max_acc_level` SimpleAggregateFunction(max, Float64),
    `min_acc_level` SimpleAggregateFunction(min, Float64),
    `sum_acc_level` SimpleAggregateFunction(sum, Float64),
    `num_acc_level` SimpleAggregateFunction(sum, Int64),
    `squaresum_acc_level` SimpleAggregateFunction(sum, Float64),
    `uuid` String,
    `debug_session_id` String,
    `manual_batch_id` String
)
ENGINE = ReplicatedAggregatingMergeTree('/clickhouse/{layer}-{shard}/tables/"tzgjq20211109".VibrationData_materialized_local', '{replica}')
PARTITION BY toYYYYMM(minute_unix_time)
ORDER BY (module_name, sensor_id, node_id, channel, minute_unix_time)
SETTINGS index_granularity = 8192

Query id: 90e221e6-6fce-4391-829d-d7651c6f1855

Ok.

0 rows in set. Elapsed: 0.100 sec. 

```





#### 2.7、数据比对

clickhouse03节点，查看数据量

![](https://iteshell.oss-cn-beijing.aliyuncs.com/bookshell/operator/image-20231224232741770.png)





clickhouse04节点，查看数据量

![image-20231224232827679](https://iteshell.oss-cn-beijing.aliyuncs.com/bookshell/operator/image-20231224232827679.png)



目前来看数据已经同步





查询哪些副本表处于readonly状态：(一般在zk中部分副本元数据丢失)

```shell
select table,zookeeper_path,replica_path from `system`.replicas where is_readonly
system restore replica dyhhgldq20231120.TempHumiContData_local   on cluster sb_2shards_2replicas  #这个会在所有节点执行，只有zk挂了，都丢数据了才能执行，此处用不到
```









### 3、同步情况



| 同步数据量 | 所用时间 | 同步方式 |
| :--------: | :------: | :------: |
|     6T     |  13-14H  |  复制表  |
|            |          |          |
|            |          |          |



数据同步时刻的监控图：



![image-20231225010159381](https://iteshell.oss-cn-beijing.aliyuncs.com/bookshell/operator/image-20231225010159381.png)







整体数据占用空间情况:

![](https://iteshell.oss-cn-beijing.aliyuncs.com/bookshell/operator/image-20231225005202562.png)







