"use strict";(self.webpackChunkbookshell=self.webpackChunkbookshell||[]).push([[2617],{3865:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>o,contentTitle:()=>r,default:()=>m,frontMatter:()=>l,metadata:()=>t,toc:()=>c});var a=s(4848),i=s(8453);const l={},r=void 0,t={id:"Prometheus/prometheus/\u544a\u8b66\u6307\u6807\u6c47\u603b",title:"\u544a\u8b66\u6307\u6807\u6c47\u603b",description:"kubernetes\u76f8\u5173",source:"@site/docs/Prometheus/prometheus/1-\u544a\u8b66\u6307\u6807\u6c47\u603b.md",sourceDirName:"Prometheus/prometheus",slug:"/Prometheus/prometheus/\u544a\u8b66\u6307\u6807\u6c47\u603b",permalink:"/docs/Prometheus/prometheus/\u544a\u8b66\u6307\u6807\u6c47\u603b",draft:!1,unlisted:!1,editUrl:"https://github.com/shouji1128955/bookshell/edit/main/docs/Prometheus/prometheus/1-\u544a\u8b66\u6307\u6807\u6c47\u603b.md",tags:[],version:"current",lastUpdatedBy:"zhanglaiqiang",lastUpdatedAt:1729363133e3,sidebarPosition:1,frontMatter:{},sidebar:"PrometheusServer",next:{title:"prometheus\u6307\u6807",permalink:"/docs/Prometheus/prometheus/prometheus\u6307\u6807"}},o={},c=[{value:"kubernetes\u76f8\u5173",id:"kubernetes\u76f8\u5173",level:2},{value:"pvc\u4f7f\u7528\u7387",id:"pvc\u4f7f\u7528\u7387",level:3},{value:"\u78c1\u76d8\u4f7f\u7528\u7387",id:"\u78c1\u76d8\u4f7f\u7528\u7387",level:3},{value:"\u4e3b\u673a\u548c\u786c\u4ef6\u76d1\u63a7",id:"\u4e3b\u673a\u548c\u786c\u4ef6\u76d1\u63a7",level:2},{value:"\u53ef\u7528\u5185\u5b58\u6307\u6807",id:"\u53ef\u7528\u5185\u5b58\u6307\u6807",level:3},{value:"\u5185\u5b58",id:"\u5185\u5b58",level:3},{value:"\u4e3b\u673a\u7f51\u7edc\u63a5\u53e3\u6d41\u5165\u6d41\u91cf\u5f02\u5e38",id:"\u4e3b\u673a\u7f51\u7edc\u63a5\u53e3\u6d41\u5165\u6d41\u91cf\u5f02\u5e38",level:3},{value:"\u4e3b\u673a\u7f51\u7edc\u63a5\u53e3\u6d41\u51fa\u6d41\u91cf\u5f02\u5e38",id:"\u4e3b\u673a\u7f51\u7edc\u63a5\u53e3\u6d41\u51fa\u6d41\u91cf\u5f02\u5e38",level:3},{value:"\u4e3b\u673a\u7f51\u7edc\u63a5\u6536\u9519\u8bef",id:"\u4e3b\u673a\u7f51\u7edc\u63a5\u6536\u9519\u8bef",level:3},{value:"\u4e3b\u673a\u7f51\u7edc\u4f20\u8f93\u9519\u8bef",id:"\u4e3b\u673a\u7f51\u7edc\u4f20\u8f93\u9519\u8bef",level:3},{value:"\u4e3b\u673a\u78c1\u76d8\u8bfb\u901f\u7387",id:"\u4e3b\u673a\u78c1\u76d8\u8bfb\u901f\u7387",level:3},{value:"\u4e3b\u673a\u78c1\u76d8\u5199\u901f\u7387",id:"\u4e3b\u673a\u78c1\u76d8\u5199\u901f\u7387",level:3},{value:"\u4e3b\u673a\u78c1\u76d8\u5269\u4f59\u7a7a\u95f4",id:"\u4e3b\u673a\u78c1\u76d8\u5269\u4f59\u7a7a\u95f4",level:3},{value:"\u6839\u636e\u78c1\u76d8\u76ee\u524d\u7684\u589e\u957f\u901f\u5ea6\uff0c\u5728\u51e0\u4e2a\u5c0f\u65f6\u5185\u662f\u5426\u4f1a\u5199\u6ee1",id:"\u6839\u636e\u78c1\u76d8\u76ee\u524d\u7684\u589e\u957f\u901f\u5ea6\u5728\u51e0\u4e2a\u5c0f\u65f6\u5185\u662f\u5426\u4f1a\u5199\u6ee1",level:3},{value:"\u4e3b\u673a\u4e2dinode \u6587\u4ef6\u53e5\u67c4\u62a5\u8b66",id:"\u4e3b\u673a\u4e2dinode-\u6587\u4ef6\u53e5\u67c4\u62a5\u8b66",level:3},{value:"\u78c1\u76d8\u8bfb\u5ef6\u8fdf",id:"\u78c1\u76d8\u8bfb\u5ef6\u8fdf",level:3},{value:"\u78c1\u76d8\u5199\u5165\u5ef6\u8fdf\u5927",id:"\u78c1\u76d8\u5199\u5165\u5ef6\u8fdf\u5927",level:3},{value:"\u4e3b\u673a cpu \u8d1f\u8f7d\u9ad8",id:"\u4e3b\u673a-cpu-\u8d1f\u8f7d\u9ad8",level:3},{value:"\u4e3b\u673a\u4e0a\u4e0b\u6587\u5207\u6362",id:"\u4e3b\u673a\u4e0a\u4e0b\u6587\u5207\u6362",level:3},{value:"\u4e3b\u673a swap \u5206\u533a\u4f7f\u7528",id:"\u4e3b\u673a-swap-\u5206\u533a\u4f7f\u7528",level:3},{value:"\u4e3b\u673a systemctl \u7ba1\u7406\u7684\u670d\u52a1 down \u4e86",id:"\u4e3b\u673a-systemctl-\u7ba1\u7406\u7684\u670d\u52a1-down-\u4e86",level:3},{value:"\u4e3b\u673a\u7269\u7406\u5143\u8bbe\u5907(\u6709\u7684\u865a\u62df\u673a\u53ef\u80fd\u6ca1\u6709\u6b64\u6307\u6807)",id:"\u4e3b\u673a\u7269\u7406\u5143\u8bbe\u5907\u6709\u7684\u865a\u62df\u673a\u53ef\u80fd\u6ca1\u6709\u6b64\u6307\u6807",level:3},{value:"\u4e3b\u673a\u8282\u70b9\u8d85\u6e29\u62a5\u8b66(\u6709\u7684\u865a\u62df\u673a\u53ef\u80fd\u6ca1\u6709\u6b64\u6307\u6807)",id:"\u4e3b\u673a\u8282\u70b9\u8d85\u6e29\u62a5\u8b66\u6709\u7684\u865a\u62df\u673a\u53ef\u80fd\u6ca1\u6709\u6b64\u6307\u6807",level:3},{value:"\u4e3b\u673aRAID \u5361\u9635\u5217\u5931\u6548(\u865a\u62df\u673a\u53ef\u80fd\u6ca1\u6709\u6b64\u6307\u6807)",id:"\u4e3b\u673araid-\u5361\u9635\u5217\u5931\u6548\u865a\u62df\u673a\u53ef\u80fd\u6ca1\u6709\u6b64\u6307\u6807",level:3},{value:"\u4e3b\u673aRAID\u78c1\u76d8\u6545\u969c(\u865a\u62df\u673a\u53ef\u80fd\u6ca1\u6709\u6b64\u6307\u6807)",id:"\u4e3b\u673araid\u78c1\u76d8\u6545\u969c\u865a\u62df\u673a\u53ef\u80fd\u6ca1\u6709\u6b64\u6307\u6807",level:3},{value:"\u4e3b\u673a\u5185\u6838\u7248\u672c\u504f\u5dee",id:"\u4e3b\u673a\u5185\u6838\u7248\u672c\u504f\u5dee",level:3},{value:"\u68c0\u6d4b\u4e3b\u673a OOM \u6740\u8fdb\u7a0b",id:"\u68c0\u6d4b\u4e3b\u673a-oom-\u6740\u8fdb\u7a0b",level:3},{value:"\u68c0\u6d4b\u5230\u4e3b\u673aEDAC\u53ef\u7ea0\u6b63\u7684\u9519\u8bef",id:"\u68c0\u6d4b\u5230\u4e3b\u673aedac\u53ef\u7ea0\u6b63\u7684\u9519\u8bef",level:3},{value:"\u68c0\u6d4b\u5230\u4e3b\u673aEDAC\u4e0d\u6b63\u786e\u7684\u9519\u8bef",id:"\u68c0\u6d4b\u5230\u4e3b\u673aedac\u4e0d\u6b63\u786e\u7684\u9519\u8bef",level:3},{value:"Docker \u5bb9\u5668",id:"docker-\u5bb9\u5668",level:2},{value:"\u4e00\u4e2a\u5bb9\u5668\u6d88\u5931",id:"\u4e00\u4e2a\u5bb9\u5668\u6d88\u5931",level:3},{value:"\u5bb9\u5668 cpu \u7684\u4f7f\u7528\u91cf",id:"\u5bb9\u5668-cpu-\u7684\u4f7f\u7528\u91cf",level:3},{value:"\u5bb9\u5668\u5185\u5b58\u7684\u4f7f\u7528\u91cf",id:"\u5bb9\u5668\u5185\u5b58\u7684\u4f7f\u7528\u91cf",level:3},{value:"\u5bb9\u5668\u78c1\u76d8\u7684\u4f7f\u7528\u91cf",id:"\u5bb9\u5668\u78c1\u76d8\u7684\u4f7f\u7528\u91cf",level:3},{value:"Redis \u76f8\u5173\u62a5\u8b66\u4fe1\u606f",id:"redis-\u76f8\u5173\u62a5\u8b66\u4fe1\u606f",level:2},{value:"redis down",id:"redis-down",level:3},{value:"redis \u7f3a\u5c11\u4e3b\u8282\u70b9(\u96c6\u7fa4\uff0c\u6216\u8005sentinel \u6a21\u5f0f\u624d\u6709)",id:"redis-\u7f3a\u5c11\u4e3b\u8282\u70b9\u96c6\u7fa4\u6216\u8005sentinel-\u6a21\u5f0f\u624d\u6709",level:3},{value:"Redis \u4e3b\u8282\u70b9\u8fc7\u591a",id:"redis-\u4e3b\u8282\u70b9\u8fc7\u591a",level:3},{value:"Redis \u590d\u5236\u4e2d\u65ad",id:"redis-\u590d\u5236\u4e2d\u65ad",level:3},{value:"Redis \u96c6\u7fa4 flapping",id:"redis-\u96c6\u7fa4-flapping",level:3},{value:"Redis\u7f3a\u5c11\u5907\u4efd",id:"redis\u7f3a\u5c11\u5907\u4efd",level:3},{value:"Redis\u5185\u5b58\u4e0d\u8db3",id:"redis\u5185\u5b58\u4e0d\u8db3",level:3},{value:"Redis\u8fde\u63a5\u6570\u8fc7\u591a",id:"redis\u8fde\u63a5\u6570\u8fc7\u591a",level:3},{value:"Redis\u8fde\u63a5\u6570\u4e0d\u8db3",id:"redis\u8fde\u63a5\u6570\u4e0d\u8db3",level:3},{value:"Redis\u62d2\u7edd\u8fde\u63a5",id:"redis\u62d2\u7edd\u8fde\u63a5",level:3},{value:"rabbitmq \u76d1\u63a7 : [rabbitmq/rabbitmq-prometheus ]",id:"rabbitmq-\u76d1\u63a7--rabbitmqrabbitmq-prometheus-",level:2},{value:"rabbitmq \u8282\u70b9 down",id:"rabbitmq-\u8282\u70b9-down",level:3},{value:"Rabbitmq\u5b9e\u4f8b\u7684\u4e0d\u540c\u7248\u672c",id:"rabbitmq\u5b9e\u4f8b\u7684\u4e0d\u540c\u7248\u672c",level:3},{value:"Rabbitmq\u5185\u5b58\u9ad8",id:"rabbitmq\u5185\u5b58\u9ad8",level:3},{value:"Rabbitmq\u6587\u4ef6\u63cf\u8ff0\u7b26\u7684\u7528\u6cd5",id:"rabbitmq\u6587\u4ef6\u63cf\u8ff0\u7b26\u7684\u7528\u6cd5",level:3},{value:"Rabbitmq\u8fde\u63a5\u6570\u592a\u591a",id:"rabbitmq\u8fde\u63a5\u6570\u592a\u591a",level:3},{value:"Rabbitmq\u65e0\u961f\u5217\u6d88\u8d39",id:"rabbitmq\u65e0\u961f\u5217\u6d88\u8d39",level:3},{value:"Rabbitmq\u4e0d\u53ef\u8def\u7531\u7684\u6d88\u606f",id:"rabbitmq\u4e0d\u53ef\u8def\u7531\u7684\u6d88\u606f",level:3}];function d(e){const n={a:"a",code:"code",h2:"h2",h3:"h3",p:"p",pre:"pre",...(0,i.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.h2,{id:"kubernetes\u76f8\u5173",children:"kubernetes\u76f8\u5173"}),"\n",(0,a.jsx)(n.h3,{id:"pvc\u4f7f\u7528\u7387",children:"pvc\u4f7f\u7528\u7387"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"100 - (kubelet_volume_stats_available_bytes / kubelet_volume_stats_capacity_bytes) * 100\n"})}),"\n",(0,a.jsx)(n.h3,{id:"\u78c1\u76d8\u4f7f\u7528\u7387",children:"\u78c1\u76d8\u4f7f\u7528\u7387"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-shell",children:"100 - (node_filesystem_avail_bytes / node_filesystem_size_bytes * 100)\n"})}),"\n",(0,a.jsx)(n.h2,{id:"\u4e3b\u673a\u548c\u786c\u4ef6\u76d1\u63a7",children:"\u4e3b\u673a\u548c\u786c\u4ef6\u76d1\u63a7"}),"\n",(0,a.jsx)(n.h3,{id:"\u53ef\u7528\u5185\u5b58\u6307\u6807",children:"\u53ef\u7528\u5185\u5b58\u6307\u6807"}),"\n",(0,a.jsx)(n.p,{children:"\u4e3b\u673a\u4e2d\u53ef\u7528\u5185\u5b58\u5bb9\u91cf\u4e0d\u8db3 10%"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-plain",children:"- alert: HostOutOfMemory\n    expr: node_memory_MemAvailable_bytes / node_memory_MemTotal_bytes * 100 < 10\n    for: 5m\n    labels:\n      severity: warning\n    annotations:\n      summary: Host out of memory (instance {{ $labels.instance }})\n      description: Node memory is filling up (< 10% left)\\n  VALUE = {{ $value }}\\n  LABELS: {{ $labels }}\n"})}),"\n",(0,a.jsx)(n.h3,{id:"\u5185\u5b58",children:"\u5185\u5b58"}),"\n",(0,a.jsx)(n.p,{children:"\u8282\u70b9\u5185\u5b58\u538b\u529b\u5927\u3002\u4e3b\u8981\u9875\u9762\u6545\u969c\u7387\u9ad8"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-plain",children:"- alert: HostMemoryUnderMemoryPressure\n    expr: rate(node_vmstat_pgmajfault[1m]) > 1000\n    for: 5m\n    labels:\n      severity: warning\n    annotations:\n      summary: Host memory under memory pressure (instance {{ $labels.instance }})\n      description: The node is under heavy memory pressure. High rate of major page faults\\n  VALUE = {{ $value }}\\n  LABELS: {{ $labels }}\n"})}),"\n",(0,a.jsx)(n.h3,{id:"\u4e3b\u673a\u7f51\u7edc\u63a5\u53e3\u6d41\u5165\u6d41\u91cf\u5f02\u5e38",children:"\u4e3b\u673a\u7f51\u7edc\u63a5\u53e3\u6d41\u5165\u6d41\u91cf\u5f02\u5e38"}),"\n",(0,a.jsx)(n.p,{children:"\u4e3b\u673a\u7f51\u7edc\u63a5\u53e3\u53ef\u80fd\u63a5\u6536\u4e86\u592a\u591a\u7684\u6570\u636e\uff08> 100 MB/s\uff09\u3002\u9600\u503c\u6839\u636e\u81ea\u5df1\u673a\u5668\u80cc\u677f\u7f51\u5361\u51b3\u5b9a"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-plain",children:"- alert: HostUnusualNetworkThroughputIn\n    expr: sum by (instance) (rate(node_network_receive_bytes_total[2m])) / 1024 / 1024 > 100\n    for: 5m\n    labels:\n      severity: warning\n    annotations:\n      summary: Host unusual network throughput in (instance {{ $labels.instance }})\n      description: Host network interfaces are probably receiving too much data (> 100 MB/s)\\n  VALUE = {{ $value }}\\n  LABELS: {{ $labels }}\n"})}),"\n",(0,a.jsx)(n.h3,{id:"\u4e3b\u673a\u7f51\u7edc\u63a5\u53e3\u6d41\u51fa\u6d41\u91cf\u5f02\u5e38",children:"\u4e3b\u673a\u7f51\u7edc\u63a5\u53e3\u6d41\u51fa\u6d41\u91cf\u5f02\u5e38"}),"\n",(0,a.jsx)(n.p,{children:"\u4e3b\u673a\u7f51\u7edc\u63a5\u53e3\u53ef\u80fd\u53d1\u9001\u4e86\u592a\u591a\u7684\u6570\u636e\uff08> 100 MB/s\uff09\u3002"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-plain",children:"- alert: HostUnusualNetworkThroughputOut\n    expr: sum by (instance) (rate(node_network_transmit_bytes_total[2m])) / 1024 / 1024 > 100\n    for: 5m\n    labels:\n      severity: warning\n    annotations:\n      summary: Host unusual network throughput out (instance {{ $labels.instance }})\n      description: Host network interfaces are probably sending too much data (> 100 MB/s)\\n  VALUE = {{ $value }}\\n  LABELS: {{ $labels }}\n"})}),"\n",(0,a.jsx)(n.h3,{id:"\u4e3b\u673a\u7f51\u7edc\u63a5\u6536\u9519\u8bef",children:"\u4e3b\u673a\u7f51\u7edc\u63a5\u6536\u9519\u8bef"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-plain",children:'{{ $labels.instance }}\u63a5\u53e3{{ $labels.device }}\u5728\u8fc7\u53bb5\u5206\u949f\u5185\u9047\u5230{{ printf "%.0f" $value }}\u63a5\u6536\u9519\u8bef\u3002\n\n- alert: HostNetworkReceiveErrors\n    expr: increase(node_network_receive_errs_total[5m]) > 0\n    for: 5m\n    labels:\n      severity: warning\n    annotations:\n      summary: Host Network Receive Errors (instance {{ $labels.instance }})\n      description: {{ $labels.instance }} interface {{ $labels.device }} has encountered {{ printf "%.0f" $value }} receive errors in the last five minutes.\\n  VALUE = {{ $value }}\\n  LABELS: {{ $labels }}\n'})}),"\n",(0,a.jsx)(n.h3,{id:"\u4e3b\u673a\u7f51\u7edc\u4f20\u8f93\u9519\u8bef",children:"\u4e3b\u673a\u7f51\u7edc\u4f20\u8f93\u9519\u8bef"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-plain",children:'\n{{ $labels.instance }} \u63a5\u53e3 {{ $labels.device }} \u5728\u8fc7\u53bb\u4e94\u5206\u949f\u5185\u9047\u5230 {{ printf "%.0f" $value }} \u53d1\u9001\u9519\u8bef\u3002\n\n- alert: HostNetworkTransmitErrors\n    expr: increase(node_network_transmit_errs_total[5m]) > 0\n    for: 5m\n    labels:\n      severity: warning\n    annotations:\n      summary: Host Network Transmit Errors (instance {{ $labels.instance }})\n      description: {{ $labels.instance }} interface {{ $labels.device }} has encountered {{ printf "%.0f" $value }} transmit errors in the last five minutes.\\n  VALUE = {{ $value }}\\n  LABELS: {{ $labels }}\n'})}),"\n",(0,a.jsx)(n.h3,{id:"\u4e3b\u673a\u78c1\u76d8\u8bfb\u901f\u7387",children:"\u4e3b\u673a\u78c1\u76d8\u8bfb\u901f\u7387"}),"\n",(0,a.jsx)(n.p,{children:"\u78c1\u76d8\u6bcf\u79d2\u8bfb\u6570\u636e\uff08> 50 MB/s\uff09\u3002"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-plain",children:"- alert: HostUnusualDiskReadRate\n    expr: sum by (instance) (rate(node_disk_read_bytes_total[2m])) / 1024 / 1024 > 50\n    for: 5m\n    labels:\n      severity: warning\n    annotations:\n      summary: Host unusual disk read rate (instance {{ $labels.instance }})\n      description: Disk is probably reading too much data (> 50 MB/s)\\n  VALUE = {{ $value }}\\n  LABELS: {{ $labels }}\n"})}),"\n",(0,a.jsx)(n.h3,{id:"\u4e3b\u673a\u78c1\u76d8\u5199\u901f\u7387",children:"\u4e3b\u673a\u78c1\u76d8\u5199\u901f\u7387"}),"\n",(0,a.jsx)(n.p,{children:"\u78c1\u76d8\u6bcf\u79d2\u5199\u6570\u636e"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-plain",children:"- alert: HostUnusualDiskWriteRate\n    expr: sum by (instance) (rate(node_disk_written_bytes_total[2m])) / 1024 / 1024 > 50\n    for: 5m\n    labels:\n      severity: warning\n    annotations:\n      summary: Host unusual disk write rate (instance {{ $labels.instance }})\n      description: Disk is probably writing too much data (> 50 MB/s)\\n  VALUE = {{ $value }}\\n  LABELS: {{ $labels }}\n"})}),"\n",(0,a.jsx)(n.h3,{id:"\u4e3b\u673a\u78c1\u76d8\u5269\u4f59\u7a7a\u95f4",children:"\u4e3b\u673a\u78c1\u76d8\u5269\u4f59\u7a7a\u95f4"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-plain",children:'\n\u78c1\u76d8\u53ef\u7528\u7a7a\u95f4\uff08<10% left\uff09\n\n# please add ignored mountpoints in node_exporter parameters like\n  # "--collector.filesystem.ignored-mount-points=^/(sys|proc|dev|run)($|/)"\n  - alert: HostOutOfDiskSpace\n    expr: (node_filesystem_avail_bytes * 100) / node_filesystem_size_bytes < 10\n    for: 5m\n    labels:\n      severity: warning\n    annotations:\n      summary: Host out of disk space (instance {{ $labels.instance }})\n      description: Disk is almost full (< 10% left)\\n  VALUE = {{ $value }}\\n  LABELS: {{ $labels }}9.10.\n'})}),"\n",(0,a.jsx)(n.h3,{id:"\u6839\u636e\u78c1\u76d8\u76ee\u524d\u7684\u589e\u957f\u901f\u5ea6\u5728\u51e0\u4e2a\u5c0f\u65f6\u5185\u662f\u5426\u4f1a\u5199\u6ee1",children:"\u6839\u636e\u78c1\u76d8\u76ee\u524d\u7684\u589e\u957f\u901f\u5ea6\uff0c\u5728\u51e0\u4e2a\u5c0f\u65f6\u5185\u662f\u5426\u4f1a\u5199\u6ee1"}),"\n",(0,a.jsx)(n.p,{children:"\u6839\u636e\u5f53\u524d\u4e00\u5c0f\u65f6\u5185\u78c1\u76d8\u589e\u957f\u91cf\uff0c\u5224\u65ad\u78c1\u76d8\u5728 4 \u4e2a\u5c0f\u65f6\u5185\u4f1a\u4e0d\u4f1a\u88ab\u5199\u6ee1"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-plain",children:'- alert: HostDiskWillFillIn4Hours\n    expr: predict_linear(node_filesystem_free_bytes{fstype!~"tmpfs"}[1h], 4 * 3600) < 0\n    for: 5m\n    labels:\n      severity: warning\n    annotations:\n      summary: Host disk will fill in 4 hours (instance {{ $labels.instance }})\n      description: Disk will fill in 4 hours at current write rate\\n  VALUE = {{ $value }}\\n  LABELS: {{ $labels }}\n'})}),"\n",(0,a.jsx)(n.h3,{id:"\u4e3b\u673a\u4e2dinode-\u6587\u4ef6\u53e5\u67c4\u62a5\u8b66",children:"\u4e3b\u673a\u4e2dinode \u6587\u4ef6\u53e5\u67c4\u62a5\u8b66"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-plain",children:'\u78c1\u76d8\u53ef\u7528\u7684inode\u5feb\u7528\u5b8c\u4e86<10%\n\n- alert: HostOutOfInodes\n    expr: node_filesystem_files_free{mountpoint ="/rootfs"} / node_filesystem_files{mountpoint ="/rootfs"} * 100 < 10\n    for: 5m\n    labels:\n      severity: warning\n    annotations:\n      summary: Host out of inodes (instance {{ $labels.instance }})\n      description: Disk is almost running out of available inodes (< 10% left)\\n  VALUE = {{ $value }}\\n  LABELS: {{ $labels }}\n'})}),"\n",(0,a.jsx)(n.h3,{id:"\u78c1\u76d8\u8bfb\u5ef6\u8fdf",children:"\u78c1\u76d8\u8bfb\u5ef6\u8fdf"}),"\n",(0,a.jsx)(n.p,{children:"\u78c1\u76d8\u8bfb\u53d6\u5ef6\u8fdf\u5927\uff08\u8bfb\u53d6\u64cd\u4f5c>100ms\uff09"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-plain",children:"- alert: HostUnusualDiskReadLatency\n    expr: rate(node_disk_read_time_seconds_total[1m]) / rate(node_disk_reads_completed_total[1m]) > 0.1 and rate(node_disk_reads_completed_total[1m]) > 0\n    for: 5m\n    labels:\n      severity: warning\n    annotations:\n      summary: Host unusual disk read latency (instance {{ $labels.instance }})\n      description: Disk latency is growing (read operations > 100ms)\\n  VALUE = {{ $value }}\\n  LABELS: {{ $labels }}\n"})}),"\n",(0,a.jsx)(n.h3,{id:"\u78c1\u76d8\u5199\u5165\u5ef6\u8fdf\u5927",children:"\u78c1\u76d8\u5199\u5165\u5ef6\u8fdf\u5927"}),"\n",(0,a.jsx)(n.p,{children:"\u78c1\u76d8\u5199\u5165\u5ef6\u8fdf\u5927\uff08\u5199\u64cd\u4f5c>100ms\uff09"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-plain",children:"- alert: HostUnusualDiskWriteLatency\n    expr: rate(node_disk_write_time_seconds_total[1m]) / rate(node_disk_writes_completed_total[1m]) > 0.1 and rate(node_disk_writes_completed_total[1m]) > 0\n    for: 5m\n    labels:\n      severity: warning\n    annotations:\n      summary: Host unusual disk write latency (instance {{ $labels.instance }})\n      description: Disk latency is growing (write operations > 100ms)\\n  VALUE = {{ $value }}\\n  LABELS: {{ $labels }}\n"})}),"\n",(0,a.jsx)(n.h3,{id:"\u4e3b\u673a-cpu-\u8d1f\u8f7d\u9ad8",children:"\u4e3b\u673a cpu \u8d1f\u8f7d\u9ad8"}),"\n",(0,a.jsx)(n.p,{children:"cpu \u8d1f\u8f7d\u5927\u4e8e > 80%"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-plain",children:'- alert: HostHighCpuLoad\n    expr: 100 - (avg by(instance) (rate(node_cpu_seconds_total{mode="idle"}[5m])) * 100) > 80\n    for: 5m\n    labels:\n      severity: warning\n    annotations:\n      summary: Host high CPU load (instance {{ $labels.instance }})\n      description: CPU load is > 80%\\n  VALUE = {{ $value }}\\n  LABELS: {{ $labels }}\n'})}),"\n",(0,a.jsx)(n.h3,{id:"\u4e3b\u673a\u4e0a\u4e0b\u6587\u5207\u6362",children:"\u4e3b\u673a\u4e0a\u4e0b\u6587\u5207\u6362"}),"\n",(0,a.jsx)(n.p,{children:"\u4e0a\u4e0b\u6587\u5207\u6362\u7684\u8282\u70b9\u8d8a\u6765\u8d8a\u591a(>1000/s)"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-plain",children:'# 1000 context switches is an arbitrary number.\n  # Alert threshold depends on nature of application.\n  # Please read: https://github.com/samber/awesome-prometheus-alerts/issues/58\n  - alert: HostContextSwitching\n    expr: (rate(node_context_switches_total[5m])) / (count without(cpu, mode) (node_cpu_seconds_total{mode="idle"})) > 1000\n    for: 5m\n    labels:\n      severity: warning\n    annotations:\n      summary: Host context switching (instance {{ $labels.instance }})\n      description: Context switching is growing on node (> 1000 / s)\\n  VALUE = {{ $value }}\\n  LABELS: {{ $labels }}9.10.11.\n'})}),"\n",(0,a.jsx)(n.h3,{id:"\u4e3b\u673a-swap-\u5206\u533a\u4f7f\u7528",children:"\u4e3b\u673a swap \u5206\u533a\u4f7f\u7528"}),"\n",(0,a.jsx)(n.p,{children:"\u4e3b\u673a swap \u4ea4\u6362\u5206\u533a\u4f7f\u7528\u60c5\u51b5 (> 80%)"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-plain",children:"- alert: HostSwapIsFillingUp\n    expr: (1 - (node_memory_SwapFree_bytes / node_memory_SwapTotal_bytes)) * 100 > 80\n    for: 5m\n    labels:\n      severity: warning\n    annotations:\n      summary: Host swap is filling up (instance {{ $labels.instance }})\n      description: Swap is filling up (>80%)\\n  VALUE = {{ $value }}\\n  LABELS: {{ $labels }}\n"})}),"\n",(0,a.jsx)(n.h3,{id:"\u4e3b\u673a-systemctl-\u7ba1\u7406\u7684\u670d\u52a1-down-\u4e86",children:"\u4e3b\u673a systemctl \u7ba1\u7406\u7684\u670d\u52a1 down \u4e86"}),"\n",(0,a.jsx)(n.p,{children:"\u4e3b\u673a\u4e0asystemctl \u7ba1\u7406\u7684\u670d\u52a1\u4e0d\u6b63\u5e38\uff0cfailed\u4e86\uff0c\u6839\u636e\u81ea\u5df1\u7684\u5b9e\u9645\u60c5\u51b5\u6765\u5224\u65ad\u54ea\u4e9b\u670d\u52a1"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-plain",children:'- alert: HostSystemdServiceCrashed\n    expr: node_systemd_unit_state{state="failed"} == 1\n    for: 5m\n    labels:\n      severity: warning\n    annotations:\n      summary: Host SystemD service crashed (instance {{ $labels.instance }})\n      description: SystemD service crashed\\n  VALUE = {{ $value }}\\n  LABELS: {{ $labels }}\n'})}),"\n",(0,a.jsx)(n.h3,{id:"\u4e3b\u673a\u7269\u7406\u5143\u8bbe\u5907\u6709\u7684\u865a\u62df\u673a\u53ef\u80fd\u6ca1\u6709\u6b64\u6307\u6807",children:"\u4e3b\u673a\u7269\u7406\u5143\u8bbe\u5907(\u6709\u7684\u865a\u62df\u673a\u53ef\u80fd\u6ca1\u6709\u6b64\u6307\u6807)"}),"\n",(0,a.jsx)(n.p,{children:"\u7269\u7406\u673a\u6e29\u5ea6\u8fc7\u9ad8"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-plain",children:"- alert: HostPhysicalComponentTooHot\n    expr: node_hwmon_temp_celsius > 75\n    for: 5m\n    labels:\n      severity: warning\n    annotations:\n      summary: Host physical component too hot (instance {{ $labels.instance }})\n      description: Physical hardware component too hot\\n  VALUE = {{ $value }}\\n  LABELS: {{ $labels }}\n"})}),"\n",(0,a.jsx)(n.h3,{id:"\u4e3b\u673a\u8282\u70b9\u8d85\u6e29\u62a5\u8b66\u6709\u7684\u865a\u62df\u673a\u53ef\u80fd\u6ca1\u6709\u6b64\u6307\u6807",children:"\u4e3b\u673a\u8282\u70b9\u8d85\u6e29\u62a5\u8b66(\u6709\u7684\u865a\u62df\u673a\u53ef\u80fd\u6ca1\u6709\u6b64\u6307\u6807)"}),"\n",(0,a.jsx)(n.p,{children:"\u89e6\u53d1\u7269\u7406\u8282\u70b9\u6e29\u5ea6\u62a5\u8b66"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-plain",children:"- alert: HostNodeOvertemperatureAlarm\n    expr: node_hwmon_temp_alarm == 1\n    for: 5m\n    labels:\n      severity: critical\n    annotations:\n      summary: Host node overtemperature alarm (instance {{ $labels.instance }})\n      description: Physical node temperature alarm triggered\\n  VALUE = {{ $value }}\\n  LABELS: {{ $labels }}\n"})}),"\n",(0,a.jsx)(n.h3,{id:"\u4e3b\u673araid-\u5361\u9635\u5217\u5931\u6548\u865a\u62df\u673a\u53ef\u80fd\u6ca1\u6709\u6b64\u6307\u6807",children:"\u4e3b\u673aRAID \u5361\u9635\u5217\u5931\u6548(\u865a\u62df\u673a\u53ef\u80fd\u6ca1\u6709\u6b64\u6307\u6807)"}),"\n",(0,a.jsxs)(n.p,{children:["RAID\u9635\u5217",(0,a.jsx)(n.code,{children:"{{$labels.device }}"}),"\u7531\u4e8e\u4e00\u4e2a\u6216\u591a\u4e2a\u78c1\u76d8\u6545\u969c\u800c\u5904\u4e8e\u9000\u5316\u72b6\u6001\u3002\u5907\u7528\u786c\u76d8\u7684\u6570\u91cf\u4e0d\u8db3\u4ee5\u81ea\u52a8\u4fee\u590d\u95ee\u9898\u3002"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-plain",children:'- alert: HostRaidArrayGotInactive\n    expr: node_md_state{state="inactive"} > 0\n    for: 5m\n    labels:\n      severity: critical\n    annotations:\n      summary: Host RAID array got inactive (instance {{ $labels.instance }})\n      description: RAID array {{ $labels.device }} is in degraded state due to one or more disks failures. Number of spare drives is insufficient to fix issue automatically.\\n  VALUE = {{ $value }}\\n  LABELS: {{ $labels }}\n'})}),"\n",(0,a.jsx)(n.h3,{id:"\u4e3b\u673araid\u78c1\u76d8\u6545\u969c\u865a\u62df\u673a\u53ef\u80fd\u6ca1\u6709\u6b64\u6307\u6807",children:"\u4e3b\u673aRAID\u78c1\u76d8\u6545\u969c(\u865a\u62df\u673a\u53ef\u80fd\u6ca1\u6709\u6b64\u6307\u6807)"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-plain",children:'\n\u5728{{ $labels.instance }} \u7684RAID\u9635\u5217\u4e2d\u81f3\u5c11\u6709\u4e00\u4e2a\u8bbe\u5907\u5931\u8d25\u3002\u9635\u5217{{ $labels.md_device }}\u9700\u8981\u6ce8\u610f\uff0c\u53ef\u80fd\u9700\u8981\u8fdb\u884c\u78c1\u76d8\u66f4\u6362\n\n- alert: HostRaidDiskFailure\n    expr: node_md_disks{state="failed"} > 0\n    for: 5m\n    labels:\n      severity: warning\n    annotations:\n      summary: Host RAID disk failure (instance {{ $labels.instance }})\n      description: At least one device in RAID array on {{ $labels.instance }} failed. Array {{ $labels.md_device }} needs attention and possibly a disk swap\\n  VALUE = {{ $value }}\\n  LABELS: {{ $labels }}\n'})}),"\n",(0,a.jsx)(n.h3,{id:"\u4e3b\u673a\u5185\u6838\u7248\u672c\u504f\u5dee",children:"\u4e3b\u673a\u5185\u6838\u7248\u672c\u504f\u5dee"}),"\n",(0,a.jsx)(n.p,{children:"\u4e0d\u540c\u7684\u5185\u6838\u7248\u672c\u6b63\u5728\u8fd0\u884c"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-plain",children:'- alert: HostKernelVersionDeviations\n    expr: count(sum(label_replace(node_uname_info, "kernel", "$1", "release", "([0-9]+.[0-9]+.[0-9]+).*")) by (kernel)) > 1\n    for: 5m\n    labels:\n      severity: warning\n    annotations:\n      summary: Host kernel version deviations (instance {{ $labels.instance }})\n      description: Different kernel versions are running\\n  VALUE = {{ $value }}\\n  LABELS: {{ $labels }}\n'})}),"\n",(0,a.jsx)(n.h3,{id:"\u68c0\u6d4b\u4e3b\u673a-oom-\u6740\u8fdb\u7a0b",children:"\u68c0\u6d4b\u4e3b\u673a OOM \u6740\u8fdb\u7a0b"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-plain",children:"- alert: HostOomKillDetected\n    expr: increase(node_vmstat_oom_kill[5m]) > 0\n    for: 5m\n    labels:\n      severity: warning\n    annotations:\n      summary: Host OOM kill detected (instance {{ $labels.instance }})\n      description: OOM kill detected\\n  VALUE = {{ $value }}\\n  LABELS: {{ $labels }}\n"})}),"\n",(0,a.jsx)(n.h3,{id:"\u68c0\u6d4b\u5230\u4e3b\u673aedac\u53ef\u7ea0\u6b63\u7684\u9519\u8bef",children:"\u68c0\u6d4b\u5230\u4e3b\u673aEDAC\u53ef\u7ea0\u6b63\u7684\u9519\u8bef"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-plain",children:'{{ $labels.instance }}\u5728\u8fc7\u53bb5\u5206\u949f\u5185\uff0cEDAC\u62a5\u544a\u4e86{{ printf "%.0f" $value }}\u53ef\u7ea0\u6b63\u7684\u5185\u5b58\u9519\u8bef\u3002\n\n- alert: HostEdacCorrectableErrorsDetected\n    expr: increase(node_edac_correctable_errors_total[5m]) > 0\n    for: 5m\n    labels:\n      severity: info\n    annotations:\n      summary: Host EDAC Correctable Errors detected (instance {{ $labels.instance }})\n      description: {{ $labels.instance }} has had {{ printf "%.0f" $value }} correctable memory errors reported by EDAC in the last 5 minutes.\\n  VALUE = {{ $value }}\\n  LABELS: {{ $labels }}\n'})}),"\n",(0,a.jsx)(n.h3,{id:"\u68c0\u6d4b\u5230\u4e3b\u673aedac\u4e0d\u6b63\u786e\u7684\u9519\u8bef",children:"\u68c0\u6d4b\u5230\u4e3b\u673aEDAC\u4e0d\u6b63\u786e\u7684\u9519\u8bef"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-plain",children:'{{ $labels.instance }}\u5728\u8fc7\u53bb5\u5206\u949f\u5185\uff0cEDAC\u62a5\u544a\u4e86{{ printf "%.0f" $value }}\u4e0d\u53ef\u7ea0\u6b63\u7684\u5185\u5b58\u9519\u8bef\u3002\n\n- alert: HostEdacUncorrectableErrorsDetected\n    expr: node_edac_uncorrectable_errors_total > 0\n    for: 5m\n    labels:\n      severity: warning\n    annotations:\n      summary: Host EDAC Uncorrectable Errors detected (instance {{ $labels.instance }})\n      description: {{ $labels.instance }} has had {{ printf "%.0f" $value }} uncorrectable memory errors reported by EDAC in the last 5 minutes.\\n  VALUE = {{ $value }}\\n  LABELS: {{ $labels }}\n'})}),"\n",(0,a.jsx)(n.h2,{id:"docker-\u5bb9\u5668",children:"Docker \u5bb9\u5668"}),"\n",(0,a.jsx)(n.h3,{id:"\u4e00\u4e2a\u5bb9\u5668\u6d88\u5931",children:"\u4e00\u4e2a\u5bb9\u5668\u6d88\u5931"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-plain",children:"- alert: ContainerKilled\n    expr: time() - container_last_seen > 60\n    for: 5m\n    labels:\n      severity: warning\n    annotations:\n      summary: Container killed (instance {{ $labels.instance }})\n      description: A container has disappeared\\n  VALUE = {{ $value }}\\n  LABELS: {{ $labels }}\n"})}),"\n",(0,a.jsx)(n.h3,{id:"\u5bb9\u5668-cpu-\u7684\u4f7f\u7528\u91cf",children:"\u5bb9\u5668 cpu \u7684\u4f7f\u7528\u91cf"}),"\n",(0,a.jsx)(n.p,{children:"\u5bb9\u5668CPU\u4f7f\u7528\u7387\u8d85\u8fc780%\u3002"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-plain",children:'# cAdvisor\u6709\u65f6\u4f1a\u6d88\u8017\u5927\u91cf\u7684CPU\uff0c\u6240\u4ee5\u8fd9\u4e2a\u8b66\u62a5\u4f1a\u4e0d\u65ad\u5730\u54cd\u8d77\u3002\n  # If you want to exclude it from this alert, just use: container_cpu_usage_seconds_total{name!=""}\n  - alert: ContainerCpuUsage\n    expr: (sum(rate(container_cpu_usage_seconds_total[3m])) BY (instance, name) * 100) > 80\n    for: 5m\n    labels:\n      severity: warning\n    annotations:\n      summary: Container CPU usage (instance {{ $labels.instance }})\n      description: Container CPU usage is above 80%\\n  VALUE = {{ $value }}\\n  LABELS: {{ $labels }}\n'})}),"\n",(0,a.jsx)(n.h3,{id:"\u5bb9\u5668\u5185\u5b58\u7684\u4f7f\u7528\u91cf",children:"\u5bb9\u5668\u5185\u5b58\u7684\u4f7f\u7528\u91cf"}),"\n",(0,a.jsx)(n.p,{children:"\u5bb9\u5668\u5185\u5b58\u4f7f\u7528\u7387\u8d85\u8fc7 80%\u3002"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-plain",children:"# See https://medium.com/faun/how-much-is-too-much-the-linux-oomkiller-and-used-memory-d32186f29c9d\n  - alert: ContainerMemoryUsage\n    expr: (sum(container_memory_working_set_bytes) BY (instance, name) / sum(container_spec_memory_limit_bytes > 0) BY (instance, name) * 100) > 80\n    for: 5m\n    labels:\n      severity: warning\n    annotations:\n      summary: Container Memory usage (instance {{ $labels.instance }})\n      description: Container Memory usage is above 80%\\n  VALUE = {{ $value }}\\n  LABELS: {{ $labels }}9.\n"})}),"\n",(0,a.jsx)(n.h3,{id:"\u5bb9\u5668\u78c1\u76d8\u7684\u4f7f\u7528\u91cf",children:"\u5bb9\u5668\u78c1\u76d8\u7684\u4f7f\u7528\u91cf"}),"\n",(0,a.jsx)(n.p,{children:"\u5bb9\u5668\u78c1\u76d8\u4f7f\u7528\u91cf\u8d85\u8fc7 80%"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-plain",children:"- alert: ContainerVolumeUsage\n    expr: (1 - (sum(container_fs_inodes_free) BY (instance) / sum(container_fs_inodes_total) BY (instance)) * 100) > 80\n    for: 5m\n    labels:\n      severity: warning\n    annotations:\n      summary: Container Volume usage (instance {{ $labels.instance }})\n      description: Container Volume usage is above 80%\\n  VALUE = {{ $value }}\\n  LABELS: {{ $labels }}\n"})}),"\n",(0,a.jsx)(n.h2,{id:"redis-\u76f8\u5173\u62a5\u8b66\u4fe1\u606f",children:"Redis \u76f8\u5173\u62a5\u8b66\u4fe1\u606f"}),"\n",(0,a.jsx)(n.h3,{id:"redis-down",children:"redis down"}),"\n",(0,a.jsx)(n.p,{children:"redis \u670d\u52a1 down \u4e86\uff0c\u62a5\u8b66"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-plain",children:"- alert: RedisDown\n    expr: redis_up == 0\n    for: 5m\n    labels:\n      severity: critical\n    annotations:\n      summary: Redis down (instance {{ $labels.instance }})\n      description: Redis instance is down\\n  VALUE = {{ $value }}\\n  LABELS: {{ $labels }}\n"})}),"\n",(0,a.jsx)(n.h3,{id:"redis-\u7f3a\u5c11\u4e3b\u8282\u70b9\u96c6\u7fa4\u6216\u8005sentinel-\u6a21\u5f0f\u624d\u6709",children:"redis \u7f3a\u5c11\u4e3b\u8282\u70b9(\u96c6\u7fa4\uff0c\u6216\u8005sentinel \u6a21\u5f0f\u624d\u6709)"}),"\n",(0,a.jsx)(n.p,{children:"redis \u96c6\u7fa4\u4e2d\u7f3a\u5c11\u6807\u8bb0\u7684\u4e3b\u8282\u70b9"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-plain",children:'- alert: RedisMissingMaster\n    expr: (count(redis_instance_info{role="master"}) or vector(0)) < 1\n    for: 5m\n    labels:\n      severity: critical\n    annotations:\n      summary: Redis missing master (instance {{ $labels.instance }})\n      description: Redis cluster has no node marked as master.\\n  VALUE = {{ $value }}\\n  LABELS: {{ $labels }}\n'})}),"\n",(0,a.jsx)(n.h3,{id:"redis-\u4e3b\u8282\u70b9\u8fc7\u591a",children:"Redis \u4e3b\u8282\u70b9\u8fc7\u591a"}),"\n",(0,a.jsx)(n.p,{children:"redis \u96c6\u7fa4\u4e2d\u88ab\u6807\u8bb0\u7684\u4e3b\u8282\u70b9\u8fc7\u591a"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-plain",children:'- alert: RedisTooManyMasters\n    expr: count(redis_instance_info{role="master"}) > 1\n    for: 5m\n    labels:\n      severity: critical\n    annotations:\n      summary: Redis too many masters (instance {{ $labels.instance }})\n      description: Redis cluster has too many nodes marked as master.\\n  VALUE = {{ $value }}\\n  LABELS: {{ $labels }}\n'})}),"\n",(0,a.jsx)(n.h3,{id:"redis-\u590d\u5236\u4e2d\u65ad",children:"Redis \u590d\u5236\u4e2d\u65ad"}),"\n",(0,a.jsx)(n.p,{children:"Redis\u5b9e\u4f8b\u4e22\u5931\u4e86\u4e00\u4e2aslave"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-plain",children:"- alert: RedisReplicationBroken\n    expr: delta(redis_connected_slaves[1m]) < 0\n    for: 5m\n    labels:\n      severity: critical\n    annotations:\n      summary: Redis replication broken (instance {{ $labels.instance }})\n      description: Redis instance lost a slave\\n  VALUE = {{ $value }}\\n  LABELS: {{ $labels }}\n"})}),"\n",(0,a.jsx)(n.h3,{id:"redis-\u96c6\u7fa4-flapping",children:"Redis \u96c6\u7fa4 flapping"}),"\n",(0,a.jsx)(n.p,{children:"\u5728Redis\u526f\u672c\u8fde\u63a5\u4e2d\u68c0\u6d4b\u5230\u53d8\u5316\u3002\u5f53\u590d\u5236\u8282\u70b9\u5931\u53bb\u4e0e\u4e3b\u8282\u70b9\u7684\u8fde\u63a5\u5e76\u91cd\u65b0\u8fde\u63a5\uff08\u4e5f\u5c31\u662fflapping\uff09\u65f6\uff0c\u4f1a\u53d1\u751f\u8fd9\u79cd\u60c5\u51b5\u3002"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-plain",children:"- alert: RedisClusterFlapping\n    expr: changes(redis_connected_slaves[5m]) > 2\n    for: 5m\n    labels:\n      severity: critical\n    annotations:\n      summary: Redis cluster flapping (instance {{ $labels.instance }})\n      description: Changes have been detected in Redis replica connection. This can occur when replica nodes lose connection to the master and reconnect (a.k.a flapping).\\n  VALUE = {{ $value }}\\n  LABELS: {{ $labels }}\n"})}),"\n",(0,a.jsx)(n.h3,{id:"redis\u7f3a\u5c11\u5907\u4efd",children:"Redis\u7f3a\u5c11\u5907\u4efd"}),"\n",(0,a.jsx)(n.p,{children:"Redis\u5df2\u7ecf\u670924\u5c0f\u65f6\u6ca1\u6709\u5907\u4efd\u4e86\u3002"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-plain",children:"- alert: RedisMissingBackup\n    expr: time() - redis_rdb_last_save_timestamp_seconds > 60 * 60 * 24\n    for: 5m\n    labels:\n      severity: critical\n    annotations:\n      summary: Redis missing backup (instance {{ $labels.instance }})\n      description: Redis has not been backuped for 24 hours\\n  VALUE = {{ $value }}\\n  LABELS: {{ $labels }}\n"})}),"\n",(0,a.jsx)(n.h3,{id:"redis\u5185\u5b58\u4e0d\u8db3",children:"Redis\u5185\u5b58\u4e0d\u8db3"}),"\n",(0,a.jsx)(n.p,{children:"Redis\u5185\u5b58\u8017\u5c3d\uff08>90%\uff09\u3002"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-plain",children:"#\u9700\u8981 redis \u5b9e\u4f8b\u8bbe\u7f6e maxmemory maxmemory-policy \u6700\u5927\u4f7f\u7528\u5185\u5b58\u53c2\u6570\n- alert: RedisOutOfMemory\n    expr: redis_memory_used_bytes / redis_total_system_memory_bytes * 100 > 90\n    for: 5m\n    labels:\n      severity: warning\n    annotations:\n      summary: Redis out of memory (instance {{ $labels.instance }})\n      description: Redis is running out of memory (> 90%)\\n  VALUE = {{ $value }}\\n  LABELS: {{ $labels }}\n"})}),"\n",(0,a.jsx)(n.h3,{id:"redis\u8fde\u63a5\u6570\u8fc7\u591a",children:"Redis\u8fde\u63a5\u6570\u8fc7\u591a"}),"\n",(0,a.jsx)(n.p,{children:"Redis\u5b9e\u4f8b\u6709\u592a\u591a\u7684\u8fde\u63a5"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-plain",children:"- alert: RedisTooManyConnections\n    expr: redis_connected_clients > 100\n    for: 5m\n    labels:\n      severity: warning\n    annotations:\n      summary: Redis too many connections (instance {{ $labels.instance }})\n      description: Redis instance has too many connections\\n  VALUE = {{ $value }}\\n  LABELS: {{ $labels }}\n"})}),"\n",(0,a.jsx)(n.h3,{id:"redis\u8fde\u63a5\u6570\u4e0d\u8db3",children:"Redis\u8fde\u63a5\u6570\u4e0d\u8db3"}),"\n",(0,a.jsx)(n.p,{children:"Redis\u5b9e\u4f8b\u5e94\u8be5\u6709\u66f4\u591a\u7684\u8fde\u63a5\uff08> 5\uff09\u3002"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-plain",children:"- alert: RedisNotEnoughConnections\n    expr: redis_connected_clients < 5\n    for: 5m\n    labels:\n      severity: warning\n    annotations:\n      summary: Redis not enough connections (instance {{ $labels.instance }})\n      description: Redis instance should have more connections (> 5)\\n  VALUE = {{ $value }}\\n  LABELS: {{ $labels }}\n"})}),"\n",(0,a.jsx)(n.h3,{id:"redis\u62d2\u7edd\u8fde\u63a5",children:"Redis\u62d2\u7edd\u8fde\u63a5"}),"\n",(0,a.jsx)(n.p,{children:"\u4e00\u4e9b\u4e0eRedis\u7684\u8fde\u63a5\u5df2\u88ab\u62d2\u7edd"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-plain",children:"- alert: RedisRejectedConnections\n    expr: increase(redis_rejected_connections_total[1m]) > 0\n    for: 5m\n    labels:\n      severity: critical\n    annotations:\n      summary: Redis rejected connections (instance {{ $labels.instance }})\n      description: Some connections to Redis has been rejected\\n  VALUE = {{ $value }}\\n  LABELS: {{ $labels }}\n"})}),"\n",(0,a.jsx)(n.h2,{id:"rabbitmq-\u76d1\u63a7--rabbitmqrabbitmq-prometheus-",children:"rabbitmq \u76d1\u63a7 : [rabbitmq/rabbitmq-prometheus ]"}),"\n",(0,a.jsx)(n.h3,{id:"rabbitmq-\u8282\u70b9-down",children:"rabbitmq \u8282\u70b9 down"}),"\n",(0,a.jsx)(n.p,{children:"\u8282\u70b9\u6570\u91cf\u5c11\u4e8e 1 \u4e2a"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-plain",children:"- alert: RabbitmqNodeDown\n    expr: sum(rabbitmq_build_info) < 3\n    for: 5m\n    labels:\n      severity: critical\n    annotations:\n      summary: Rabbitmq node down (instance {{ $labels.instance }})\n      description: Less than 3 nodes running in RabbitMQ cluster\\n  VALUE = {{ $value }}\\n  LABELS: {{ $labels }}  - alert: RabbitmqDown\n    expr: rabbitmq_up == 0\n    for: 5m\n    labels:\n      severity: critical\n    annotations:\n      summary: Rabbitmq down (instance {{ $labels.instance }})\n      description: RabbitMQ node down\\n  VALUE = {{ $value }}\\n  LABELS: {{ $labels }}\n"})}),"\n",(0,a.jsx)(n.h3,{id:"rabbitmq\u5b9e\u4f8b\u7684\u4e0d\u540c\u7248\u672c",children:"Rabbitmq\u5b9e\u4f8b\u7684\u4e0d\u540c\u7248\u672c"}),"\n",(0,a.jsx)(n.p,{children:"\u5728\u540c\u4e00\u96c6\u7fa4\u4e2d\u8fd0\u884c\u4e0d\u540c\u7248\u672c\u7684Rabbitmq\uff0c\u53ef\u80fd\u4f1a\u5bfc\u81f4\u5931\u8d25\u3002"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-plain",children:"- alert: RabbitmqInstancesDifferentVersions\n    expr: count(count(rabbitmq_build_info) by (rabbitmq_version)) > 1\n    for: 5m\n    labels:\n      severity: warning\n    annotations:\n      summary: Rabbitmq instances different versions (instance {{ $labels.instance }})\n      description: Running different version of Rabbitmq in the same cluster, can lead to failure.\\n  VALUE = {{ $value }}\\n  LABELS: {{ $labels }}  - alert: RabbitmqClusterPartition\n    expr: rabbitmq_partitions > 0\n    for: 5m\n    labels:\n      severity: critical\n    annotations:\n      summary: Rabbitmq cluster partition (instance {{ $labels.instance }})\n      description: Cluster partition\\n  VALUE = {{ $value }}\\n  LABELS: {{ $labels }}\n"})}),"\n",(0,a.jsx)(n.h3,{id:"rabbitmq\u5185\u5b58\u9ad8",children:"Rabbitmq\u5185\u5b58\u9ad8"}),"\n",(0,a.jsx)(n.p,{children:"\u4e00\u4e2a\u8282\u70b9\u4f7f\u7528\u4e8690%\u4ee5\u4e0a\u7684\u5185\u5b58\u5206\u914d\u3002"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-plain",children:"- alert: RabbitmqMemoryHigh\n    expr: rabbitmq_process_resident_memory_bytes / rabbitmq_resident_memory_limit_bytes * 100 > 90\n    for: 5m\n    labels:\n      severity: warning\n    annotations:\n      summary: Rabbitmq memory high (instance {{ $labels.instance }})\n      description: A node use more than 90% of allocated RAM\\n  VALUE = {{ $value }}\\n  LABELS: {{ $labels }}  - alert: RabbitmqOutOfMemory\n    expr: rabbitmq_node_mem_used / rabbitmq_node_mem_limit * 100 > 90\n    for: 5m\n    labels:\n      severity: warning\n    annotations:\n      summary: Rabbitmq out of memory (instance {{ $labels.instance }})\n      description: Memory available for RabbmitMQ is low (< 10%)\\n  VALUE = {{ $value }}\\n  LABELS: {{ $labels }}\n"})}),"\n",(0,a.jsx)(n.h3,{id:"rabbitmq\u6587\u4ef6\u63cf\u8ff0\u7b26\u7684\u7528\u6cd5",children:"Rabbitmq\u6587\u4ef6\u63cf\u8ff0\u7b26\u7684\u7528\u6cd5"}),"\n",(0,a.jsx)(n.p,{children:"\u4e00\u4e2a\u8282\u70b9\u4f7f\u752890%\u4ee5\u4e0a\u7684\u6587\u4ef6\u63cf\u8ff0\u7b26\u3002"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-plain",children:"- alert: RabbitmqFileDescriptorsUsage\n    expr: rabbitmq_process_open_fds / rabbitmq_process_max_fds * 100 > 90\n    for: 5m\n    labels:\n      severity: warning\n    annotations:\n      summary: Rabbitmq file descriptors usage (instance {{ $labels.instance }})\n      description: A node use more than 90% of file descriptors\\n  VALUE = {{ $value }}\\n  LABELS: {{ $labels }}  - alert: RabbitmqTooManyConnections\n    expr: rabbitmq_connectionsTotal > 1000\n    for: 5m\n    labels:\n      severity: warning\n    annotations:\n      summary: Rabbitmq too many connections (instance {{ $labels.instance }})\n      description: RabbitMQ instance has too many connections (> 1000)\\n  VALUE = {{ $value }}\\n  LABELS: {{ $labels }}\n"})}),"\n",(0,a.jsx)(n.h3,{id:"rabbitmq\u8fde\u63a5\u6570\u592a\u591a",children:"Rabbitmq\u8fde\u63a5\u6570\u592a\u591a"}),"\n",(0,a.jsx)(n.p,{children:"\u8282\u70b9\u7684\u603b\u8fde\u63a5\u6570\u8fc7\u9ad8\u3002"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-plain",children:'- alert: RabbitmqTooMuchConnections\n    expr: rabbitmq_connections > 1000\n    for: 5m\n    labels:\n      severity: warning\n    annotations:\n      summary: Rabbitmq too much connections (instance {{ $labels.instance }})\n      description: The total connections of a node is too high\\n  VALUE = {{ $value }}\\n  LABELS: {{ $labels }}  - alert: RabbitmqTooManyMessagesInQueue\n    expr: rabbitmq_queue_messages_ready{queue="my-queue"} > 1000\n    for: 5m\n    labels:\n      severity: warning\n    annotations:\n      summary: Rabbitmq too many messages in queue (instance {{ $labels.instance }})\n      description: Queue is filling up (> 1000 msgs)\\n  VALUE = {{ $value }}\\n  LABELS: {{ $labels }}\n'})}),"\n",(0,a.jsx)(n.h3,{id:"rabbitmq\u65e0\u961f\u5217\u6d88\u8d39",children:"Rabbitmq\u65e0\u961f\u5217\u6d88\u8d39"}),"\n",(0,a.jsx)(n.p,{children:"\u4e00\u4e2a\u961f\u5217\u7684\u6d88\u8d39\u8005\u5c11\u4e8e1\u4e2a"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-plain",children:'- alert: RabbitmqNoQueueConsumer\n    expr: rabbitmq_queue_consumers < 1\n    for: 5m\n    labels:\n      severity: warning\n    annotations:\n      summary: Rabbitmq no queue consumer (instance {{ $labels.instance }})\n      description: A queue has less than 1 consumer\\n  VALUE = {{ $value }}\\n  LABELS: {{ $labels }}  - alert: RabbitmqSlowQueueConsuming\n    expr: time() - rabbitmq_queue_head_message_timestamp{queue="my-queue"} > 60\n    for: 5m\n    labels:\n      severity: warning\n    annotations:\n      summary: Rabbitmq slow queue consuming (instance {{ $labels.instance }})\n      description: Queue messages are consumed slowly (> 60s)\\n  VALUE = {{ $value }}\\n  LABELS: {{ $labels }}\n'})}),"\n",(0,a.jsx)(n.h3,{id:"rabbitmq\u4e0d\u53ef\u8def\u7531\u7684\u6d88\u606f",children:"Rabbitmq\u4e0d\u53ef\u8def\u7531\u7684\u6d88\u606f"}),"\n",(0,a.jsx)(n.p,{children:"\u4e00\u4e2a\u961f\u5217\u6709\u4e0d\u53ef\u66f4\u6539\u7684\u6d88\u606f"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-plain",children:"- alert: RabbitmqUnroutableMessages\n    expr: increase(rabbitmq_channel_messages_unroutable_returned_total[5m]) > 0 or increase(rabbitmq_channel_messages_unroutable_dropped_total[5m]) > 0\n    for: 5m\n    labels:\n      severity: warning\n    annotations:\n      summary: Rabbitmq unroutable messages (instance {{ $labels.instance }})\n      description: A queue has unroutable messages\\n  VALUE = {{ $value }}\\n  LABELS: {{ $labels }}  - alert: RabbitmqNoConsumer\n    expr: rabbitmq_queue_consumers == 0\n    for: 5m\n    labels:\n      severity: critical\n    annotations:\n      summary: Rabbitmq no consumer (instance {{ $labels.instance }})\n      description: Queue has no consumer\\n  VALUE = {{ $value }}\\n  LABELS: {{ $labels }}\n"})}),"\n",(0,a.jsxs)(n.p,{children:["\u53c2\u8003\u94fe\u63a5\n",(0,a.jsx)(n.a,{href:"https://blog.51cto.com/u_16213630/10089792",children:"https://blog.51cto.com/u_16213630/10089792"})]})]})}function m(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(d,{...e})}):d(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>r,x:()=>t});var a=s(6540);const i={},l=a.createContext(i);function r(e){const n=a.useContext(l);return a.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function t(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),a.createElement(l.Provider,{value:n},e.children)}}}]);